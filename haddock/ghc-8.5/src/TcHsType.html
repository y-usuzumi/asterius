<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[TcMonoType]{Typechecking user-specified @MonoTypes@}
-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE CPP, TupleSections, MultiWayIf, RankNTypes #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcHsType</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-12"></a><span>        </span><span class="hs-comment">-- Type signatures</span><span>
</span><a name="line-13"></a><span>        </span><a href="TcHsType.html#kcHsSigType"><span class="hs-identifier hs-var">kcHsSigType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcClassSigType"><span class="hs-identifier hs-var">tcClassSigType</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="TcHsType.html#tcHsSigType"><span class="hs-identifier hs-var">tcHsSigType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcHsSigWcType"><span class="hs-identifier hs-var">tcHsSigWcType</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="TcHsType.html#tcHsPartialSigType"><span class="hs-identifier hs-var">tcHsPartialSigType</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="TcHsType.html#funsSigCtxt"><span class="hs-identifier hs-var">funsSigCtxt</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#pprSigCtxt"><span class="hs-identifier hs-var">pprSigCtxt</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span>        </span><a href="TcHsType.html#tcHsClsInstType"><span class="hs-identifier hs-var">tcHsClsInstType</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="TcHsType.html#tcHsDeriv"><span class="hs-identifier hs-var">tcHsDeriv</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcDerivStrategy"><span class="hs-identifier hs-var">tcDerivStrategy</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="TcHsType.html#tcHsTypeApp"><span class="hs-identifier hs-var">tcHsTypeApp</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="TcHsType.html#tcImplicitTKBndrs"><span class="hs-identifier hs-var">tcImplicitTKBndrs</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcImplicitTKBndrsX"><span class="hs-identifier hs-var">tcImplicitTKBndrsX</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="TcHsType.html#tcExplicitTKBndrs"><span class="hs-identifier hs-var">tcExplicitTKBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="TcHsType.html#kcExplicitTKBndrs"><span class="hs-identifier hs-var">kcExplicitTKBndrs</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#kcImplicitTKBndrs"><span class="hs-identifier hs-var">kcImplicitTKBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>                </span><span class="hs-comment">-- Type checking type and class decls</span><span>
</span><a name="line-27"></a><span>        </span><a href="TcHsType.html#kcLookupTcTyCon"><span class="hs-identifier hs-var">kcLookupTcTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#kcTyClTyVars"><span class="hs-identifier hs-var">kcTyClTyVars</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcTyClTyVars"><span class="hs-identifier hs-var">tcTyClTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="TcHsType.html#tcDataKindSig"><span class="hs-identifier hs-var">tcDataKindSig</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span>          </span><span class="hs-comment">-- tyvars</span><span>
</span><a name="line-31"></a><span>        </span><a href="TcHsType.html#scopeTyVars"><span class="hs-identifier hs-var">scopeTyVars</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#scopeTyVars2"><span class="hs-identifier hs-var">scopeTyVars2</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>        </span><span class="hs-comment">-- Kind-checking types</span><span>
</span><a name="line-34"></a><span>        </span><span class="hs-comment">-- No kind generalisation, no checkValidType</span><span>
</span><a name="line-35"></a><span>        </span><a href="TcHsType.html#kcLHsQTyVars"><span class="hs-identifier hs-var">kcLHsQTyVars</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#kcLHsTyVarBndrs"><span class="hs-identifier hs-var">kcLHsTyVarBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="TcHsType.html#tcWildCardBinders"><span class="hs-identifier hs-var">tcWildCardBinders</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="TcHsType.html#tcHsLiftedType"><span class="hs-identifier hs-var">tcHsLiftedType</span></a><span class="hs-special">,</span><span>   </span><a href="TcHsType.html#tcHsOpenType"><span class="hs-identifier hs-var">tcHsOpenType</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="TcHsType.html#tcHsLiftedTypeNC"><span class="hs-identifier hs-var">tcHsLiftedTypeNC</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcHsOpenTypeNC"><span class="hs-identifier hs-var">tcHsOpenTypeNC</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>        </span><a href="TcHsType.html#tcLHsType"><span class="hs-identifier hs-var">tcLHsType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcLHsTypeUnsaturated"><span class="hs-identifier hs-var">tcLHsTypeUnsaturated</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="TcHsType.html#tcHsMbContext"><span class="hs-identifier hs-var">tcHsMbContext</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcHsContext"><span class="hs-identifier hs-var">tcHsContext</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcLHsPredType"><span class="hs-identifier hs-var">tcLHsPredType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcInferApps"><span class="hs-identifier hs-var">tcInferApps</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="TcSimplify.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- useful re-export</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>        </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#kindLevelMode"><span class="hs-identifier hs-var">kindLevelMode</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>        </span><a href="TcHsType.html#kindGeneralize"><span class="hs-identifier hs-var">kindGeneralize</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#checkExpectedKindX"><span class="hs-identifier hs-var">checkExpectedKindX</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#instantiateTyUntilN"><span class="hs-identifier hs-var">instantiateTyUntilN</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>        </span><a href="TcHsType.html#reportFloatingKvs"><span class="hs-identifier hs-var">reportFloatingKvs</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span>        </span><span class="hs-comment">-- Sort-checking kinds</span><span>
</span><a name="line-49"></a><span>        </span><a href="TcHsType.html#tcLHsKindSig"><span class="hs-identifier hs-var">tcLHsKindSig</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#badKindSig"><span class="hs-identifier hs-var">badKindSig</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span>        </span><span class="hs-comment">-- Zonking and promoting</span><span>
</span><a name="line-52"></a><span>        </span><a href="TcHsType.html#zonkPromoteType"><span class="hs-identifier hs-var">zonkPromoteType</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span>        </span><span class="hs-comment">-- Pattern type signatures</span><span>
</span><a name="line-55"></a><span>        </span><a href="TcHsType.html#tcHsPatSigType"><span class="hs-identifier hs-var">tcHsPatSigType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#tcPatSig"><span class="hs-identifier hs-var">tcPatSig</span></a><span class="hs-special">,</span><span> </span><a href="TcHsType.html#funAppCtxt"><span class="hs-identifier hs-var">funAppCtxt</span></a><span>
</span><a name="line-56"></a><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="TcEvidence.html"><span class="hs-identifier">TcEvidence</span></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="TcEnv.html"><span class="hs-identifier">TcEnv</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="TcMType.html"><span class="hs-identifier">TcMType</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="TcValidity.html"><span class="hs-identifier">TcValidity</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="TcUnify.html"><span class="hs-identifier">TcUnify</span></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="TcIface.html"><span class="hs-identifier">TcIface</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="TcSimplify.html"><span class="hs-identifier">TcSimplify</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="TcHsSyn.html"><span class="hs-identifier">TcHsSyn</span></a><span class="hs-special">(</span><span> </span><a href="TcHsSyn.html#zonkSigType"><span class="hs-identifier hs-var">zonkSigType</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="Inst.html"><span class="hs-identifier">Inst</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="Inst.html#tcInstBinders"><span class="hs-identifier hs-var">tcInstBinders</span></a><span class="hs-special">,</span><span> </span><a href="Inst.html#tcInstBinder"><span class="hs-identifier hs-var">tcInstBinder</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="TyCoRep.html"><span class="hs-identifier">TyCoRep</span></a><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Used in tcDataKindSig</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="Kind.html"><span class="hs-identifier">Kind</span></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span class="hs-special">(</span><span> </span><a href="RdrName.html#lookupLocalRdrOcc"><span class="hs-identifier hs-var">lookupLocalRdrOcc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><a href="ConLike.html"><span class="hs-identifier">ConLike</span></a><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><a href="Constants.html"><span class="hs-identifier">Constants</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Constants.html#mAX_CTUPLE_SIZE"><span class="hs-identifier hs-var">mAX_CTUPLE_SIZE</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span class="hs-special">(</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="PrelNames.html#wildCardName"><span class="hs-identifier hs-var">wildCardName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapAccumR"><span class="hs-identifier hs-var">mapAccumR</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">{-
        ----------------------------
                General notes
        ----------------------------

Unlike with expressions, type-checking types both does some checking and
desugars at the same time. This is necessary because we often want to perform
equality checks on the types right away, and it would be incredibly painful
to do this on un-desugared types. Luckily, desugared types are close enough
to HsTypes to make the error messages sane.

During type-checking, we perform as little validity checking as possible.
This is because some type-checking is done in a mutually-recursive knot, and
if we look too closely at the tycons, we'll loop. This is why we always must
use mkNakedTyConApp and mkNakedAppTys, etc., which never look at a tycon.
The mkNamed... functions don't uphold Type invariants, but zonkTcTypeToType
will repair this for us. Note that zonkTcType *is* safe within a knot, and
can be done repeatedly with no ill effect: it just squeezes out metavariables.

Generally, after type-checking, you will want to do validity checking, say
with TcValidity.checkValidType.

Validity checking
~~~~~~~~~~~~~~~~~
Some of the validity check could in principle be done by the kind checker,
but not all:

- During desugaring, we normalise by expanding type synonyms.  Only
  after this step can we check things like type-synonym saturation
  e.g.  type T k = k Int
        type S a = a
  Then (T S) is ok, because T is saturated; (T S) expands to (S Int);
  and then S is saturated.  This is a GHC extension.

- Similarly, also a GHC extension, we look through synonyms before complaining
  about the form of a class or instance declaration

- Ambiguity checks involve functional dependencies, and it's easier to wait
  until knots have been resolved before poking into them

Also, in a mutually recursive group of types, we can't look at the TyCon until we've
finished building the loop.  So to keep things simple, we postpone most validity
checking until step (3).

Knot tying
~~~~~~~~~~
During step (1) we might fault in a TyCon defined in another module, and it might
(via a loop) refer back to a TyCon defined in this module. So when we tie a big
knot around type declarations with ARecThing, so that the fault-in code can get
the TyCon being defined.

%************************************************************************
%*                                                                      *
              Check types AND do validity checking
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-identifier">funsSigCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>
</span><a name="line-165"></a><span class="hs-comment">-- Returns FunSigCtxt, with no redundant-context-reporting,</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- form a list of located names</span><span>
</span><a name="line-167"></a><a name="funsSigCtxt"><a href="TcHsType.html#funsSigCtxt"><span class="hs-identifier">funsSigCtxt</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308543"><a href="#local-6989586621680308543"><span class="hs-identifier">name1</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a href="#local-6989586621680308543"><span class="hs-identifier hs-var">name1</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-168"></a><span class="hs-identifier">funsSigCtxt</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;funSigCtxt&quot;</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-identifier">addSigCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308542"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308542"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-171"></a><a name="addSigCtxt"><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier">addSigCtxt</span></a></a><span> </span><a name="local-6989586621680308544"><a href="#local-6989586621680308544"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621680308545"><a href="#local-6989586621680308545"><span class="hs-identifier">hs_ty</span></a></a><span> </span><a name="local-6989586621680308546"><a href="#local-6989586621680308546"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-172"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><a href="#local-6989586621680308545"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-173"></a><span>    </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#pprSigCtxt"><span class="hs-identifier hs-var">pprSigCtxt</span></a><span> </span><a href="#local-6989586621680308544"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621680308545"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-174"></a><span>    </span><a href="#local-6989586621680308546"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span class="hs-identifier">pprSigCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-177"></a><span class="hs-comment">-- (pprSigCtxt ctxt &lt;extra&gt; &lt;type&gt;)</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- prints    In the type signature for 'f':</span><span>
</span><a name="line-179"></a><span class="hs-comment">--              f :: &lt;type&gt;</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- The &lt;extra&gt; is either empty or &quot;the ambiguity check for&quot;</span><span>
</span><a name="line-181"></a><a name="pprSigCtxt"><a href="TcHsType.html#pprSigCtxt"><span class="hs-identifier">pprSigCtxt</span></a></a><span> </span><a name="local-6989586621680308547"><a href="#local-6989586621680308547"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621680308548"><a href="#local-6989586621680308548"><span class="hs-identifier">hs_ty</span></a></a><span>
</span><a name="line-182"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680308549"><a href="#local-6989586621680308549"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#isSigMaybe"><span class="hs-identifier hs-var">isSigMaybe</span></a><span> </span><a href="#local-6989586621680308547"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-183"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In the type signature:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#pprPrefixOcc"><span class="hs-identifier hs-var">pprPrefixOcc</span></a><span> </span><a href="#local-6989586621680308549"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308548"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-187"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcType.html#pprUserTypeCtxt"><span class="hs-identifier hs-var">pprUserTypeCtxt</span></a><span> </span><a href="#local-6989586621680308547"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308548"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-identifier">tcHsSigWcType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-191"></a><span class="hs-comment">-- This one is used when we have a LHsSigWcType, but in</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- a place where wildards aren't allowed. The renamer has</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- already checked this, so we can simply ignore it.</span><span>
</span><a name="line-194"></a><a name="tcHsSigWcType"><a href="TcHsType.html#tcHsSigWcType"><span class="hs-identifier">tcHsSigWcType</span></a></a><span> </span><a name="local-6989586621680308550"><a href="#local-6989586621680308550"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621680308551"><a href="#local-6989586621680308551"><span class="hs-identifier">sig_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcHsSigType"><span class="hs-identifier hs-var">tcHsSigType</span></a><span> </span><a href="#local-6989586621680308550"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#dropWildCards"><span class="hs-identifier hs-var">dropWildCards</span></a><span> </span><a href="#local-6989586621680308551"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-identifier">kcHsSigType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-197"></a><a name="kcHsSigType"><a href="TcHsType.html#kcHsSigType"><span class="hs-identifier">kcHsSigType</span></a></a><span> </span><a name="local-6989586621680308552"><a href="#local-6989586621680308552"><span class="hs-identifier">skol_info</span></a></a><span> </span><a name="local-6989586621680308553"><a href="#local-6989586621680308553"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308554"><a href="#local-6989586621680308554"><span class="hs-identifier">hs_ty</span></a></a><span>
</span><a name="line-198"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#HsIBRn"><span class="hs-identifier hs-var">HsIBRn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308555"><a href="#local-6989586621680308555"><span class="hs-identifier">sig_vars</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#funsSigCtxt"><span class="hs-identifier hs-var">funsSigCtxt</span></a><span> </span><a href="#local-6989586621680308553"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308554"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-200"></a><span>    </span><a href="TcRnMonad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-201"></a><span>    </span><a href="TcHsType.html#tcImplicitTKBndrs"><span class="hs-identifier hs-var">tcImplicitTKBndrs</span></a><span> </span><a href="#local-6989586621680308552"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680308555"><span class="hs-identifier hs-var">sig_vars</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-202"></a><span>    </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-6989586621680308554"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-203"></a><span class="hs-identifier">kcHsSigType</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XHsImplicitBndrs"><span class="hs-identifier hs-var">XHsImplicitBndrs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;kcHsSigType&quot;</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-identifier">tcClassSigType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-206"></a><span class="hs-comment">-- Does not do validity checking; this must be done outside</span><span>
</span><a name="line-207"></a><span class="hs-comment">-- the recursive class declaration &quot;knot&quot;</span><span>
</span><a name="line-208"></a><a name="tcClassSigType"><a href="TcHsType.html#tcClassSigType"><span class="hs-identifier">tcClassSigType</span></a></a><span> </span><a name="local-6989586621680308556"><a href="#local-6989586621680308556"><span class="hs-identifier">skol_info</span></a></a><span> </span><a name="local-6989586621680308557"><a href="#local-6989586621680308557"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-6989586621680308558"><a href="#local-6989586621680308558"><span class="hs-identifier">sig_ty</span></a></a><span>
</span><a name="line-209"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#funsSigCtxt"><span class="hs-identifier hs-var">funsSigCtxt</span></a><span> </span><a href="#local-6989586621680308557"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsSigType"><span class="hs-identifier hs-var">hsSigType</span></a><span> </span><a href="#local-6989586621680308558"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-210"></a><span>    </span><a href="TcHsType.html#tc_hs_sig_type_and_gen"><span class="hs-identifier hs-var">tc_hs_sig_type_and_gen</span></a><span> </span><a href="#local-6989586621680308556"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680308558"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-identifier">tcHsSigType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-213"></a><span class="hs-comment">-- Does validity checking</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- See Note [Recipe for checking a signature]</span><span>
</span><a name="line-215"></a><a name="tcHsSigType"><a href="TcHsType.html#tcHsSigType"><span class="hs-identifier">tcHsSigType</span></a></a><span> </span><a name="local-6989586621680308559"><a href="#local-6989586621680308559"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621680308560"><a href="#local-6989586621680308560"><span class="hs-identifier">sig_ty</span></a></a><span>
</span><a name="line-216"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span> </span><a href="#local-6989586621680308559"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsSigType"><span class="hs-identifier hs-var">hsSigType</span></a><span> </span><a href="#local-6989586621680308560"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-217"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcHsSigType {&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308560"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308563"><a href="#local-6989586621680308563"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcValidity.html#expectedKindInCtxt"><span class="hs-identifier hs-var">expectedKindInCtxt</span></a><span> </span><a href="#local-6989586621680308559"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-219"></a><span>                    </span><a href="TcValidity.html#AnythingKind"><span class="hs-identifier hs-var">AnythingKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-220"></a><span>                    </span><a href="TcValidity.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a><span> </span><a name="local-6989586621680308562"><a href="#local-6989586621680308562"><span class="hs-identifier">k</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680308562"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-221"></a><span>                    </span><a href="TcValidity.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a><span>
</span><a name="line-222"></a><span>              </span><span class="hs-comment">-- The kind is checked by checkValidType, and isn't necessarily</span><span>
</span><a name="line-223"></a><span>              </span><span class="hs-comment">-- of kind * in a Template Haskell quote eg [t| Maybe |]</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span>          </span><span class="hs-comment">-- Generalise here: see Note [Kind generalisation]</span><span>
</span><a name="line-226"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308564"><a href="#local-6989586621680308564"><span class="hs-identifier">do_kind_gen</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#decideKindGeneralisationPlan"><span class="hs-identifier hs-var">decideKindGeneralisationPlan</span></a><span> </span><a href="#local-6989586621680308560"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-227"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308565"><a href="#local-6989586621680308565"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680308564"><span class="hs-identifier hs-var">do_kind_gen</span></a><span>
</span><a name="line-228"></a><span>               </span><span class="hs-keyword">then</span><span> </span><a href="TcHsType.html#tc_hs_sig_type_and_gen"><span class="hs-identifier hs-var">tc_hs_sig_type_and_gen</span></a><span> </span><a href="#local-6989586621680308561"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680308560"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><a href="#local-6989586621680308563"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-229"></a><span>               </span><span class="hs-keyword">else</span><span> </span><a href="TcHsType.html#tc_hs_sig_type"><span class="hs-identifier hs-var">tc_hs_sig_type</span></a><span>         </span><a href="#local-6989586621680308561"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680308560"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><a href="#local-6989586621680308563"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span> </span><a href="#local-6989586621680308559"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621680308565"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-232"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;end tcHsSigType }&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308565"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680308565"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-234"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-235"></a><span>    </span><a name="local-6989586621680308561"><a href="#local-6989586621680308561"><span class="hs-identifier">skol_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#SigTypeSkol"><span class="hs-identifier hs-var">SigTypeSkol</span></a><span> </span><a href="#local-6989586621680308559"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-identifier">tc_hs_sig_type_and_gen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-238"></a><span class="hs-comment">-- Kind-checks/desugars an 'LHsSigType',</span><span>
</span><a name="line-239"></a><span class="hs-comment">--   solve equalities,</span><span>
</span><a name="line-240"></a><span class="hs-comment">--   and then kind-generalizes.</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- This will never emit constraints, as it uses solveEqualities interally.</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- No validity checking, but it does zonk en route to generalization</span><span>
</span><a name="line-243"></a><a name="tc_hs_sig_type_and_gen"><a href="TcHsType.html#tc_hs_sig_type_and_gen"><span class="hs-identifier">tc_hs_sig_type_and_gen</span></a></a><span> </span><a name="local-6989586621680308566"><a href="#local-6989586621680308566"><span class="hs-identifier">skol_info</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_ext</span><span>
</span><a name="line-244"></a><span>                                              </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#HsIBRn"><span class="hs-identifier hs-var">HsIBRn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308567"><a href="#local-6989586621680308567"><span class="hs-identifier">sig_vars</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-245"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308568"><a href="#local-6989586621680308568"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680308569"><a href="#local-6989586621680308569"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-246"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308570"><a href="#local-6989586621680308570"><span class="hs-identifier">tkvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308571"><a href="#local-6989586621680308571"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-247"></a><span>                       </span><a href="TcHsType.html#tcImplicitTKBndrs"><span class="hs-identifier hs-var">tcImplicitTKBndrs</span></a><span> </span><a href="#local-6989586621680308566"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680308567"><span class="hs-identifier hs-var">sig_vars</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-248"></a><span>                       </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-6989586621680308568"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-6989586621680308569"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-249"></a><span>         </span><span class="hs-comment">-- NB the call to solveEqualities, which unifies all those</span><span>
</span><a name="line-250"></a><span>         </span><span class="hs-comment">--    kind variables floating about, immediately prior to</span><span>
</span><a name="line-251"></a><span>         </span><span class="hs-comment">--    kind generalisation</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span>         </span><span class="hs-comment">-- We use the &quot;InKnot&quot; zonker, because this is called</span><span>
</span><a name="line-254"></a><span>         </span><span class="hs-comment">-- on class method sigs in the knot</span><span>
</span><a name="line-255"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308572"><a href="#local-6989586621680308572"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#zonkPromoteTypeInKnot"><span class="hs-identifier hs-var">zonkPromoteTypeInKnot</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span> </span><a href="#local-6989586621680308570"><span class="hs-identifier hs-var">tkvs</span></a><span> </span><a href="#local-6989586621680308571"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-256"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308573"><a href="#local-6989586621680308573"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#kindGeneralize"><span class="hs-identifier hs-var">kindGeneralize</span></a><span> </span><a href="#local-6989586621680308572"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-257"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsSyn.html#zonkSigType"><span class="hs-identifier hs-var">zonkSigType</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkInvForAllTys"><span class="hs-identifier hs-var">mkInvForAllTys</span></a><span> </span><a href="#local-6989586621680308573"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-6989586621680308572"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-identifier">tc_hs_sig_type_and_gen</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XHsImplicitBndrs"><span class="hs-identifier hs-var">XHsImplicitBndrs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tc_hs_sig_type_and_gen&quot;</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-identifier">tc_hs_sig_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-262"></a><span class="hs-comment">-- Kind-check/desugar a 'LHsSigType', but does not solve</span><span>
</span><a name="line-263"></a><span class="hs-comment">-- the equalities that arise from doing so; instead it may</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- emit kind-equality constraints into the monad</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- Zonking, but no validity checking</span><span>
</span><a name="line-266"></a><a name="tc_hs_sig_type"><a href="TcHsType.html#tc_hs_sig_type"><span class="hs-identifier">tc_hs_sig_type</span></a></a><span> </span><a name="local-6989586621680308574"><a href="#local-6989586621680308574"><span class="hs-identifier">skol_info</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#HsIBRn"><span class="hs-identifier hs-var">HsIBRn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308575"><a href="#local-6989586621680308575"><span class="hs-identifier">sig_vars</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-267"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308576"><a href="#local-6989586621680308576"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680308577"><a href="#local-6989586621680308577"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-268"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308578"><a href="#local-6989586621680308578"><span class="hs-identifier">tkvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308579"><a href="#local-6989586621680308579"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcImplicitTKBndrs"><span class="hs-identifier hs-var">tcImplicitTKBndrs</span></a><span> </span><a href="#local-6989586621680308574"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680308575"><span class="hs-identifier hs-var">sig_vars</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-269"></a><span>                       </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-6989586621680308576"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-6989586621680308577"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span>          </span><span class="hs-comment">-- need to promote any remaining metavariables; test case:</span><span>
</span><a name="line-272"></a><span>          </span><span class="hs-comment">-- dependent/should_fail/T14066e.</span><span>
</span><a name="line-273"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#zonkPromoteType"><span class="hs-identifier hs-var">zonkPromoteType</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span> </span><a href="#local-6989586621680308578"><span class="hs-identifier hs-var">tkvs</span></a><span> </span><a href="#local-6989586621680308579"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-identifier">tc_hs_sig_type</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XHsImplicitBndrs"><span class="hs-identifier hs-var">XHsImplicitBndrs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tc_hs_sig_type&quot;</span><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-278"></a><span class="hs-identifier">tcHsDeriv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- Like tcHsSigType, but for the ...deriving( C t1 ty2 ) clause</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- Returns the C, [ty1, ty2, and the kinds of C's remaining arguments</span><span>
</span><a name="line-281"></a><span class="hs-comment">-- E.g.    class C (a::*) (b::k-&gt;k)</span><span>
</span><a name="line-282"></a><span class="hs-comment">--         data T a b = ... deriving( C Int )</span><span>
</span><a name="line-283"></a><span class="hs-comment">--    returns ([k], C, [k, Int], [k-&gt;k])</span><span>
</span><a name="line-284"></a><a name="tcHsDeriv"><a href="TcHsType.html#tcHsDeriv"><span class="hs-identifier">tcHsDeriv</span></a></a><span> </span><a name="local-6989586621680308580"><a href="#local-6989586621680308580"><span class="hs-identifier">hs_ty</span></a></a><span>
</span><a name="line-285"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308581"><a href="#local-6989586621680308581"><span class="hs-identifier">cls_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-286"></a><span>                    </span><span class="hs-comment">-- always safe to kind-generalize, because there</span><span>
</span><a name="line-287"></a><span>                    </span><span class="hs-comment">-- can be no covars in an outer scope</span><span>
</span><a name="line-288"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308582"><a href="#local-6989586621680308582"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-289"></a><span>                 </span><span class="hs-comment">-- avoid redundant error report with &quot;illegal deriving&quot;, below</span><span>
</span><a name="line-290"></a><span>               </span><a href="TcHsType.html#tc_hs_sig_type_and_gen"><span class="hs-identifier hs-var">tc_hs_sig_type_and_gen</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SigTypeSkol"><span class="hs-identifier hs-var">SigTypeSkol</span></a><span> </span><a href="TcType.html#DerivClauseCtxt"><span class="hs-identifier hs-var">DerivClauseCtxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308580"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-6989586621680308581"><span class="hs-identifier hs-var">cls_kind</span></a><span>
</span><a name="line-291"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308583"><a href="#local-6989586621680308583"><span class="hs-identifier">cls_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621680308581"><span class="hs-identifier hs-var">cls_kind</span></a><span>
</span><a name="line-292"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308584"><a href="#local-6989586621680308584"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308585"><a href="#local-6989586621680308585"><span class="hs-identifier">pred</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitForAllTys"><span class="hs-identifier hs-var">splitForAllTys</span></a><span> </span><a href="#local-6989586621680308582"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-293"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308586"><a href="#local-6989586621680308586"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitFunTys"><span class="hs-identifier hs-var">splitFunTys</span></a><span> </span><a href="#local-6989586621680308583"><span class="hs-identifier hs-var">cls_kind</span></a><span>
</span><a name="line-294"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#getClassPredTys_maybe"><span class="hs-identifier hs-var">getClassPredTys_maybe</span></a><span> </span><a href="#local-6989586621680308585"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-295"></a><span>           </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680308587"><a href="#local-6989586621680308587"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308588"><a href="#local-6989586621680308588"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308584"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308587"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308588"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308586"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-296"></a><span>           </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal deriving item&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308580"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-comment">-- | Typecheck something within the context of a deriving strategy.</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- This is of particular importance when the deriving strategy is @via@.</span><span>
</span><a name="line-300"></a><span class="hs-comment">-- For instance:</span><span>
</span><a name="line-301"></a><span class="hs-comment">--</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-303"></a><span class="hs-comment">-- deriving via (S a) instance C (T a)</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-305"></a><span class="hs-comment">--</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- We need to typecheck @S a@, and moreover, we need to extend the tyvar</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- environment with @a@ before typechecking @C (T a)@, since @S a@ quantified</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- the type variable @a@.</span><span>
</span><a name="line-309"></a><span class="hs-identifier">tcDerivStrategy</span><span>
</span><a name="line-310"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621680308541"><a href="#local-6989586621680308541"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-311"></a><span>     </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>
</span><a name="line-312"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The deriving strategy</span><span>
</span><a name="line-313"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308541"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The thing to typecheck within the context of the</span><span>
</span><a name="line-314"></a><span>                      </span><span class="hs-comment">-- deriving strategy, which might quantify some type</span><span>
</span><a name="line-315"></a><span>                      </span><span class="hs-comment">-- variables of its own.</span><span>
</span><a name="line-316"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308541"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>     </span><span class="hs-comment">-- ^ The typechecked deriving strategy, all quantified tyvars, and</span><span>
</span><a name="line-318"></a><span>     </span><span class="hs-comment">-- the payload of the typechecked thing.</span><span>
</span><a name="line-319"></a><a name="tcDerivStrategy"><a href="TcHsType.html#tcDerivStrategy"><span class="hs-identifier">tcDerivStrategy</span></a></a><span> </span><a name="local-6989586621680308589"><a href="#local-6989586621680308589"><span class="hs-identifier">user_ctxt</span></a></a><span> </span><a name="local-6989586621680308590"><a href="#local-6989586621680308590"><span class="hs-identifier">mds</span></a></a><span> </span><a name="local-6989586621680308591"><a href="#local-6989586621680308591"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-320"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680308590"><span class="hs-identifier hs-var">mds</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-321"></a><span>      </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680308593"><span class="hs-identifier hs-var">boring_case</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-322"></a><span>      </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680308605"><a href="#local-6989586621680308605"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308606"><a href="#local-6989586621680308606"><span class="hs-identifier">ds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308607"><a href="#local-6989586621680308607"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308608"><a href="#local-6989586621680308608"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680308592"><span class="hs-identifier hs-var">tc_deriv_strategy</span></a><span> </span><a href="#local-6989586621680308605"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-323"></a><span>                    </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621680308606"><span class="hs-identifier hs-var">ds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308607"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308608"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-324"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-325"></a><span>    </span><span class="hs-identifier">tc_deriv_strategy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>
</span><a name="line-326"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308541"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>    </span><a name="local-6989586621680308592"><a href="#local-6989586621680308592"><span class="hs-identifier">tc_deriv_strategy</span></a></a><span> </span><a href="HsDecls.html#StockStrategy"><span class="hs-identifier hs-var">StockStrategy</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308593"><span class="hs-identifier hs-var">boring_case</span></a><span> </span><a href="HsDecls.html#StockStrategy"><span class="hs-identifier hs-var">StockStrategy</span></a><span>
</span><a name="line-328"></a><span>    </span><span class="hs-identifier">tc_deriv_strategy</span><span> </span><a href="HsDecls.html#AnyclassStrategy"><span class="hs-identifier hs-var">AnyclassStrategy</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308593"><span class="hs-identifier hs-var">boring_case</span></a><span> </span><a href="HsDecls.html#AnyclassStrategy"><span class="hs-identifier hs-var">AnyclassStrategy</span></a><span>
</span><a name="line-329"></a><span>    </span><span class="hs-identifier">tc_deriv_strategy</span><span> </span><a href="HsDecls.html#NewtypeStrategy"><span class="hs-identifier hs-var">NewtypeStrategy</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308593"><span class="hs-identifier hs-var">boring_case</span></a><span> </span><a href="HsDecls.html#NewtypeStrategy"><span class="hs-identifier hs-var">NewtypeStrategy</span></a><span>
</span><a name="line-330"></a><span>    </span><span class="hs-identifier">tc_deriv_strategy</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ViaStrategy"><span class="hs-identifier hs-var">ViaStrategy</span></a><span> </span><a name="local-6989586621680308595"><a href="#local-6989586621680308595"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-331"></a><span>      </span><a name="local-6989586621680308596"><a href="#local-6989586621680308596"><span class="hs-identifier">cls_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-332"></a><span>      </span><a name="local-6989586621680308597"><a href="#local-6989586621680308597"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-333"></a><span>             </span><a href="TcHsType.html#tc_hs_sig_type_and_gen"><span class="hs-identifier hs-var">tc_hs_sig_type_and_gen</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SigTypeSkol"><span class="hs-identifier hs-var">SigTypeSkol</span></a><span> </span><a href="#local-6989586621680308589"><span class="hs-identifier hs-var">user_ctxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308595"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308596"><span class="hs-identifier hs-var">cls_kind</span></a><span>
</span><a name="line-334"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308598"><a href="#local-6989586621680308598"><span class="hs-identifier">via_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308599"><a href="#local-6989586621680308599"><span class="hs-identifier">via_pred</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitForAllTys"><span class="hs-identifier hs-var">splitForAllTys</span></a><span> </span><a href="#local-6989586621680308597"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-335"></a><span>      </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><a href="#local-6989586621680308598"><span class="hs-identifier hs-var">via_tvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-336"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680308600"><a href="#local-6989586621680308600"><span class="hs-identifier">thing_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308601"><a href="#local-6989586621680308601"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680308591"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-337"></a><span>        </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ViaStrategy"><span class="hs-identifier hs-var">ViaStrategy</span></a><span> </span><a href="#local-6989586621680308599"><span class="hs-identifier hs-var">via_pred</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308598"><span class="hs-identifier hs-var">via_tvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680308600"><span class="hs-identifier hs-var">thing_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308601"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span>    </span><span class="hs-identifier">boring_case</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680308594"><span class="hs-identifier hs-type">mds</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308594"><span class="hs-identifier hs-type">mds</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308541"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-340"></a><span>    </span><a name="local-6989586621680308593"><a href="#local-6989586621680308593"><span class="hs-identifier">boring_case</span></a></a><span> </span><a name="local-6989586621680308602"><a href="#local-6989586621680308602"><span class="hs-identifier">mds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-341"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621680308603"><a href="#local-6989586621680308603"><span class="hs-identifier">thing_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308604"><a href="#local-6989586621680308604"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680308591"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-342"></a><span>      </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308602"><span class="hs-identifier hs-var">mds</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308603"><span class="hs-identifier hs-var">thing_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308604"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span class="hs-identifier">tcHsClsInstType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>    </span><span class="hs-comment">-- InstDeclCtxt or SpecInstCtxt</span><span>
</span><a name="line-345"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>
</span><a name="line-346"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span class="hs-comment">-- Like tcHsSigType, but for a class instance declaration</span><span>
</span><a name="line-348"></a><a name="tcHsClsInstType"><a href="TcHsType.html#tcHsClsInstType"><span class="hs-identifier">tcHsClsInstType</span></a></a><span> </span><a name="local-6989586621680308609"><a href="#local-6989586621680308609"><span class="hs-identifier">user_ctxt</span></a></a><span> </span><a name="local-6989586621680308610"><a href="#local-6989586621680308610"><span class="hs-identifier">hs_inst_ty</span></a></a><span>
</span><a name="line-349"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsSigType"><span class="hs-identifier hs-var">hsSigType</span></a><span> </span><a href="#local-6989586621680308610"><span class="hs-identifier hs-var">hs_inst_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-350"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308611"><a href="#local-6989586621680308611"><span class="hs-identifier">inst_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_hs_sig_type_and_gen"><span class="hs-identifier hs-var">tc_hs_sig_type_and_gen</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SigTypeSkol"><span class="hs-identifier hs-var">SigTypeSkol</span></a><span> </span><a href="#local-6989586621680308609"><span class="hs-identifier hs-var">user_ctxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308610"><span class="hs-identifier hs-var">hs_inst_ty</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-351"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidInstance"><span class="hs-identifier hs-var">checkValidInstance</span></a><span> </span><a href="#local-6989586621680308609"><span class="hs-identifier hs-var">user_ctxt</span></a><span> </span><a href="#local-6989586621680308610"><span class="hs-identifier hs-var">hs_inst_ty</span></a><span> </span><a href="#local-6989586621680308611"><span class="hs-identifier hs-var">inst_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-comment">----------------------------------------------</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- | Type-check a visible type application</span><span>
</span><a name="line-355"></a><span class="hs-identifier">tcHsTypeApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsWcType"><span class="hs-identifier hs-type">LHsWcType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-356"></a><span class="hs-comment">-- See Note [Recipe for checking a signature] in TcHsType</span><span>
</span><a name="line-357"></a><a name="tcHsTypeApp"><a href="TcHsType.html#tcHsTypeApp"><span class="hs-identifier">tcHsTypeApp</span></a></a><span> </span><a name="local-6989586621680308612"><a href="#local-6989586621680308612"><span class="hs-identifier">wc_ty</span></a></a><span> </span><a name="local-6989586621680308613"><a href="#local-6989586621680308613"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-358"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="HsTypes.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308614"><a href="#local-6989586621680308614"><span class="hs-identifier">sig_wcs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308615"><a href="#local-6989586621680308615"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680308612"><span class="hs-identifier hs-var">wc_ty</span></a><span>
</span><a name="line-359"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308616"><a href="#local-6989586621680308616"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcWildCardBindersX"><span class="hs-identifier hs-var">tcWildCardBindersX</span></a><span> </span><a href="TcHsType.html#newWildTyVar"><span class="hs-identifier hs-var">newWildTyVar</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621680308614"><span class="hs-identifier hs-var">sig_wcs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-360"></a><span>               </span><a href="TcHsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a><span> </span><a href="#local-6989586621680308615"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-6989586621680308613"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-361"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308617"><a href="#local-6989586621680308617"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#zonkPromoteType"><span class="hs-identifier hs-var">zonkPromoteType</span></a><span> </span><a href="#local-6989586621680308616"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-362"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span> </span><a href="TcType.html#TypeAppCtxt"><span class="hs-identifier hs-var">TypeAppCtxt</span></a><span> </span><a href="#local-6989586621680308617"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-363"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680308617"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-364"></a><span>        </span><span class="hs-comment">-- NB: we don't call emitWildcardHoleConstraints here, because</span><span>
</span><a name="line-365"></a><span>        </span><span class="hs-comment">-- we want any holes in visible type applications to be used</span><span>
</span><a name="line-366"></a><span>        </span><span class="hs-comment">-- without fuss. No errors, warnings, extensions, etc.</span><span>
</span><a name="line-367"></a><span class="hs-identifier">tcHsTypeApp</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XHsWildCardBndrs"><span class="hs-identifier hs-var">XHsWildCardBndrs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tcHsTypeApp&quot;</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
            The main kind checker: no validity checks here
*                                                                      *
************************************************************************

        First a couple of simple wrappers for kcHsType
-}</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-380"></a><span class="hs-identifier">tcHsOpenType</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcHsLiftedType</span><span class="hs-special">,</span><span>
</span><a name="line-381"></a><span>  </span><span class="hs-identifier">tcHsOpenTypeNC</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcHsLiftedTypeNC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-382"></a><span class="hs-comment">-- Used for type signatures</span><span>
</span><a name="line-383"></a><span class="hs-comment">-- Do not do validity checking</span><span>
</span><a name="line-384"></a><a name="tcHsOpenType"><a href="TcHsType.html#tcHsOpenType"><span class="hs-identifier">tcHsOpenType</span></a></a><span> </span><a name="local-6989586621680308618"><a href="#local-6989586621680308618"><span class="hs-identifier">ty</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a><span> </span><a href="#local-6989586621680308618"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcHsType.html#tcHsOpenTypeNC"><span class="hs-identifier hs-var">tcHsOpenTypeNC</span></a><span> </span><a href="#local-6989586621680308618"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-385"></a><a name="tcHsLiftedType"><a href="TcHsType.html#tcHsLiftedType"><span class="hs-identifier">tcHsLiftedType</span></a></a><span> </span><a name="local-6989586621680308619"><a href="#local-6989586621680308619"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a><span> </span><a href="#local-6989586621680308619"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcHsType.html#tcHsLiftedTypeNC"><span class="hs-identifier hs-var">tcHsLiftedTypeNC</span></a><span> </span><a href="#local-6989586621680308619"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><a name="tcHsOpenTypeNC"><a href="TcHsType.html#tcHsOpenTypeNC"><span class="hs-identifier">tcHsOpenTypeNC</span></a></a><span>   </span><a name="local-6989586621680308620"><a href="#local-6989586621680308620"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308621"><a href="#local-6989586621680308621"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a><span>
</span><a name="line-388"></a><span>                         </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-6989586621680308620"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308621"><span class="hs-identifier hs-var">ek</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-389"></a><a name="tcHsLiftedTypeNC"><a href="TcHsType.html#tcHsLiftedTypeNC"><span class="hs-identifier">tcHsLiftedTypeNC</span></a></a><span> </span><a name="local-6989586621680308622"><a href="#local-6989586621680308622"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-6989586621680308622"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-comment">-- Like tcHsType, but takes an expected kind</span><span>
</span><a name="line-392"></a><span class="hs-identifier">tcCheckLHsType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-393"></a><a name="tcCheckLHsType"><a href="TcHsType.html#tcCheckLHsType"><span class="hs-identifier">tcCheckLHsType</span></a></a><span> </span><a name="local-6989586621680308623"><a href="#local-6989586621680308623"><span class="hs-identifier">hs_ty</span></a></a><span> </span><a name="local-6989586621680308624"><a href="#local-6989586621680308624"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-394"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a><span> </span><a href="#local-6989586621680308623"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-395"></a><span>    </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-6989586621680308623"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-6989586621680308624"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span class="hs-identifier">tcLHsType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span class="hs-comment">-- Called from outside: set the context</span><span>
</span><a name="line-399"></a><a name="tcLHsType"><a href="TcHsType.html#tcLHsType"><span class="hs-identifier">tcLHsType</span></a></a><span> </span><a name="local-6989586621680308625"><a href="#local-6989586621680308625"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a><span> </span><a href="#local-6989586621680308625"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span> </span><a href="#local-6989586621680308625"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-400"></a><span>
</span><a name="line-401"></a><span class="hs-comment">-- Like tcLHsType, but use it in a context where type synonyms and type families</span><span>
</span><a name="line-402"></a><span class="hs-comment">-- do not need to be saturated, like in a GHCi :kind call</span><span>
</span><a name="line-403"></a><span class="hs-identifier">tcLHsTypeUnsaturated</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-404"></a><a name="tcLHsTypeUnsaturated"><a href="TcHsType.html#tcLHsTypeUnsaturated"><span class="hs-identifier">tcLHsTypeUnsaturated</span></a></a><span> </span><a name="local-6989586621680308626"><a href="#local-6989586621680308626"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a><span> </span><a href="#local-6989586621680308626"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-6989586621680308627"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308626"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-405"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-406"></a><span>    </span><a name="local-6989586621680308627"><a href="#local-6989586621680308627"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#allowUnsaturated"><span class="hs-identifier hs-var">allowUnsaturated</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-409"></a><span class="hs-comment">-- | Should we generalise the kind of this type signature?</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- We *should* generalise if the type is closed</span><span>
</span><a name="line-411"></a><span class="hs-comment">-- or if NoMonoLocalBinds is set. Otherwise, nope.</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- See Note [Kind generalisation plan]</span><span>
</span><a name="line-413"></a><span class="hs-identifier">decideKindGeneralisationPlan</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-414"></a><a name="decideKindGeneralisationPlan"><a href="TcHsType.html#decideKindGeneralisationPlan"><span class="hs-identifier">decideKindGeneralisationPlan</span></a></a><span> </span><a name="local-6989586621680308628"><a href="#local-6989586621680308628"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_ext</span><span>
</span><a name="line-415"></a><span>                                            </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#HsIBRn"><span class="hs-identifier hs-var">HsIBRn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_closed</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308629"><a href="#local-6989586621680308629"><span class="hs-identifier">closed</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-416"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308630"><a href="#local-6989586621680308630"><span class="hs-identifier">mono_locals</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#MonoLocalBinds"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">MonoLocalBinds</span></a><span>
</span><a name="line-417"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308631"><a href="#local-6989586621680308631"><span class="hs-identifier">should_gen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621680308630"><span class="hs-identifier hs-var">mono_locals</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621680308629"><span class="hs-identifier hs-var">closed</span></a><span>
</span><a name="line-418"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;decideKindGeneralisationPlan&quot;</span><span>
</span><a name="line-419"></a><span>           </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308628"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;should gen?&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308631"><span class="hs-identifier hs-var">should_gen</span></a><span class="hs-special">)</span><span>
</span><a name="line-420"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680308631"><span class="hs-identifier hs-var">should_gen</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-421"></a><span class="hs-identifier">decideKindGeneralisationPlan</span><span class="hs-special">(</span><a href="HsTypes.html#XHsImplicitBndrs"><span class="hs-identifier hs-var">XHsImplicitBndrs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;decideKindGeneralisationPlan&quot;</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-comment">{- Note [Kind generalisation plan]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When should we do kind-generalisation for user-written type signature?
Answer: we use the same rule as for value bindings:

 * We always kind-generalise if the type signature is closed
 * Additionally, we attempt to generalise if we have NoMonoLocalBinds

Trac #13337 shows the problem if we kind-generalise an open type (i.e.
one that mentions in-scope type variable
  foo :: forall k (a :: k) proxy. (Typeable k, Typeable a)
      =&gt; proxy a -&gt; String
  foo _ = case eqT :: Maybe (k :~: Type) of
            Nothing   -&gt; ...
            Just Refl -&gt; case eqT :: Maybe (a :~: Int) of ...

In the expression type sig on the last line, we have (a :: k)
but (Int :: Type).  Since (:~:) is kind-homogeneous, this requires
k ~ *, which is true in the Refl branch of the outer case.

That equality will be solved if we allow it to float out to the
implication constraint for the Refl match, but not not if we aggressively
attempt to solve all equalities the moment they occur; that is, when
checking (Maybe (a :~: Int)).   (NB: solveEqualities fails unless it
solves all the kind equalities, which is the right thing at top level.)

So here the right thing is simply not to do kind generalisation!

************************************************************************
*                                                                      *
      Type-checking modes
*                                                                      *
************************************************************************

The kind-checker is parameterised by a TcTyMode, which contains some
information about where we're checking a type.

The renamer issues errors about what it can. All errors issued here must
concern things that the renamer can't handle.

-}</span><span>
</span><a name="line-465"></a><span>
</span><a name="line-466"></a><span class="hs-comment">-- | Info about the context in which we're checking a type. Currently,</span><span>
</span><a name="line-467"></a><span class="hs-comment">-- differentiates only between types and kinds, but this will likely</span><span>
</span><a name="line-468"></a><span class="hs-comment">-- grow, at least to include the distinction between patterns and</span><span>
</span><a name="line-469"></a><span class="hs-comment">-- not-patterns.</span><span>
</span><a name="line-470"></a><span class="hs-keyword">data</span><span> </span><a name="TcTyMode"><a href="TcHsType.html#TcTyMode"><span class="hs-identifier">TcTyMode</span></a></a><span>
</span><a name="line-471"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TcTyMode"><a href="TcHsType.html#TcTyMode"><span class="hs-identifier">TcTyMode</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="mode_level"><a href="TcHsType.html#mode_level"><span class="hs-identifier">mode_level</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span>
</span><a name="line-472"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="mode_unsat"><a href="TcHsType.html#mode_unsat"><span class="hs-identifier">mode_unsat</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>        </span><span class="hs-comment">-- True &lt;=&gt; allow unsaturated type families</span><span>
</span><a name="line-473"></a><span>             </span><span class="hs-special">}</span><span>
</span><a name="line-474"></a><span> </span><span class="hs-comment">-- The mode_unsat field is solely so that type families/synonyms can be unsaturated</span><span>
</span><a name="line-475"></a><span> </span><span class="hs-comment">-- in GHCi :kind calls</span><span>
</span><a name="line-476"></a><span>
</span><a name="line-477"></a><span class="hs-identifier">typeLevelMode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-478"></a><a name="typeLevelMode"><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier">typeLevelMode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-var">TcTyMode</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mode_level</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">mode_unsat</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span class="hs-identifier">kindLevelMode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-481"></a><a name="kindLevelMode"><a href="TcHsType.html#kindLevelMode"><span class="hs-identifier">kindLevelMode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-var">TcTyMode</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mode_level</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">mode_unsat</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span class="hs-identifier">allowUnsaturated</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-484"></a><a name="allowUnsaturated"><a href="TcHsType.html#allowUnsaturated"><span class="hs-identifier">allowUnsaturated</span></a></a><span> </span><a name="local-6989586621680308632"><a href="#local-6989586621680308632"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308632"><span class="hs-identifier hs-var">mode</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mode_unsat</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-485"></a><span>
</span><a name="line-486"></a><span class="hs-comment">-- switch to kind level</span><span>
</span><a name="line-487"></a><span class="hs-identifier">kindLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-488"></a><a name="kindLevel"><a href="TcHsType.html#kindLevel"><span class="hs-identifier">kindLevel</span></a></a><span> </span><a name="local-6989586621680308633"><a href="#local-6989586621680308633"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308633"><span class="hs-identifier hs-var">mode</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mode_level</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-491"></a><span>  </span><a name="local-8214565720323909213"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">mode_level</span><span>
</span><a name="line-492"></a><span>
</span><a name="line-493"></a><span class="hs-comment">{-
Note [Bidirectional type checking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In expressions, whenever we see a polymorphic identifier, say `id`, we are
free to instantiate it with metavariables, knowing that we can always
re-generalize with type-lambdas when necessary. For example:

  rank2 :: (forall a. a -&gt; a) -&gt; ()
  x = rank2 id

When checking the body of `x`, we can instantiate `id` with a metavariable.
Then, when we're checking the application of `rank2`, we notice that we really
need a polymorphic `id`, and then re-generalize over the unconstrained
metavariable.

In types, however, we're not so lucky, because *we cannot re-generalize*!
There is no lambda. So, we must be careful only to instantiate at the last
possible moment, when we're sure we're never going to want the lost polymorphism
again. This is done in calls to tcInstBinders.

To implement this behavior, we use bidirectional type checking, where we
explicitly think about whether we know the kind of the type we're checking
or not. Note that there is a difference between not knowing a kind and
knowing a metavariable kind: the metavariables are TauTvs, and cannot become
forall-quantified kinds. Previously (before dependent types), there were
no higher-rank kinds, and so we could instantiate early and be sure that
no types would have polymorphic kinds, and so we could always assume that
the kind of a type was a fresh metavariable. Not so anymore, thus the
need for two algorithms.

For HsType forms that can never be kind-polymorphic, we implement only the
&quot;down&quot; direction, where we safely assume a metavariable kind. For HsType forms
that *can* be kind-polymorphic, we implement just the &quot;up&quot; (functions with
&quot;infer&quot; in their name) version, as we gain nothing by also implementing the
&quot;down&quot; version.

Note [Future-proofing the type checker]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As discussed in Note [Bidirectional type checking], each HsType form is
handled in *either* tc_infer_hs_type *or* tc_hs_type. These functions
are mutually recursive, so that either one can work for any type former.
But, we want to make sure that our pattern-matches are complete. So,
we have a bunch of repetitive code just so that we get warnings if we're
missing any patterns.

Note [The tcType invariant]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
If    tc_ty = tc_hs_type hs_ty exp_kind
then
      typeKind tc_ty = exp_kind
without any zonking needed.  The reason for this is that in
tcInferApps we see (F ty), and we kind-check 'ty' with an
expected-kind coming from F.  Then, to make the resulting application
well kinded --- see Note [Ensure well-kinded types] in TcType --- we
need the kind-checked 'ty' to have exactly the kind that F expects,
with no funny zonking nonsense in between.

The tcType invariant also applies to checkExpectedKind: if
    (tc_ty, _, _) = checkExpectedKind ty act_ki exp_ki
then
    typeKind tc_ty = exp_ki
-}</span><span>
</span><a name="line-555"></a><span>
</span><a name="line-556"></a><span class="hs-comment">------------------------------------------</span><span>
</span><a name="line-557"></a><span class="hs-comment">-- | Check and desugar a type, returning the core type and its</span><span>
</span><a name="line-558"></a><span class="hs-comment">-- possibly-polymorphic kind. Much like 'tcInferRho' at the expression</span><span>
</span><a name="line-559"></a><span class="hs-comment">-- level.</span><span>
</span><a name="line-560"></a><span class="hs-identifier">tc_infer_lhs_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-561"></a><a name="tc_infer_lhs_type"><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier">tc_infer_lhs_type</span></a></a><span> </span><a name="local-6989586621680308634"><a href="#local-6989586621680308634"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621680308635"><a href="#local-6989586621680308635"><span class="hs-identifier">span</span></a></a><span> </span><a name="local-6989586621680308636"><a href="#local-6989586621680308636"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-562"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621680308635"><span class="hs-identifier hs-var">span</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-563"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308637"><a href="#local-6989586621680308637"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308638"><a href="#local-6989586621680308638"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_hs_type"><span class="hs-identifier hs-var">tc_infer_hs_type</span></a><span> </span><a href="#local-6989586621680308634"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308636"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-564"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308637"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308638"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span class="hs-comment">-- | Infer the kind of a type and desugar. This is the &quot;up&quot; type-checker,</span><span>
</span><a name="line-567"></a><span class="hs-comment">-- as described in Note [Bidirectional type checking]</span><span>
</span><a name="line-568"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#HsType"><span class="hs-identifier hs-type">HsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-569"></a><a name="tc_infer_hs_type"><a href="TcHsType.html#tc_infer_hs_type"><span class="hs-identifier">tc_infer_hs_type</span></a></a><span> </span><a name="local-6989586621680308639"><a href="#local-6989586621680308639"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsParTy"><span class="hs-identifier hs-var">HsParTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308640"><a href="#local-6989586621680308640"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-6989586621680308639"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308640"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-570"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-6989586621680308641"><a href="#local-6989586621680308641"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308642"><a href="#local-6989586621680308642"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcTyVar"><span class="hs-identifier hs-var">tcTyVar</span></a><span> </span><a href="#local-6989586621680308641"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308642"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-571"></a><span>
</span><a name="line-572"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-6989586621680308643"><a href="#local-6989586621680308643"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsAppTy"><span class="hs-identifier hs-var">HsAppTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308644"><a href="#local-6989586621680308644"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621680308645"><a href="#local-6989586621680308645"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-573"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308646"><a href="#local-6989586621680308646"><span class="hs-identifier">hs_fun_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308647"><a href="#local-6989586621680308647"><span class="hs-identifier">hs_arg_tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#splitHsAppTys"><span class="hs-identifier hs-var">splitHsAppTys</span></a><span> </span><a href="#local-6989586621680308644"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680308645"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-574"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308648"><a href="#local-6989586621680308648"><span class="hs-identifier">fun_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308649"><a href="#local-6989586621680308649"><span class="hs-identifier">fun_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-6989586621680308643"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308646"><span class="hs-identifier hs-var">hs_fun_ty</span></a><span>
</span><a name="line-575"></a><span>         </span><span class="hs-comment">-- A worry: what if fun_kind needs zoonking?</span><span>
</span><a name="line-576"></a><span>         </span><span class="hs-comment">-- We used to zonk it here, but that got fun_ty and fun_kind</span><span>
</span><a name="line-577"></a><span>         </span><span class="hs-comment">-- out of sync (see the precondition to tcTyApps), which caused</span><span>
</span><a name="line-578"></a><span>         </span><span class="hs-comment">-- Trac #14873.  So I'm now zonking in tcTyVar, and not here.</span><span>
</span><a name="line-579"></a><span>         </span><span class="hs-comment">-- Is that enough?  Seems so, but I can't see how to be certain.</span><span>
</span><a name="line-580"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#tcTyApps"><span class="hs-identifier hs-var">tcTyApps</span></a><span> </span><a href="#local-6989586621680308643"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308646"><span class="hs-identifier hs-var">hs_fun_ty</span></a><span> </span><a href="#local-6989586621680308648"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621680308649"><span class="hs-identifier hs-var">fun_kind</span></a><span> </span><a href="#local-6989586621680308647"><span class="hs-identifier hs-var">hs_arg_tys</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-6989586621680308650"><a href="#local-6989586621680308650"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsOpTy"><span class="hs-identifier hs-var">HsOpTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308651"><a href="#local-6989586621680308651"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-6989586621680308652"><a href="#local-6989586621680308652"><span class="hs-identifier">lhs_op</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308653"><a href="#local-6989586621680308653"><span class="hs-identifier">hs_op</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308654"><a href="#local-6989586621680308654"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-583"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308653"><span class="hs-identifier hs-var">hs_op</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#funTyConKey"><span class="hs-identifier hs-var">funTyConKey</span></a><span class="hs-special">)</span><span>
</span><a name="line-584"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308655"><a href="#local-6989586621680308655"><span class="hs-identifier">op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308656"><a href="#local-6989586621680308656"><span class="hs-identifier">op_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcTyVar"><span class="hs-identifier hs-var">tcTyVar</span></a><span> </span><a href="#local-6989586621680308650"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308653"><span class="hs-identifier hs-var">hs_op</span></a><span>
</span><a name="line-585"></a><span>         </span><span class="hs-comment">-- See &quot;A worry&quot; in the HsApp case</span><span>
</span><a name="line-586"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#tcTyApps"><span class="hs-identifier hs-var">tcTyApps</span></a><span> </span><a href="#local-6989586621680308650"><span class="hs-identifier hs-var">mode</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsTypes.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a><span> </span><a href="HsExtension.html#noExt"><span class="hs-identifier hs-var">noExt</span></a><span> </span><a href="HsTypes.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a><span> </span><a href="#local-6989586621680308652"><span class="hs-identifier hs-var">lhs_op</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308655"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621680308656"><span class="hs-identifier hs-var">op_kind</span></a><span>
</span><a name="line-587"></a><span>                       </span><span class="hs-special">[</span><a href="#local-6989586621680308651"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308654"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-588"></a><span>
</span><a name="line-589"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-6989586621680308657"><a href="#local-6989586621680308657"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsKindSig"><span class="hs-identifier hs-var">HsKindSig</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308658"><a href="#local-6989586621680308658"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680308659"><a href="#local-6989586621680308659"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308660"><a href="#local-6989586621680308660"><span class="hs-identifier">sig'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_kind"><span class="hs-identifier hs-var">tc_lhs_kind</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#kindLevel"><span class="hs-identifier hs-var">kindLevel</span></a><span> </span><a href="#local-6989586621680308657"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308659"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-591"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tc_infer_hs_type:sig&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308658"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308660"><span class="hs-identifier hs-var">sig'</span></a><span class="hs-special">)</span><span>
</span><a name="line-592"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308661"><a href="#local-6989586621680308661"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308657"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308658"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308660"><span class="hs-identifier hs-var">sig'</span></a><span>
</span><a name="line-593"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308661"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308660"><span class="hs-identifier hs-var">sig'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-594"></a><span>
</span><a name="line-595"></a><span class="hs-comment">-- HsSpliced is an annotation produced by 'RnSplice.rnSpliceType' to communicate</span><span>
</span><a name="line-596"></a><span class="hs-comment">-- the splice location to the typechecker. Here we skip over it in order to have</span><span>
</span><a name="line-597"></a><span class="hs-comment">-- the same kind inferred for a given expression whether it was produced from</span><span>
</span><a name="line-598"></a><span class="hs-comment">-- splices or not.</span><span>
</span><a name="line-599"></a><span class="hs-comment">--</span><span>
</span><a name="line-600"></a><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices].</span><span>
</span><a name="line-601"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-6989586621680308662"><a href="#local-6989586621680308662"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsSpliceTy"><span class="hs-identifier hs-var">HsSpliceTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsSpliced"><span class="hs-identifier hs-var">HsSpliced</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsSplicedTy"><span class="hs-identifier hs-var">HsSplicedTy</span></a><span> </span><a name="local-6989586621680308663"><a href="#local-6989586621680308663"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-602"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type"><span class="hs-identifier hs-var">tc_infer_hs_type</span></a><span> </span><a href="#local-6989586621680308662"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308663"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-603"></a><span>
</span><a name="line-604"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-6989586621680308664"><a href="#local-6989586621680308664"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsDocTy"><span class="hs-identifier hs-var">HsDocTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308665"><a href="#local-6989586621680308665"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-6989586621680308664"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308665"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-605"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">(</span><a href="HsTypes.html#XHsType"><span class="hs-identifier hs-var">XHsType</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#NHsCoreTy"><span class="hs-identifier hs-var">NHsCoreTy</span></a><span> </span><a name="local-6989586621680308666"><a href="#local-6989586621680308666"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308666"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621680308666"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-606"></a><span class="hs-identifier">tc_infer_hs_type</span><span> </span><a name="local-6989586621680308667"><a href="#local-6989586621680308667"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308668"><a href="#local-6989586621680308668"><span class="hs-identifier">other_ty</span></a></a><span>
</span><a name="line-607"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308669"><a href="#local-6989586621680308669"><span class="hs-identifier">kv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-608"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308670"><a href="#local-6989586621680308670"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_hs_type"><span class="hs-identifier hs-var">tc_hs_type</span></a><span> </span><a href="#local-6989586621680308667"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308668"><span class="hs-identifier hs-var">other_ty</span></a><span> </span><a href="#local-6989586621680308669"><span class="hs-identifier hs-var">kv</span></a><span>
</span><a name="line-609"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308670"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308669"><span class="hs-identifier hs-var">kv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-610"></a><span>
</span><a name="line-611"></a><span class="hs-comment">------------------------------------------</span><span>
</span><a name="line-612"></a><span class="hs-identifier">tc_lhs_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-613"></a><a name="tc_lhs_type"><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier">tc_lhs_type</span></a></a><span> </span><a name="local-6989586621680308671"><a href="#local-6989586621680308671"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621680308672"><a href="#local-6989586621680308672"><span class="hs-identifier">span</span></a></a><span> </span><a name="local-6989586621680308673"><a href="#local-6989586621680308673"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308674"><a href="#local-6989586621680308674"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-614"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621680308672"><span class="hs-identifier hs-var">span</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-615"></a><span>    </span><a href="TcHsType.html#tc_hs_type"><span class="hs-identifier hs-var">tc_hs_type</span></a><span> </span><a href="#local-6989586621680308671"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308673"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308674"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-616"></a><span>
</span><a name="line-617"></a><span class="hs-comment">------------------------------------------</span><span>
</span><a name="line-618"></a><span class="hs-identifier">tc_fun_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>
</span><a name="line-619"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-620"></a><a name="tc_fun_type"><a href="TcHsType.html#tc_fun_type"><span class="hs-identifier">tc_fun_type</span></a></a><span> </span><a name="local-6989586621680308675"><a href="#local-6989586621680308675"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308676"><a href="#local-6989586621680308676"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621680308677"><a href="#local-6989586621680308677"><span class="hs-identifier">ty2</span></a></a><span> </span><a name="local-6989586621680308678"><a href="#local-6989586621680308678"><span class="hs-identifier">exp_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">mode_level</span><span> </span><a href="#local-6989586621680308675"><span class="hs-identifier hs-var">mode</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-621"></a><span>  </span><a href="TcRnTypes.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-622"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308679"><a href="#local-6989586621680308679"><span class="hs-identifier">arg_k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a><span>
</span><a name="line-623"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308680"><a href="#local-6989586621680308680"><span class="hs-identifier">res_k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a><span>
</span><a name="line-624"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308681"><a href="#local-6989586621680308681"><span class="hs-identifier">ty1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308675"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308676"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621680308679"><span class="hs-identifier hs-var">arg_k</span></a><span>
</span><a name="line-625"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308682"><a href="#local-6989586621680308682"><span class="hs-identifier">ty2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308675"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308677"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-6989586621680308680"><span class="hs-identifier hs-var">res_k</span></a><span>
</span><a name="line-626"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsFunTy"><span class="hs-identifier hs-var">HsFunTy</span></a><span> </span><a href="HsExtension.html#noExt"><span class="hs-identifier hs-var">noExt</span></a><span> </span><a href="#local-6989586621680308676"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621680308677"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><a href="#local-6989586621680308681"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-6989586621680308682"><span class="hs-identifier hs-var">ty2'</span></a><span class="hs-special">)</span><span>
</span><a name="line-627"></a><span>                           </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><a href="#local-6989586621680308678"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-628"></a><span>  </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-comment">-- no representation polymorphism in kinds. yet.</span><span>
</span><a name="line-629"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308683"><a href="#local-6989586621680308683"><span class="hs-identifier">ty1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308675"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308676"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-630"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308684"><a href="#local-6989586621680308684"><span class="hs-identifier">ty2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308675"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308677"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-631"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsFunTy"><span class="hs-identifier hs-var">HsFunTy</span></a><span> </span><a href="HsExtension.html#noExt"><span class="hs-identifier hs-var">noExt</span></a><span> </span><a href="#local-6989586621680308676"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621680308677"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><a href="#local-6989586621680308683"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-6989586621680308684"><span class="hs-identifier hs-var">ty2'</span></a><span class="hs-special">)</span><span>
</span><a name="line-632"></a><span>                           </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><a href="#local-6989586621680308678"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span class="hs-comment">------------------------------------------</span><span>
</span><a name="line-635"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#HsType"><span class="hs-identifier hs-type">HsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-636"></a><span class="hs-comment">-- See Note [The tcType invariant]</span><span>
</span><a name="line-637"></a><span class="hs-comment">-- See Note [Bidirectional type checking]</span><span>
</span><a name="line-638"></a><span>
</span><a name="line-639"></a><a name="tc_hs_type"><a href="TcHsType.html#tc_hs_type"><span class="hs-identifier">tc_hs_type</span></a></a><span> </span><a name="local-6989586621680308685"><a href="#local-6989586621680308685"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsParTy"><span class="hs-identifier hs-var">HsParTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308686"><a href="#local-6989586621680308686"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>   </span><a name="local-6989586621680308687"><a href="#local-6989586621680308687"><span class="hs-identifier">exp_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308685"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308686"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308687"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-640"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308688"><a href="#local-6989586621680308688"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsDocTy"><span class="hs-identifier hs-var">HsDocTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308689"><a href="#local-6989586621680308689"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680308690"><a href="#local-6989586621680308690"><span class="hs-identifier">exp_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308688"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308689"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308690"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-641"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308691"><a href="#local-6989586621680308691"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsBangTy"><span class="hs-identifier hs-var">HsBangTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308692"><a href="#local-6989586621680308692"><span class="hs-identifier">bang</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-642"></a><span>    </span><span class="hs-comment">-- While top-level bangs at this point are eliminated (eg !(Maybe Int)),</span><span>
</span><a name="line-643"></a><span>    </span><span class="hs-comment">-- other kinds of bangs are not (eg ((!Maybe) Int)). These kinds of</span><span>
</span><a name="line-644"></a><span>    </span><span class="hs-comment">-- bangs are invalid, so fail. (#7210, #14761)</span><span>
</span><a name="line-645"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308693"><a href="#local-6989586621680308693"><span class="hs-identifier">bangError</span></a></a><span> </span><a name="local-6989586621680308694"><a href="#local-6989586621680308694"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-646"></a><span>                 </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Unexpected&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621680308694"><span class="hs-identifier hs-var">err</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;annotation:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308691"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-647"></a><span>                 </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621680308694"><span class="hs-identifier hs-var">err</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;annotation cannot appear nested inside a type&quot;</span><span>
</span><a name="line-648"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680308692"><span class="hs-identifier hs-var">bang</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-649"></a><span>             </span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-var">HsSrcBang</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="DataCon.html#SrcUnpack"><span class="hs-identifier hs-var">SrcUnpack</span></a><span> </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680308693"><span class="hs-identifier hs-var">bangError</span></a><span> </span><span class="hs-string">&quot;UNPACK&quot;</span><span>
</span><a name="line-650"></a><span>             </span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-var">HsSrcBang</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="DataCon.html#SrcNoUnpack"><span class="hs-identifier hs-var">SrcNoUnpack</span></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680308693"><span class="hs-identifier hs-var">bangError</span></a><span> </span><span class="hs-string">&quot;NOUNPACK&quot;</span><span>
</span><a name="line-651"></a><span>             </span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-var">HsSrcBang</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="DataCon.html#NoSrcUnpack"><span class="hs-identifier hs-var">NoSrcUnpack</span></a><span> </span><a href="DataCon.html#SrcLazy"><span class="hs-identifier hs-var">SrcLazy</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680308693"><span class="hs-identifier hs-var">bangError</span></a><span> </span><span class="hs-string">&quot;laziness&quot;</span><span>
</span><a name="line-652"></a><span>             </span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-var">HsSrcBang</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680308693"><span class="hs-identifier hs-var">bangError</span></a><span> </span><span class="hs-string">&quot;strictness&quot;</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-653"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308695"><a href="#local-6989586621680308695"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsRecTy"><span class="hs-identifier hs-var">HsRecTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-identifier">_</span><span>
</span><a name="line-654"></a><span>      </span><span class="hs-comment">-- Record types (which only show up temporarily in constructor</span><span>
</span><a name="line-655"></a><span>      </span><span class="hs-comment">-- signatures) should have been removed by now</span><span>
</span><a name="line-656"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Record syntax is illegal here:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308695"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-657"></a><span>
</span><a name="line-658"></a><span class="hs-comment">-- HsSpliced is an annotation produced by 'RnSplice.rnSpliceType'.</span><span>
</span><a name="line-659"></a><span class="hs-comment">-- Here we get rid of it and add the finalizers to the global environment</span><span>
</span><a name="line-660"></a><span class="hs-comment">-- while capturing the local environment.</span><span>
</span><a name="line-661"></a><span class="hs-comment">--</span><span>
</span><a name="line-662"></a><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices].</span><span>
</span><a name="line-663"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308696"><a href="#local-6989586621680308696"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsSpliceTy"><span class="hs-identifier hs-var">HsSpliceTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsSpliced"><span class="hs-identifier hs-var">HsSpliced</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308697"><a href="#local-6989586621680308697"><span class="hs-identifier">mod_finalizers</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsSplicedTy"><span class="hs-identifier hs-var">HsSplicedTy</span></a><span> </span><a name="local-6989586621680308698"><a href="#local-6989586621680308698"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-664"></a><span>           </span><a name="local-6989586621680308699"><a href="#local-6989586621680308699"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-665"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="TcRnMonad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var">addModFinalizersWithLclEnv</span></a><span> </span><a href="#local-6989586621680308697"><span class="hs-identifier hs-var">mod_finalizers</span></a><span>
</span><a name="line-666"></a><span>       </span><a href="TcHsType.html#tc_hs_type"><span class="hs-identifier hs-var">tc_hs_type</span></a><span> </span><a href="#local-6989586621680308696"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308698"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308699"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-667"></a><span>
</span><a name="line-668"></a><span class="hs-comment">-- This should never happen; type splices are expanded by the renamer</span><span>
</span><a name="line-669"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308700"><a href="#local-6989586621680308700"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsSpliceTy"><span class="hs-identifier hs-var">HsSpliceTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680308701"><a href="#local-6989586621680308701"><span class="hs-identifier">_exp_kind</span></a></a><span>
</span><a name="line-670"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Unexpected type splice:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308700"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span class="hs-comment">---------- Functions and applications</span><span>
</span><a name="line-673"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308702"><a href="#local-6989586621680308702"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsFunTy"><span class="hs-identifier hs-var">HsFunTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308703"><a href="#local-6989586621680308703"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621680308704"><a href="#local-6989586621680308704"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308705"><a href="#local-6989586621680308705"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-674"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_fun_type"><span class="hs-identifier hs-var">tc_fun_type</span></a><span> </span><a href="#local-6989586621680308702"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308703"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621680308704"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-6989586621680308705"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-675"></a><span>
</span><a name="line-676"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308706"><a href="#local-6989586621680308706"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsOpTy"><span class="hs-identifier hs-var">HsOpTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308707"><a href="#local-6989586621680308707"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308708"><a href="#local-6989586621680308708"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308709"><a href="#local-6989586621680308709"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308710"><a href="#local-6989586621680308710"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-677"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680308708"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#funTyConKey"><span class="hs-identifier hs-var">funTyConKey</span></a><span>
</span><a name="line-678"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_fun_type"><span class="hs-identifier hs-var">tc_fun_type</span></a><span> </span><a href="#local-6989586621680308706"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308707"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621680308709"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-6989586621680308710"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-679"></a><span>
</span><a name="line-680"></a><span class="hs-comment">--------- Foralls</span><span>
</span><a name="line-681"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308711"><a href="#local-6989586621680308711"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-keyword">forall</span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsForAllTy"><span class="hs-identifier hs-var">HsForAllTy</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308713"><a href="#local-6989586621680308713"><span class="hs-identifier">hs_tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308714"><a href="#local-6989586621680308714"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680308715"><a href="#local-6989586621680308715"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-682"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308716"><a href="#local-6989586621680308716"><span class="hs-identifier">tvs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308717"><a href="#local-6989586621680308717"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcExplicitTKBndrs"><span class="hs-identifier hs-var">tcExplicitTKBndrs</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ForAllSkol"><span class="hs-identifier hs-var">ForAllSkol</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-keyword">forall</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308713"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-683"></a><span>                        </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308711"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308714"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308715"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-684"></a><span>    </span><span class="hs-comment">-- Do not kind-generalise here!  See Note [Kind generalisation]</span><span>
</span><a name="line-685"></a><span>    </span><span class="hs-comment">-- Why exp_kind?  See Note [Body kind of HsForAllTy]</span><span>
</span><a name="line-686"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308718"><a href="#local-6989586621680308718"><span class="hs-identifier">bndrs</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkTyVarBinders"><span class="hs-identifier hs-var">mkTyVarBinders</span></a><span> </span><a href="Var.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span> </span><a href="#local-6989586621680308716"><span class="hs-identifier hs-var">tvs'</span></a><span>
</span><a name="line-687"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span> </span><a href="#local-6989586621680308718"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-6989586621680308717"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308719"><a href="#local-6989586621680308719"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsQualTy"><span class="hs-identifier hs-var">HsQualTy</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308720"><a href="#local-6989586621680308720"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680308721"><a href="#local-6989586621680308721"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680308722"><a href="#local-6989586621680308722"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-690"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621680308720"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-691"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308719"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308721"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308722"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-692"></a><span>
</span><a name="line-693"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-694"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308723"><a href="#local-6989586621680308723"><span class="hs-identifier">ctxt'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_hs_context"><span class="hs-identifier hs-var">tc_hs_context</span></a><span> </span><a href="#local-6989586621680308719"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308720"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-695"></a><span>
</span><a name="line-696"></a><span>         </span><span class="hs-comment">-- See Note [Body kind of a HsQualTy]</span><span>
</span><a name="line-697"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308726"><a href="#local-6989586621680308726"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Kind.html#isConstraintKind"><span class="hs-identifier hs-var">isConstraintKind</span></a><span> </span><a href="#local-6989586621680308722"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-698"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308719"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308721"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-699"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308724"><a href="#local-6989586621680308724"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a><span>
</span><a name="line-700"></a><span>                                </span><span class="hs-comment">-- The body kind (result of the function)</span><span>
</span><a name="line-701"></a><span>                                </span><span class="hs-comment">-- can be * or #, hence newOpenTypeKind</span><span>
</span><a name="line-702"></a><span>                        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308725"><a href="#local-6989586621680308725"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308719"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308721"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308724"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-703"></a><span>                        </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621680308721"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308725"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><a href="#local-6989586621680308722"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-704"></a><span>
</span><a name="line-705"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a><span> </span><a href="#local-6989586621680308723"><span class="hs-identifier hs-var">ctxt'</span></a><span> </span><a href="#local-6989586621680308726"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-706"></a><span>
</span><a name="line-707"></a><span class="hs-comment">--------- Lists, arrays, and tuples</span><span>
</span><a name="line-708"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308727"><a href="#local-6989586621680308727"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308728"><a href="#local-6989586621680308728"><span class="hs-identifier">rn_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsListTy"><span class="hs-identifier hs-var">HsListTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308729"><a href="#local-6989586621680308729"><span class="hs-identifier">elt_ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308730"><a href="#local-6989586621680308730"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-709"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308731"><a href="#local-6989586621680308731"><span class="hs-identifier">tau_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308727"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308729"><span class="hs-identifier hs-var">elt_ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-710"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="LoadIface.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a><span> </span><a href="TysWiredIn.html#listTyCon"><span class="hs-identifier hs-var">listTyCon</span></a><span>
</span><a name="line-711"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308728"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#mkListTy"><span class="hs-identifier hs-var">mkListTy</span></a><span> </span><a href="#local-6989586621680308731"><span class="hs-identifier hs-var">tau_ty</span></a><span class="hs-special">)</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><a href="#local-6989586621680308730"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-712"></a><span>
</span><a name="line-713"></a><span class="hs-comment">-- See Note [Distinguishing tuple kinds] in HsTypes</span><span>
</span><a name="line-714"></a><span class="hs-comment">-- See Note [Inferring tuple kinds]</span><span>
</span><a name="line-715"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308732"><a href="#local-6989586621680308732"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308733"><a href="#local-6989586621680308733"><span class="hs-identifier">rn_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsTupleTy"><span class="hs-identifier hs-var">HsTupleTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="HsTypes.html#HsBoxedOrConstraintTuple"><span class="hs-identifier hs-var">HsBoxedOrConstraintTuple</span></a><span> </span><a name="local-6989586621680308734"><a href="#local-6989586621680308734"><span class="hs-identifier">hs_tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308735"><a href="#local-6989586621680308735"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-716"></a><span>     </span><span class="hs-comment">-- (NB: not zonking before looking at exp_k, to avoid left-right bias)</span><span>
</span><a name="line-717"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680308736"><a href="#local-6989586621680308736"><span class="hs-identifier">tup_sort</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a><span> </span><a href="#local-6989586621680308735"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-718"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tc_hs_type tuple&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308734"><span class="hs-identifier hs-var">hs_tys</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span>
</span><a name="line-719"></a><span>    </span><a href="TcHsType.html#tc_tuple"><span class="hs-identifier hs-var">tc_tuple</span></a><span> </span><a href="#local-6989586621680308733"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><a href="#local-6989586621680308732"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308736"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><a href="#local-6989586621680308734"><span class="hs-identifier hs-var">hs_tys</span></a><span> </span><a href="#local-6989586621680308735"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-720"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-721"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tc_hs_type tuple 2&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308734"><span class="hs-identifier hs-var">hs_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-722"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308737"><a href="#local-6989586621680308737"><span class="hs-identifier">tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308738"><a href="#local-6989586621680308738"><span class="hs-identifier">kinds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-6989586621680308732"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308734"><span class="hs-identifier hs-var">hs_tys</span></a><span>
</span><a name="line-723"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308739"><a href="#local-6989586621680308739"><span class="hs-identifier">kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621680308738"><span class="hs-identifier hs-var">kinds</span></a><span>
</span><a name="line-724"></a><span>           </span><span class="hs-comment">-- Infer each arg type separately, because errors can be</span><span>
</span><a name="line-725"></a><span>           </span><span class="hs-comment">-- confusing if we give them a shared kind.  Eg Trac #7410</span><span>
</span><a name="line-726"></a><span>           </span><span class="hs-comment">-- (Either Int, Int), we do not want to get an error saying</span><span>
</span><a name="line-727"></a><span>           </span><span class="hs-comment">-- &quot;the second argument of a tuple should have kind *-&gt;*&quot;</span><span>
</span><a name="line-728"></a><span>
</span><a name="line-729"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308740"><a href="#local-6989586621680308740"><span class="hs-identifier">arg_kind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308741"><a href="#local-6989586621680308741"><span class="hs-identifier">tup_sort</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-730"></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308742"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><a href="#local-6989586621680308743"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680308742"><a href="#local-6989586621680308742"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680308739"><span class="hs-identifier hs-var">kinds</span></a><span>
</span><a name="line-731"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680308743"><a href="#local-6989586621680308743"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="TcHsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a><span> </span><a href="#local-6989586621680308742"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-732"></a><span>                    </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621680308744"><a href="#local-6989586621680308744"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621680308745"><a href="#local-6989586621680308745"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308744"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><a href="#local-6989586621680308745"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-733"></a><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span class="hs-special">)</span><span>
</span><a name="line-734"></a><span>         </span><span class="hs-comment">-- In the [] case, it's not clear what the kind is, so guess *</span><span>
</span><a name="line-735"></a><span>
</span><a name="line-736"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308750"><a href="#local-6989586621680308750"><span class="hs-identifier">tys'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#sequence"><span class="hs-identifier hs-var">sequence</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621680308746"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-737"></a><span>                            </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308747"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-6989586621680308748"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308749"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-6989586621680308740"><span class="hs-identifier hs-var">arg_kind</span></a><span>
</span><a name="line-738"></a><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621680308746"><a href="#local-6989586621680308746"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621680308747"><a href="#local-6989586621680308747"><span class="hs-identifier">hs_ty</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621680308748"><a href="#local-6989586621680308748"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><a name="local-6989586621680308749"><a href="#local-6989586621680308749"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a><span> </span><a href="#local-6989586621680308734"><span class="hs-identifier hs-var">hs_tys</span></a><span> </span><a href="#local-6989586621680308737"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-6989586621680308739"><span class="hs-identifier hs-var">kinds</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-739"></a><span>
</span><a name="line-740"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#finish_tuple"><span class="hs-identifier hs-var">finish_tuple</span></a><span> </span><a href="#local-6989586621680308733"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><a href="#local-6989586621680308741"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><a href="#local-6989586621680308750"><span class="hs-identifier hs-var">tys'</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="#local-6989586621680308740"><span class="hs-identifier hs-var">arg_kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308750"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308735"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span>
</span><a name="line-743"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308751"><a href="#local-6989586621680308751"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308752"><a href="#local-6989586621680308752"><span class="hs-identifier">rn_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsTupleTy"><span class="hs-identifier hs-var">HsTupleTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308753"><a href="#local-6989586621680308753"><span class="hs-identifier">hs_tup_sort</span></a></a><span> </span><a name="local-6989586621680308754"><a href="#local-6989586621680308754"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308755"><a href="#local-6989586621680308755"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-744"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_tuple"><span class="hs-identifier hs-var">tc_tuple</span></a><span> </span><a href="#local-6989586621680308752"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><a href="#local-6989586621680308751"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308756"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><a href="#local-6989586621680308754"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-6989586621680308755"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-745"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-746"></a><span>    </span><a name="local-6989586621680308756"><a href="#local-6989586621680308756"><span class="hs-identifier">tup_sort</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680308753"><span class="hs-identifier hs-var">hs_tup_sort</span></a><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- Fourth case dealt with above</span><span>
</span><a name="line-747"></a><span>                  </span><a href="HsTypes.html#HsUnboxedTuple"><span class="hs-identifier hs-var">HsUnboxedTuple</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span>
</span><a name="line-748"></a><span>                  </span><a href="HsTypes.html#HsBoxedTuple"><span class="hs-identifier hs-var">HsBoxedTuple</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>
</span><a name="line-749"></a><span>                  </span><a href="HsTypes.html#HsConstraintTuple"><span class="hs-identifier hs-var">HsConstraintTuple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span>
</span><a name="line-750"></a><span>                  </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tc_hs_type HsTupleTy&quot;</span><span>
</span><a name="line-751"></a><span>
</span><a name="line-752"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308757"><a href="#local-6989586621680308757"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308758"><a href="#local-6989586621680308758"><span class="hs-identifier">rn_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsSumTy"><span class="hs-identifier hs-var">HsSumTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308759"><a href="#local-6989586621680308759"><span class="hs-identifier">hs_tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308760"><a href="#local-6989586621680308760"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-753"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308761"><a href="#local-6989586621680308761"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621680308759"><span class="hs-identifier hs-var">hs_tys</span></a><span>
</span><a name="line-754"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308762"><a href="#local-6989586621680308762"><span class="hs-identifier">arg_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308759"><span class="hs-identifier hs-var">hs_tys</span></a><span>
</span><a name="line-755"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308763"><a href="#local-6989586621680308763"><span class="hs-identifier">tau_tys</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308757"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308759"><span class="hs-identifier hs-var">hs_tys</span></a><span> </span><a href="#local-6989586621680308762"><span class="hs-identifier hs-var">arg_kinds</span></a><span>
</span><a name="line-756"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308764"><a href="#local-6989586621680308764"><span class="hs-identifier">arg_reps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Type.html#getRuntimeRepFromKind"><span class="hs-identifier hs-var">getRuntimeRepFromKind</span></a><span> </span><a href="#local-6989586621680308762"><span class="hs-identifier hs-var">arg_kinds</span></a><span>
</span><a name="line-757"></a><span>             </span><a name="local-6989586621680308765"><a href="#local-6989586621680308765"><span class="hs-identifier">arg_tys</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308764"><span class="hs-identifier hs-var">arg_reps</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680308763"><span class="hs-identifier hs-var">tau_tys</span></a><span>
</span><a name="line-758"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308758"><span class="hs-identifier hs-var">rn_ty</span></a><span>
</span><a name="line-759"></a><span>                           </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#sumTyCon"><span class="hs-identifier hs-var">sumTyCon</span></a><span> </span><a href="#local-6989586621680308761"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308765"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-760"></a><span>                           </span><span class="hs-special">(</span><a href="TysWiredIn.html#unboxedSumKind"><span class="hs-identifier hs-var">unboxedSumKind</span></a><span> </span><a href="#local-6989586621680308764"><span class="hs-identifier hs-var">arg_reps</span></a><span class="hs-special">)</span><span>
</span><a name="line-761"></a><span>                           </span><a href="#local-6989586621680308760"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-762"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-763"></a><span>
</span><a name="line-764"></a><span class="hs-comment">--------- Promoted lists and tuples</span><span>
</span><a name="line-765"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308766"><a href="#local-6989586621680308766"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308767"><a href="#local-6989586621680308767"><span class="hs-identifier">rn_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsExplicitListTy"><span class="hs-identifier hs-var">HsExplicitListTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308768"><a href="#local-6989586621680308768"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308769"><a href="#local-6989586621680308769"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-766"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308776"><a href="#local-6989586621680308776"><span class="hs-identifier">tks</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-6989586621680308766"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308768"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-767"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308777"><a href="#local-6989586621680308777"><span class="hs-identifier">taus'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308778"><a href="#local-6989586621680308778"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#unifyKinds"><span class="hs-identifier hs-var">unifyKinds</span></a><span> </span><a href="#local-6989586621680308768"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-6989586621680308776"><span class="hs-identifier hs-var">tks</span></a><span>
</span><a name="line-768"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308779"><a href="#local-6989586621680308779"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308770"><span class="hs-identifier hs-var">mk_cons</span></a><span> </span><a href="#local-6989586621680308778"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308771"><span class="hs-identifier hs-var">mk_nil</span></a><span> </span><a href="#local-6989586621680308778"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308777"><span class="hs-identifier hs-var">taus'</span></a><span class="hs-special">)</span><span>
</span><a name="line-769"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308767"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><a href="#local-6989586621680308779"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#mkListTy"><span class="hs-identifier hs-var">mkListTy</span></a><span> </span><a href="#local-6989586621680308778"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308769"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-770"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-771"></a><span>    </span><a name="local-6989586621680308770"><a href="#local-6989586621680308770"><span class="hs-identifier">mk_cons</span></a></a><span> </span><a name="local-6989586621680308772"><a href="#local-6989586621680308772"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621680308773"><a href="#local-6989586621680308773"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621680308774"><a href="#local-6989586621680308774"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a><span> </span><a href="TysWiredIn.html#consDataCon"><span class="hs-identifier hs-var">consDataCon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680308772"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308773"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308774"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-772"></a><span>    </span><a name="local-6989586621680308771"><a href="#local-6989586621680308771"><span class="hs-identifier">mk_nil</span></a></a><span>  </span><a name="local-6989586621680308775"><a href="#local-6989586621680308775"><span class="hs-identifier">k</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a><span> </span><a href="TysWiredIn.html#nilDataCon"><span class="hs-identifier hs-var">nilDataCon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680308775"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">]</span><span>
</span><a name="line-773"></a><span>
</span><a name="line-774"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308780"><a href="#local-6989586621680308780"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308781"><a href="#local-6989586621680308781"><span class="hs-identifier">rn_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsExplicitTupleTy"><span class="hs-identifier hs-var">HsExplicitTupleTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308782"><a href="#local-6989586621680308782"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308783"><a href="#local-6989586621680308783"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-775"></a><span>  </span><span class="hs-comment">-- using newMetaKindVar means that we force instantiations of any polykinded</span><span>
</span><a name="line-776"></a><span>  </span><span class="hs-comment">-- types. At first, I just used tc_infer_lhs_type, but that led to #11255.</span><span>
</span><a name="line-777"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308785"><a href="#local-6989586621680308785"><span class="hs-identifier">ks</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a><span> </span><a href="#local-6989586621680308784"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-778"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308786"><a href="#local-6989586621680308786"><span class="hs-identifier">taus</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308780"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308782"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-6989586621680308785"><span class="hs-identifier hs-var">ks</span></a><span>
</span><a name="line-779"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308787"><a href="#local-6989586621680308787"><span class="hs-identifier">kind_con</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a><span>           </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span> </span><a href="#local-6989586621680308784"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-780"></a><span>             </span><a name="local-6989586621680308788"><a href="#local-6989586621680308788"><span class="hs-identifier">ty_con</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#promotedTupleDataCon"><span class="hs-identifier hs-var">promotedTupleDataCon</span></a><span> </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span> </span><a href="#local-6989586621680308784"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-781"></a><span>             </span><a name="local-6989586621680308789"><a href="#local-6989586621680308789"><span class="hs-identifier">tup_k</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621680308787"><span class="hs-identifier hs-var">kind_con</span></a><span> </span><a href="#local-6989586621680308785"><span class="hs-identifier hs-var">ks</span></a><span>
</span><a name="line-782"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308781"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621680308788"><span class="hs-identifier hs-var">ty_con</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308785"><span class="hs-identifier hs-var">ks</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680308786"><span class="hs-identifier hs-var">taus</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308789"><span class="hs-identifier hs-var">tup_k</span></a><span> </span><a href="#local-6989586621680308783"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-783"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-784"></a><span>    </span><a name="local-6989586621680308784"><a href="#local-6989586621680308784"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621680308782"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-785"></a><span>
</span><a name="line-786"></a><span class="hs-comment">--------- Constraint types</span><span>
</span><a name="line-787"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308790"><a href="#local-6989586621680308790"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308791"><a href="#local-6989586621680308791"><span class="hs-identifier">rn_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsIParamTy"><span class="hs-identifier hs-var">HsIParamTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308792"><a href="#local-6989586621680308792"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308793"><a href="#local-6989586621680308793"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308794"><a href="#local-6989586621680308794"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-788"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTypeLevel</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">mode_level</span></a><span> </span><span class="hs-identifier">mode</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-789"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308795"><a href="#local-6989586621680308795"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308790"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308793"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-790"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308796"><a href="#local-6989586621680308796"><span class="hs-identifier">n'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsTypes.html#hsIPNameFS"><span class="hs-identifier hs-var">hsIPNameFS</span></a><span> </span><a href="#local-6989586621680308792"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-791"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308797"><a href="#local-6989586621680308797"><span class="hs-identifier">ipClass</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a><span> </span><a href="PrelNames.html#ipClassName"><span class="hs-identifier hs-var">ipClassName</span></a><span>
</span><a name="line-792"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308791"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a><span> </span><a href="#local-6989586621680308797"><span class="hs-identifier hs-var">ipClass</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680308796"><span class="hs-identifier hs-var">n'</span></a><span class="hs-special">,</span><a href="#local-6989586621680308795"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-793"></a><span>           </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span> </span><a href="#local-6989586621680308794"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-794"></a><span>
</span><a name="line-795"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308798"><a href="#local-6989586621680308798"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308799"><a href="#local-6989586621680308799"><span class="hs-identifier">rn_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsEqTy"><span class="hs-identifier hs-var">HsEqTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308800"><a href="#local-6989586621680308800"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621680308801"><a href="#local-6989586621680308801"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308802"><a href="#local-6989586621680308802"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-796"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308803"><a href="#local-6989586621680308803"><span class="hs-identifier">ty1'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308804"><a href="#local-6989586621680308804"><span class="hs-identifier">kind1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-6989586621680308798"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308800"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-797"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308805"><a href="#local-6989586621680308805"><span class="hs-identifier">ty2'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308806"><a href="#local-6989586621680308806"><span class="hs-identifier">kind2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a><span> </span><a href="#local-6989586621680308798"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308801"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-798"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308807"><a href="#local-6989586621680308807"><span class="hs-identifier">ty2''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621680308801"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308805"><span class="hs-identifier hs-var">ty2'</span></a><span> </span><a href="#local-6989586621680308806"><span class="hs-identifier hs-var">kind2</span></a><span> </span><a href="#local-6989586621680308804"><span class="hs-identifier hs-var">kind1</span></a><span>
</span><a name="line-799"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308808"><a href="#local-6989586621680308808"><span class="hs-identifier">eq_tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a><span> </span><a href="PrelNames.html#eqTyConName"><span class="hs-identifier hs-var">eqTyConName</span></a><span>
</span><a name="line-800"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308809"><a href="#local-6989586621680308809"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkNakedTyConApp"><span class="hs-identifier hs-var">mkNakedTyConApp</span></a><span> </span><a href="#local-6989586621680308808"><span class="hs-identifier hs-var">eq_tc</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680308804"><span class="hs-identifier hs-var">kind1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308803"><span class="hs-identifier hs-var">ty1'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308807"><span class="hs-identifier hs-var">ty2''</span></a><span class="hs-special">]</span><span>
</span><a name="line-801"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308799"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><a href="#local-6989586621680308809"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span> </span><a href="#local-6989586621680308802"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-802"></a><span>
</span><a name="line-803"></a><span class="hs-comment">--------- Literals</span><span>
</span><a name="line-804"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308810"><a href="#local-6989586621680308810"><span class="hs-identifier">rn_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsTyLit"><span class="hs-identifier hs-var">HsTyLit</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsNumTy"><span class="hs-identifier hs-var">HsNumTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308811"><a href="#local-6989586621680308811"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680308812"><a href="#local-6989586621680308812"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-805"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="LoadIface.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a><span> </span><a href="TysWiredIn.html#typeNatKindCon"><span class="hs-identifier hs-var">typeNatKindCon</span></a><span>
</span><a name="line-806"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308810"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkNumLitTy"><span class="hs-identifier hs-var">mkNumLitTy</span></a><span> </span><a href="#local-6989586621680308811"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="TysWiredIn.html#typeNatKind"><span class="hs-identifier hs-var">typeNatKind</span></a><span> </span><a href="#local-6989586621680308812"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308813"><a href="#local-6989586621680308813"><span class="hs-identifier">rn_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsTyLit"><span class="hs-identifier hs-var">HsTyLit</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsStrTy"><span class="hs-identifier hs-var">HsStrTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308814"><a href="#local-6989586621680308814"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680308815"><a href="#local-6989586621680308815"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-809"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="LoadIface.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a><span> </span><a href="TysWiredIn.html#typeSymbolKindCon"><span class="hs-identifier hs-var">typeSymbolKindCon</span></a><span>
</span><a name="line-810"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308813"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a><span> </span><a href="#local-6989586621680308814"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="TysWiredIn.html#typeSymbolKind"><span class="hs-identifier hs-var">typeSymbolKind</span></a><span> </span><a href="#local-6989586621680308815"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-811"></a><span>
</span><a name="line-812"></a><span class="hs-comment">--------- Potentially kind-polymorphic types: call the &quot;up&quot; checker</span><span>
</span><a name="line-813"></a><span class="hs-comment">-- See Note [Future-proofing the type checker]</span><span>
</span><a name="line-814"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308816"><a href="#local-6989586621680308816"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308817"><a href="#local-6989586621680308817"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><a name="local-6989586621680308818"><a href="#local-6989586621680308818"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier hs-var">tc_infer_hs_type_ek</span></a><span> </span><a href="#local-6989586621680308816"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308817"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308818"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-815"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308819"><a href="#local-6989586621680308819"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308820"><a href="#local-6989586621680308820"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsAppTy"><span class="hs-identifier hs-var">HsAppTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><a name="local-6989586621680308821"><a href="#local-6989586621680308821"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier hs-var">tc_infer_hs_type_ek</span></a><span> </span><a href="#local-6989586621680308819"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308820"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308821"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-816"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308822"><a href="#local-6989586621680308822"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308823"><a href="#local-6989586621680308823"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsOpTy"><span class="hs-identifier hs-var">HsOpTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><a name="local-6989586621680308824"><a href="#local-6989586621680308824"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier hs-var">tc_infer_hs_type_ek</span></a><span> </span><a href="#local-6989586621680308822"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308823"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308824"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-817"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308825"><a href="#local-6989586621680308825"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308826"><a href="#local-6989586621680308826"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsKindSig"><span class="hs-identifier hs-var">HsKindSig</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680308827"><a href="#local-6989586621680308827"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier hs-var">tc_infer_hs_type_ek</span></a><span> </span><a href="#local-6989586621680308825"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308826"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308827"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-818"></a><span class="hs-identifier">tc_hs_type</span><span> </span><a name="local-6989586621680308828"><a href="#local-6989586621680308828"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308829"><a href="#local-6989586621680308829"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#XHsType"><span class="hs-identifier hs-var">XHsType</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#NHsCoreTy"><span class="hs-identifier hs-var">NHsCoreTy</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680308830"><a href="#local-6989586621680308830"><span class="hs-identifier">ek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier hs-var">tc_infer_hs_type_ek</span></a><span> </span><a href="#local-6989586621680308828"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308829"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308830"><span class="hs-identifier hs-var">ek</span></a><span>
</span><a name="line-819"></a><span>
</span><a name="line-820"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsWildCardTy"><span class="hs-identifier hs-var">HsWildCardTy</span></a><span> </span><a name="local-6989586621680308831"><a href="#local-6989586621680308831"><span class="hs-identifier">wc</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308832"><a href="#local-6989586621680308832"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-821"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308833"><a href="#local-6989586621680308833"><span class="hs-identifier">wc_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcWildCardOcc"><span class="hs-identifier hs-var">tcWildCardOcc</span></a><span> </span><a href="#local-6989586621680308831"><span class="hs-identifier hs-var">wc</span></a><span> </span><a href="#local-6989586621680308832"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-822"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkNakedCastTy"><span class="hs-identifier hs-var">mkNakedCastTy</span></a><span> </span><a href="#local-6989586621680308833"><span class="hs-identifier hs-var">wc_ty</span></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#mkTcNomReflCo"><span class="hs-identifier hs-var">mkTcNomReflCo</span></a><span> </span><a href="#local-6989586621680308832"><span class="hs-identifier hs-var">exp_kind</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-823"></a><span>         </span><span class="hs-comment">-- Take care here! Even though the coercion is Refl,</span><span>
</span><a name="line-824"></a><span>         </span><span class="hs-comment">-- we still need it to establish Note [The tcType invariant]</span><span>
</span><a name="line-825"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span class="hs-comment">-- disposed of by renamer</span><span>
</span><a name="line-828"></a><span class="hs-identifier">tc_hs_type</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308834"><a href="#local-6989586621680308834"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsAppsTy"><span class="hs-identifier hs-var">HsAppsTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-829"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tc_hs_tyep HsAppsTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308834"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-830"></a><span>
</span><a name="line-831"></a><span class="hs-identifier">tcWildCardOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#HsWildCardInfo"><span class="hs-identifier hs-type">HsWildCardInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-832"></a><a name="tcWildCardOcc"><a href="TcHsType.html#tcWildCardOcc"><span class="hs-identifier">tcWildCardOcc</span></a></a><span> </span><a name="local-6989586621680308835"><a href="#local-6989586621680308835"><span class="hs-identifier">wc_info</span></a></a><span> </span><a name="local-6989586621680308836"><a href="#local-6989586621680308836"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-833"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308837"><a href="#local-6989586621680308837"><span class="hs-identifier">wc_tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupTyVar"><span class="hs-identifier hs-var">tcLookupTyVar</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#wildCardName"><span class="hs-identifier hs-var">wildCardName</span></a><span> </span><a href="#local-6989586621680308835"><span class="hs-identifier hs-var">wc_info</span></a><span class="hs-special">)</span><span>
</span><a name="line-834"></a><span>          </span><span class="hs-comment">-- The wildcard's kind should be an un-filled-in meta tyvar</span><span>
</span><a name="line-835"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsWildCardTy"><span class="hs-identifier hs-var">HsWildCardTy</span></a><span> </span><a href="#local-6989586621680308835"><span class="hs-identifier hs-var">wc_info</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-6989586621680308837"><span class="hs-identifier hs-var">wc_tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-836"></a><span>                           </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621680308837"><span class="hs-identifier hs-var">wc_tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308836"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-837"></a><span>
</span><a name="line-838"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-839"></a><span class="hs-comment">-- | Call 'tc_infer_hs_type' and check its result against an expected kind.</span><span>
</span><a name="line-840"></a><span class="hs-identifier">tc_infer_hs_type_ek</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#HsType"><span class="hs-identifier hs-type">HsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-841"></a><a name="tc_infer_hs_type_ek"><a href="TcHsType.html#tc_infer_hs_type_ek"><span class="hs-identifier">tc_infer_hs_type_ek</span></a></a><span> </span><a name="local-6989586621680308838"><a href="#local-6989586621680308838"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308839"><a href="#local-6989586621680308839"><span class="hs-identifier">hs_ty</span></a></a><span> </span><a name="local-6989586621680308840"><a href="#local-6989586621680308840"><span class="hs-identifier">ek</span></a></a><span>
</span><a name="line-842"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308841"><a href="#local-6989586621680308841"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308842"><a href="#local-6989586621680308842"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tc_infer_hs_type"><span class="hs-identifier hs-var">tc_infer_hs_type</span></a><span> </span><a href="#local-6989586621680308838"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308839"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-843"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308839"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-6989586621680308841"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308842"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621680308840"><span class="hs-identifier hs-var">ek</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-844"></a><span>
</span><a name="line-845"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-846"></a><span class="hs-identifier">tupKindSort_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#TupleSort"><span class="hs-identifier hs-type">TupleSort</span></a><span>
</span><a name="line-847"></a><a name="tupKindSort_maybe"><a href="TcHsType.html#tupKindSort_maybe"><span class="hs-identifier">tupKindSort_maybe</span></a></a><span> </span><a name="local-6989586621680308843"><a href="#local-6989586621680308843"><span class="hs-identifier">k</span></a></a><span>
</span><a name="line-848"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680308844"><a href="#local-6989586621680308844"><span class="hs-identifier">k'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitCastTy_maybe"><span class="hs-identifier hs-var">splitCastTy_maybe</span></a><span> </span><a href="#local-6989586621680308843"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a><span> </span><a href="#local-6989586621680308844"><span class="hs-identifier hs-var">k'</span></a><span>
</span><a name="line-849"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680308845"><a href="#local-6989586621680308845"><span class="hs-identifier">k'</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621680308843"><span class="hs-identifier hs-var">k</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a><span> </span><a href="#local-6989586621680308845"><span class="hs-identifier hs-var">k'</span></a><span>
</span><a name="line-850"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Kind.html#isConstraintKind"><span class="hs-identifier hs-var">isConstraintKind</span></a><span> </span><a href="#local-6989586621680308843"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span>
</span><a name="line-851"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isLiftedTypeKind"><span class="hs-identifier hs-var">isLiftedTypeKind</span></a><span> </span><a href="#local-6989586621680308843"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>
</span><a name="line-852"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-853"></a><span>
</span><a name="line-854"></a><span class="hs-identifier">tc_tuple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#HsType"><span class="hs-identifier hs-type">HsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#TupleSort"><span class="hs-identifier hs-type">TupleSort</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-855"></a><a name="tc_tuple"><a href="TcHsType.html#tc_tuple"><span class="hs-identifier">tc_tuple</span></a></a><span> </span><a name="local-6989586621680308846"><a href="#local-6989586621680308846"><span class="hs-identifier">rn_ty</span></a></a><span> </span><a name="local-6989586621680308847"><a href="#local-6989586621680308847"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308848"><a href="#local-6989586621680308848"><span class="hs-identifier">tup_sort</span></a></a><span> </span><a name="local-6989586621680308849"><a href="#local-6989586621680308849"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621680308850"><a href="#local-6989586621680308850"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-856"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308852"><a href="#local-6989586621680308852"><span class="hs-identifier">arg_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680308848"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-857"></a><span>           </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#nOfThem"><span class="hs-identifier hs-var">nOfThem</span></a><span> </span><a href="#local-6989586621680308851"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-858"></a><span>           </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308849"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-859"></a><span>           </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#nOfThem"><span class="hs-identifier hs-var">nOfThem</span></a><span> </span><a href="#local-6989586621680308851"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-860"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308853"><a href="#local-6989586621680308853"><span class="hs-identifier">tau_tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308847"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308849"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-6989586621680308852"><span class="hs-identifier hs-var">arg_kinds</span></a><span>
</span><a name="line-861"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#finish_tuple"><span class="hs-identifier hs-var">finish_tuple</span></a><span> </span><a href="#local-6989586621680308846"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><a href="#local-6989586621680308848"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><a href="#local-6989586621680308853"><span class="hs-identifier hs-var">tau_tys</span></a><span> </span><a href="#local-6989586621680308852"><span class="hs-identifier hs-var">arg_kinds</span></a><span> </span><a href="#local-6989586621680308850"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-862"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-863"></a><span>    </span><a name="local-6989586621680308851"><a href="#local-6989586621680308851"><span class="hs-identifier">arity</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621680308849"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-864"></a><span>
</span><a name="line-865"></a><span class="hs-identifier">finish_tuple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#HsType"><span class="hs-identifier hs-type">HsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>
</span><a name="line-866"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#TupleSort"><span class="hs-identifier hs-type">TupleSort</span></a><span>
</span><a name="line-867"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ argument types</span><span>
</span><a name="line-868"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ of these kinds</span><span>
</span><a name="line-869"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>      </span><span class="hs-comment">-- ^ expected kind of the whole tuple</span><span>
</span><a name="line-870"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-871"></a><a name="finish_tuple"><a href="TcHsType.html#finish_tuple"><span class="hs-identifier">finish_tuple</span></a></a><span> </span><a name="local-6989586621680308854"><a href="#local-6989586621680308854"><span class="hs-identifier">rn_ty</span></a></a><span> </span><a name="local-6989586621680308855"><a href="#local-6989586621680308855"><span class="hs-identifier">tup_sort</span></a></a><span> </span><a name="local-6989586621680308856"><a href="#local-6989586621680308856"><span class="hs-identifier">tau_tys</span></a></a><span> </span><a name="local-6989586621680308857"><a href="#local-6989586621680308857"><span class="hs-identifier">tau_kinds</span></a></a><span> </span><a name="local-6989586621680308858"><a href="#local-6989586621680308858"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-872"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;finish_tuple&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308861"><span class="hs-identifier hs-var">res_kind</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308857"><span class="hs-identifier hs-var">tau_kinds</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308858"><span class="hs-identifier hs-var">exp_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-873"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308862"><a href="#local-6989586621680308862"><span class="hs-identifier">arg_tys</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680308855"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-874"></a><span>                   </span><span class="hs-comment">-- See also Note [Unboxed tuple RuntimeRep vars] in TyCon</span><span>
</span><a name="line-875"></a><span>                 </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680308860"><span class="hs-identifier hs-var">tau_reps</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680308856"><span class="hs-identifier hs-var">tau_tys</span></a><span>
</span><a name="line-876"></a><span>                 </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680308856"><span class="hs-identifier hs-var">tau_tys</span></a><span>
</span><a name="line-877"></a><span>                 </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680308856"><span class="hs-identifier hs-var">tau_tys</span></a><span>
</span><a name="line-878"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308864"><a href="#local-6989586621680308864"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680308855"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-879"></a><span>           </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span>
</span><a name="line-880"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680308859"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="Constants.html#mAX_CTUPLE_SIZE"><span class="hs-identifier hs-var">mAX_CTUPLE_SIZE</span></a><span>
</span><a name="line-881"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#bigConstraintTuple"><span class="hs-identifier hs-var">bigConstraintTuple</span></a><span> </span><a href="#local-6989586621680308859"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-882"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEnv.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#cTupleTyConName"><span class="hs-identifier hs-var">cTupleTyConName</span></a><span> </span><a href="#local-6989586621680308859"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-883"></a><span>           </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308863"><a href="#local-6989586621680308863"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a><span> </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span> </span><a href="#local-6989586621680308859"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-884"></a><span>                               </span><span class="hs-special">;</span><span> </span><a href="LoadIface.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a><span> </span><a href="#local-6989586621680308863"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-885"></a><span>                               </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680308863"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-886"></a><span>           </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a><span> </span><a href="BasicTypes.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a><span> </span><a href="#local-6989586621680308859"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-887"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><a href="#local-6989586621680308854"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621680308864"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621680308862"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308861"><span class="hs-identifier hs-var">res_kind</span></a><span> </span><a href="#local-6989586621680308858"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-888"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-889"></a><span>    </span><a name="local-6989586621680308859"><a href="#local-6989586621680308859"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621680308856"><span class="hs-identifier hs-var">tau_tys</span></a><span>
</span><a name="line-890"></a><span>    </span><a name="local-6989586621680308860"><a href="#local-6989586621680308860"><span class="hs-identifier">tau_reps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Type.html#getRuntimeRepFromKind"><span class="hs-identifier hs-var">getRuntimeRepFromKind</span></a><span> </span><a href="#local-6989586621680308857"><span class="hs-identifier hs-var">tau_kinds</span></a><span>
</span><a name="line-891"></a><span>    </span><a name="local-6989586621680308861"><a href="#local-6989586621680308861"><span class="hs-identifier">res_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680308855"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-892"></a><span>                 </span><a href="BasicTypes.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TysWiredIn.html#unboxedTupleKind"><span class="hs-identifier hs-var">unboxedTupleKind</span></a><span> </span><a href="#local-6989586621680308860"><span class="hs-identifier hs-var">tau_reps</span></a><span>
</span><a name="line-893"></a><span>                 </span><a href="BasicTypes.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-894"></a><span>                 </span><a href="BasicTypes.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-895"></a><span>
</span><a name="line-896"></a><span class="hs-identifier">bigConstraintTuple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span>
</span><a name="line-897"></a><a name="bigConstraintTuple"><a href="TcHsType.html#bigConstraintTuple"><span class="hs-identifier">bigConstraintTuple</span></a></a><span> </span><a name="local-6989586621680308865"><a href="#local-6989586621680308865"><span class="hs-identifier">arity</span></a></a><span>
</span><a name="line-898"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Constraint tuple arity too large:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-6989586621680308865"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-899"></a><span>          </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;max arity =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="Constants.html#mAX_CTUPLE_SIZE"><span class="hs-identifier hs-var">mAX_CTUPLE_SIZE</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-900"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Instead, use a nested tuple&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-901"></a><span>
</span><a name="line-902"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-903"></a><span class="hs-comment">-- | Apply a type of a given kind to a list of arguments. This instantiates</span><span>
</span><a name="line-904"></a><span class="hs-comment">-- invisible parameters as necessary. Always consumes all the arguments,</span><span>
</span><a name="line-905"></a><span class="hs-comment">-- using matchExpectedFunKind as necessary.</span><span>
</span><a name="line-906"></a><span class="hs-comment">-- This takes an optional @VarEnv Kind@ which maps kind variables to kinds.</span><span>
</span><a name="line-907"></a><span class="hs-comment">-- These kinds should be used to instantiate invisible kind variables;</span><span>
</span><a name="line-908"></a><span class="hs-comment">-- they come from an enclosing class for an associated type/data family.</span><span>
</span><a name="line-909"></a><span class="hs-identifier">tcInferApps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-910"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ Possibly, kind info (see above)</span><span>
</span><a name="line-911"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>        </span><span class="hs-comment">-- ^ Function (for printing only)</span><span>
</span><a name="line-912"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>               </span><span class="hs-comment">-- ^ Function (could be knot-tied)</span><span>
</span><a name="line-913"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>               </span><span class="hs-comment">-- ^ Function kind (zonked)</span><span>
</span><a name="line-914"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- ^ Args</span><span>
</span><a name="line-915"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ (f args, args, result kind)</span><span>
</span><a name="line-916"></a><span class="hs-comment">-- Precondition: typeKind fun_ty = fun_ki</span><span>
</span><a name="line-917"></a><span class="hs-comment">--    Reason: we will return a type application like (fun_ty arg1 ... argn),</span><span>
</span><a name="line-918"></a><span class="hs-comment">--            and that type must be well-kinded</span><span>
</span><a name="line-919"></a><span class="hs-comment">--            See Note [The tcType invariant]</span><span>
</span><a name="line-920"></a><a name="tcInferApps"><a href="TcHsType.html#tcInferApps"><span class="hs-identifier">tcInferApps</span></a></a><span> </span><a name="local-6989586621680308866"><a href="#local-6989586621680308866"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308867"><a href="#local-6989586621680308867"><span class="hs-identifier">mb_kind_info</span></a></a><span> </span><a name="local-6989586621680308868"><a href="#local-6989586621680308868"><span class="hs-identifier">orig_hs_ty</span></a></a><span> </span><a name="local-6989586621680308869"><a href="#local-6989586621680308869"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621680308870"><a href="#local-6989586621680308870"><span class="hs-identifier">fun_ki</span></a></a><span> </span><a name="local-6989586621680308871"><a href="#local-6989586621680308871"><span class="hs-identifier">orig_hs_args</span></a></a><span>
</span><a name="line-921"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcInferApps {&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308868"><span class="hs-identifier hs-var">orig_hs_ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308871"><span class="hs-identifier hs-var">orig_hs_args</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308870"><span class="hs-identifier hs-var">fun_ki</span></a><span class="hs-special">)</span><span>
</span><a name="line-922"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308911"><a href="#local-6989586621680308911"><span class="hs-identifier">stuff</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680308875"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621680308872"><span class="hs-identifier hs-var">empty_subst</span></a><span> </span><a href="#local-6989586621680308869"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621680308873"><span class="hs-identifier hs-var">orig_ki_binders</span></a><span> </span><a href="#local-6989586621680308874"><span class="hs-identifier hs-var">orig_inner_ki</span></a><span> </span><a href="#local-6989586621680308871"><span class="hs-identifier hs-var">orig_hs_args</span></a><span>
</span><a name="line-923"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcInferApps }&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-924"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680308911"><span class="hs-identifier hs-var">stuff</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-925"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-926"></a><span>    </span><a name="local-6989586621680308872"><a href="#local-6989586621680308872"><span class="hs-identifier">empty_subst</span></a></a><span>                      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-927"></a><span>                                       </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621680308870"><span class="hs-identifier hs-var">fun_ki</span></a><span>
</span><a name="line-928"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680308873"><a href="#local-6989586621680308873"><span class="hs-identifier">orig_ki_binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308874"><a href="#local-6989586621680308874"><span class="hs-identifier">orig_inner_ki</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitPiTys"><span class="hs-identifier hs-var">tcSplitPiTys</span></a><span> </span><a href="#local-6989586621680308870"><span class="hs-identifier hs-var">fun_ki</span></a><span>
</span><a name="line-929"></a><span>
</span><a name="line-930"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>             </span><span class="hs-comment">-- the # of the next argument</span><span>
</span><a name="line-931"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- already type-checked args, in reverse order</span><span>
</span><a name="line-932"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span>        </span><span class="hs-comment">-- instantiating substitution</span><span>
</span><a name="line-933"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>          </span><span class="hs-comment">-- function applied to some args, could be knot-tied</span><span>
</span><a name="line-934"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- binders in function kind (both vis. and invis.)</span><span>
</span><a name="line-935"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>          </span><span class="hs-comment">-- function kind body (not a Pi-type)</span><span>
</span><a name="line-936"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- un-type-checked args</span><span>
</span><a name="line-937"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- same as overall return type</span><span>
</span><a name="line-938"></a><span>
</span><a name="line-939"></a><span>      </span><span class="hs-comment">-- no user-written args left. We're done!</span><span>
</span><a name="line-940"></a><span>    </span><a name="local-6989586621680308875"><a href="#local-6989586621680308875"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308876"><a href="#local-6989586621680308876"><span class="hs-identifier">acc_args</span></a></a><span> </span><a name="local-6989586621680308877"><a href="#local-6989586621680308877"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621680308878"><a href="#local-6989586621680308878"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621680308879"><a href="#local-6989586621680308879"><span class="hs-identifier">ki_binders</span></a></a><span> </span><a name="local-6989586621680308880"><a href="#local-6989586621680308880"><span class="hs-identifier">inner_ki</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-941"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308878"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-6989586621680308876"><span class="hs-identifier hs-var">acc_args</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621680308877"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#mkPiTys"><span class="hs-identifier hs-var">mkPiTys</span></a><span> </span><a href="#local-6989586621680308879"><span class="hs-identifier hs-var">ki_binders</span></a><span> </span><a href="#local-6989586621680308880"><span class="hs-identifier hs-var">inner_ki</span></a><span class="hs-special">)</span><span>
</span><a name="line-942"></a><span>
</span><a name="line-943"></a><span>      </span><span class="hs-comment">-- The function's kind has a binder. Is it visible or invisible?</span><span>
</span><a name="line-944"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680308881"><a href="#local-6989586621680308881"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680308882"><a href="#local-6989586621680308882"><span class="hs-identifier">acc_args</span></a></a><span> </span><a name="local-6989586621680308883"><a href="#local-6989586621680308883"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621680308884"><a href="#local-6989586621680308884"><span class="hs-identifier">fun</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680308885"><a href="#local-6989586621680308885"><span class="hs-identifier">ki_binder</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680308886"><a href="#local-6989586621680308886"><span class="hs-identifier">ki_binders</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308887"><a href="#local-6989586621680308887"><span class="hs-identifier">inner_ki</span></a></a><span>
</span><a name="line-945"></a><span>       </span><a name="local-6989586621680308888"><a href="#local-6989586621680308888"><span class="hs-identifier">all_args</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621680308889"><a href="#local-6989586621680308889"><span class="hs-identifier">arg</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680308890"><a href="#local-6989586621680308890"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-946"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isInvisibleBinder"><span class="hs-identifier hs-var">isInvisibleBinder</span></a><span> </span><a href="#local-6989586621680308885"><span class="hs-identifier hs-var">ki_binder</span></a><span>
</span><a name="line-947"></a><span>        </span><span class="hs-comment">-- It's invisible. Instantiate.</span><span>
</span><a name="line-948"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcInferApps (invis)&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308885"><span class="hs-identifier hs-var">ki_binder</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308883"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span>
</span><a name="line-949"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308891"><a href="#local-6989586621680308891"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308892"><a href="#local-6989586621680308892"><span class="hs-identifier">arg'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#tcInstBinder"><span class="hs-identifier hs-var">tcInstBinder</span></a><span> </span><a href="#local-6989586621680308867"><span class="hs-identifier hs-var">mb_kind_info</span></a><span> </span><a href="#local-6989586621680308883"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621680308885"><span class="hs-identifier hs-var">ki_binder</span></a><span>
</span><a name="line-950"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621680308875"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680308881"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308892"><span class="hs-identifier hs-var">arg'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680308882"><span class="hs-identifier hs-var">acc_args</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308891"><span class="hs-identifier hs-var">subst'</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkNakedAppTy"><span class="hs-identifier hs-var">mkNakedAppTy</span></a><span> </span><a href="#local-6989586621680308884"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621680308892"><span class="hs-identifier hs-var">arg'</span></a><span class="hs-special">)</span><span>
</span><a name="line-951"></a><span>                </span><a href="#local-6989586621680308886"><span class="hs-identifier hs-var">ki_binders</span></a><span> </span><a href="#local-6989586621680308887"><span class="hs-identifier hs-var">inner_ki</span></a><span> </span><a href="#local-6989586621680308888"><span class="hs-identifier hs-var">all_args</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-952"></a><span>
</span><a name="line-953"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-954"></a><span>        </span><span class="hs-comment">-- It's visible. Check the next user-written argument</span><span>
</span><a name="line-955"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcInferApps (vis)&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308885"><span class="hs-identifier hs-var">ki_binder</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308889"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-956"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#tyBinderType"><span class="hs-identifier hs-var">tyBinderType</span></a><span> </span><a href="#local-6989586621680308885"><span class="hs-identifier hs-var">ki_binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-957"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308883"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-958"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308893"><a href="#local-6989586621680308893"><span class="hs-identifier">arg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#funAppCtxt"><span class="hs-identifier hs-var">funAppCtxt</span></a><span> </span><a href="#local-6989586621680308868"><span class="hs-identifier hs-var">orig_hs_ty</span></a><span> </span><a href="#local-6989586621680308889"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621680308881"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-959"></a><span>                     </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308866"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308889"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621680308883"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Type.html#tyBinderType"><span class="hs-identifier hs-var">tyBinderType</span></a><span> </span><a href="#local-6989586621680308885"><span class="hs-identifier hs-var">ki_binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-960"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308894"><a href="#local-6989586621680308894"><span class="hs-identifier">subst'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#extendTvSubstBinderAndInScope"><span class="hs-identifier hs-var">extendTvSubstBinderAndInScope</span></a><span> </span><a href="#local-6989586621680308883"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621680308885"><span class="hs-identifier hs-var">ki_binder</span></a><span> </span><a href="#local-6989586621680308893"><span class="hs-identifier hs-var">arg'</span></a><span>
</span><a name="line-961"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621680308875"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308881"><span class="hs-identifier hs-var">n</span></a><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308893"><span class="hs-identifier hs-var">arg'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680308882"><span class="hs-identifier hs-var">acc_args</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308894"><span class="hs-identifier hs-var">subst'</span></a><span>
</span><a name="line-962"></a><span>                </span><span class="hs-special">(</span><a href="TcType.html#mkNakedAppTy"><span class="hs-identifier hs-var">mkNakedAppTy</span></a><span> </span><a href="#local-6989586621680308884"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621680308893"><span class="hs-identifier hs-var">arg'</span></a><span class="hs-special">)</span><span>
</span><a name="line-963"></a><span>                </span><a href="#local-6989586621680308886"><span class="hs-identifier hs-var">ki_binders</span></a><span> </span><a href="#local-6989586621680308887"><span class="hs-identifier hs-var">inner_ki</span></a><span> </span><a href="#local-6989586621680308890"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-964"></a><span>
</span><a name="line-965"></a><span>       </span><span class="hs-comment">-- We've run out of known binders in the functions's kind.</span><span>
</span><a name="line-966"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680308895"><a href="#local-6989586621680308895"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680308896"><a href="#local-6989586621680308896"><span class="hs-identifier">acc_args</span></a></a><span> </span><a name="local-6989586621680308897"><a href="#local-6989586621680308897"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621680308898"><a href="#local-6989586621680308898"><span class="hs-identifier">fun</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680308899"><a href="#local-6989586621680308899"><span class="hs-identifier">inner_ki</span></a></a><span> </span><a name="local-6989586621680308900"><a href="#local-6989586621680308900"><span class="hs-identifier">all_args</span></a></a><span>
</span><a name="line-967"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680308902"><span class="hs-identifier hs-var">new_ki_binders</span></a><span class="hs-special">)</span><span>
</span><a name="line-968"></a><span>         </span><span class="hs-comment">-- But, after substituting, we have more binders.</span><span>
</span><a name="line-969"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308875"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680308895"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680308896"><span class="hs-identifier hs-var">acc_args</span></a><span> </span><a href="#local-6989586621680308904"><span class="hs-identifier hs-var">zapped_subst</span></a><span> </span><a href="#local-6989586621680308898"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621680308902"><span class="hs-identifier hs-var">new_ki_binders</span></a><span> </span><a href="#local-6989586621680308903"><span class="hs-identifier hs-var">new_inner_ki</span></a><span> </span><a href="#local-6989586621680308900"><span class="hs-identifier hs-var">all_args</span></a><span>
</span><a name="line-970"></a><span>
</span><a name="line-971"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-972"></a><span>         </span><span class="hs-comment">-- Even after substituting, still no binders. Use matchExpectedFunKind</span><span>
</span><a name="line-973"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcInferApps (no binder)&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308903"><span class="hs-identifier hs-var">new_inner_ki</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308904"><span class="hs-identifier hs-var">zapped_subst</span></a><span class="hs-special">)</span><span>
</span><a name="line-974"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308906"><a href="#local-6989586621680308906"><span class="hs-identifier">co</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308907"><a href="#local-6989586621680308907"><span class="hs-identifier">arg_k</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308908"><a href="#local-6989586621680308908"><span class="hs-identifier">res_k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcUnify.html#matchExpectedFunKind"><span class="hs-identifier hs-var">matchExpectedFunKind</span></a><span> </span><a href="#local-6989586621680308905"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="#local-6989586621680308901"><span class="hs-identifier hs-var">substed_inner_ki</span></a><span>
</span><a name="line-975"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308909"><a href="#local-6989586621680308909"><span class="hs-identifier">new_in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680308907"><span class="hs-identifier hs-var">arg_k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308908"><span class="hs-identifier hs-var">res_k</span></a><span class="hs-special">]</span><span>
</span><a name="line-976"></a><span>                 </span><a name="local-6989586621680308910"><a href="#local-6989586621680308910"><span class="hs-identifier">subst'</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308904"><span class="hs-identifier hs-var">zapped_subst</span></a><span> </span><span class="hs-special">`</span><a href="TyCoRep.html#extendTCvInScopeSet"><span class="hs-identifier hs-var">extendTCvInScopeSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680308909"><span class="hs-identifier hs-var">new_in_scope</span></a><span>
</span><a name="line-977"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621680308875"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680308895"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680308896"><span class="hs-identifier hs-var">acc_args</span></a><span> </span><a href="#local-6989586621680308910"><span class="hs-identifier hs-var">subst'</span></a><span>
</span><a name="line-978"></a><span>                </span><span class="hs-special">(</span><a href="#local-6989586621680308898"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#mkNakedCastTy"><span class="hs-identifier hs-var">mkNakedCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680308906"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-979"></a><span>                </span><span class="hs-special">[</span><a href="Type.html#mkAnonBinder"><span class="hs-identifier hs-var">mkAnonBinder</span></a><span> </span><a href="#local-6989586621680308907"><span class="hs-identifier hs-var">arg_k</span></a><span class="hs-special">]</span><span>
</span><a name="line-980"></a><span>                </span><a href="#local-6989586621680308908"><span class="hs-identifier hs-var">res_k</span></a><span> </span><a href="#local-6989586621680308900"><span class="hs-identifier hs-var">all_args</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-981"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-982"></a><span>        </span><a name="local-6989586621680308901"><a href="#local-6989586621680308901"><span class="hs-identifier">substed_inner_ki</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621680308897"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621680308899"><span class="hs-identifier hs-var">inner_ki</span></a><span>
</span><a name="line-983"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680308902"><a href="#local-6989586621680308902"><span class="hs-identifier">new_ki_binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308903"><a href="#local-6989586621680308903"><span class="hs-identifier">new_inner_ki</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitPiTys"><span class="hs-identifier hs-var">tcSplitPiTys</span></a><span> </span><a href="#local-6989586621680308901"><span class="hs-identifier hs-var">substed_inner_ki</span></a><span>
</span><a name="line-984"></a><span>        </span><a name="local-6989586621680308904"><a href="#local-6989586621680308904"><span class="hs-identifier">zapped_subst</span></a></a><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#zapTCvSubst"><span class="hs-identifier hs-var">zapTCvSubst</span></a><span> </span><a href="#local-6989586621680308897"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-985"></a><span>        </span><a name="local-6989586621680308905"><a href="#local-6989586621680308905"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#mkHsAppTys"><span class="hs-identifier hs-var">mkHsAppTys</span></a><span> </span><a href="#local-6989586621680308868"><span class="hs-identifier hs-var">orig_hs_ty</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308895"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308871"><span class="hs-identifier hs-var">orig_hs_args</span></a><span class="hs-special">)</span><span>
</span><a name="line-986"></a><span>
</span><a name="line-987"></a><span>
</span><a name="line-988"></a><span class="hs-comment">-- | Applies a type to a list of arguments.</span><span>
</span><a name="line-989"></a><span class="hs-comment">-- Always consumes all the arguments, using 'matchExpectedFunKind' as</span><span>
</span><a name="line-990"></a><span class="hs-comment">-- necessary. If you wish to apply a type to a list of HsTypes, this is</span><span>
</span><a name="line-991"></a><span class="hs-comment">-- your function.</span><span>
</span><a name="line-992"></a><span class="hs-comment">-- Used for type-checking types only.</span><span>
</span><a name="line-993"></a><span class="hs-identifier">tcTyApps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span>
</span><a name="line-994"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>        </span><span class="hs-comment">-- ^ Function (for printing only)</span><span>
</span><a name="line-995"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>               </span><span class="hs-comment">-- ^ Function (could be knot-tied)</span><span>
</span><a name="line-996"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>               </span><span class="hs-comment">-- ^ Function kind (zonked)</span><span>
</span><a name="line-997"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- ^ Args</span><span>
</span><a name="line-998"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ (f args, result kind)</span><span>
</span><a name="line-999"></a><span class="hs-comment">-- Precondition: see precondition for tcInferApps</span><span>
</span><a name="line-1000"></a><a name="tcTyApps"><a href="TcHsType.html#tcTyApps"><span class="hs-identifier">tcTyApps</span></a></a><span> </span><a name="local-6989586621680308912"><a href="#local-6989586621680308912"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308913"><a href="#local-6989586621680308913"><span class="hs-identifier">orig_hs_ty</span></a></a><span> </span><a name="local-6989586621680308914"><a href="#local-6989586621680308914"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621680308915"><a href="#local-6989586621680308915"><span class="hs-identifier">fun_ki</span></a></a><span> </span><a name="local-6989586621680308916"><a href="#local-6989586621680308916"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-1001"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308917"><a href="#local-6989586621680308917"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308918"><a href="#local-6989586621680308918"><span class="hs-identifier">_args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308919"><a href="#local-6989586621680308919"><span class="hs-identifier">ki'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcInferApps"><span class="hs-identifier hs-var">tcInferApps</span></a><span> </span><a href="#local-6989586621680308912"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621680308913"><span class="hs-identifier hs-var">orig_hs_ty</span></a><span> </span><a href="#local-6989586621680308914"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621680308915"><span class="hs-identifier hs-var">fun_ki</span></a><span> </span><a href="#local-6989586621680308916"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1002"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308917"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308919"><span class="hs-identifier hs-var">ki'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1003"></a><span>
</span><a name="line-1004"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1005"></a><span class="hs-comment">-- Like checkExpectedKindX, but returns only the final type; convenient wrapper</span><span>
</span><a name="line-1006"></a><span class="hs-comment">-- Obeys Note [The tcType invariant]</span><span>
</span><a name="line-1007"></a><span class="hs-identifier">checkExpectedKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#HsType"><span class="hs-identifier hs-type">HsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>   </span><span class="hs-comment">-- type we're checking (for printing)</span><span>
</span><a name="line-1008"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>         </span><span class="hs-comment">-- type we're checking (might be knot-tied)</span><span>
</span><a name="line-1009"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>         </span><span class="hs-comment">-- the known kind of that type</span><span>
</span><a name="line-1010"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>         </span><span class="hs-comment">-- the expected kind</span><span>
</span><a name="line-1011"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-1012"></a><a name="checkExpectedKind"><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier">checkExpectedKind</span></a></a><span> </span><a name="local-6989586621680308920"><a href="#local-6989586621680308920"><span class="hs-identifier">hs_ty</span></a></a><span> </span><a name="local-6989586621680308921"><a href="#local-6989586621680308921"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680308922"><a href="#local-6989586621680308922"><span class="hs-identifier">act</span></a></a><span> </span><a name="local-6989586621680308923"><a href="#local-6989586621680308923"><span class="hs-identifier">exp</span></a></a><span>
</span><a name="line-1013"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#fstOf3"><span class="hs-identifier hs-var">fstOf3</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcHsType.html#checkExpectedKindX"><span class="hs-identifier hs-var">checkExpectedKindX</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308920"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308921"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308922"><span class="hs-identifier hs-var">act</span></a><span> </span><a href="#local-6989586621680308923"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-1014"></a><span>
</span><a name="line-1015"></a><span class="hs-identifier">checkExpectedKindX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Possibly, instantiations for kind vars</span><span>
</span><a name="line-1016"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>                 </span><span class="hs-comment">-- HsType whose kind we're checking</span><span>
</span><a name="line-1017"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>               </span><span class="hs-comment">-- the type whose kind we're checking</span><span>
</span><a name="line-1018"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>               </span><span class="hs-comment">-- the known kind of that type, k</span><span>
</span><a name="line-1019"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>               </span><span class="hs-comment">-- the expected kind, exp_kind</span><span>
</span><a name="line-1020"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcEvidence.html#TcCoercionN"><span class="hs-identifier hs-type">TcCoercionN</span></a><span class="hs-special">)</span><span>
</span><a name="line-1021"></a><span>    </span><span class="hs-comment">-- (the new args, the coercion)</span><span>
</span><a name="line-1022"></a><span class="hs-comment">-- Instantiate a kind (if necessary) and then call unifyType</span><span>
</span><a name="line-1023"></a><span class="hs-comment">--      (checkExpectedKind ty act_kind exp_kind)</span><span>
</span><a name="line-1024"></a><span class="hs-comment">-- checks that the actual kind act_kind is compatible</span><span>
</span><a name="line-1025"></a><span class="hs-comment">--      with the expected kind exp_kind</span><span>
</span><a name="line-1026"></a><a name="checkExpectedKindX"><a href="TcHsType.html#checkExpectedKindX"><span class="hs-identifier">checkExpectedKindX</span></a></a><span> </span><a name="local-6989586621680308924"><a href="#local-6989586621680308924"><span class="hs-identifier">mb_kind_env</span></a></a><span> </span><a name="local-6989586621680308925"><a href="#local-6989586621680308925"><span class="hs-identifier">pp_hs_ty</span></a></a><span> </span><a name="local-6989586621680308926"><a href="#local-6989586621680308926"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680308927"><a href="#local-6989586621680308927"><span class="hs-identifier">act_kind</span></a></a><span> </span><a name="local-6989586621680308928"><a href="#local-6989586621680308928"><span class="hs-identifier">exp_kind</span></a></a><span>
</span><a name="line-1027"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- We need to make sure that both kinds have the same number of implicit</span><span>
</span><a name="line-1028"></a><span>        </span><span class="hs-comment">-- foralls out front. If the actual kind has more, instantiate accordingly.</span><span>
</span><a name="line-1029"></a><span>        </span><span class="hs-comment">-- Otherwise, just pass the type &amp; kind through: the errors are caught</span><span>
</span><a name="line-1030"></a><span>        </span><span class="hs-comment">-- in unifyType.</span><span>
</span><a name="line-1031"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308929"><a href="#local-6989586621680308929"><span class="hs-identifier">exp_bndrs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitPiTysInvisible"><span class="hs-identifier hs-var">splitPiTysInvisible</span></a><span> </span><a href="#local-6989586621680308928"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-1032"></a><span>            </span><a name="local-6989586621680308930"><a href="#local-6989586621680308930"><span class="hs-identifier">n_exp</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621680308929"><span class="hs-identifier hs-var">exp_bndrs</span></a><span>
</span><a name="line-1033"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308931"><a href="#local-6989586621680308931"><span class="hs-identifier">new_args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308932"><a href="#local-6989586621680308932"><span class="hs-identifier">act_kind'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#instantiateTyUntilN"><span class="hs-identifier hs-var">instantiateTyUntilN</span></a><span> </span><a href="#local-6989586621680308924"><span class="hs-identifier hs-var">mb_kind_env</span></a><span> </span><a href="#local-6989586621680308930"><span class="hs-identifier hs-var">n_exp</span></a><span> </span><a href="#local-6989586621680308927"><span class="hs-identifier hs-var">act_kind</span></a><span>
</span><a name="line-1034"></a><span>
</span><a name="line-1035"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308933"><a href="#local-6989586621680308933"><span class="hs-identifier">origin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TypeEqOrigin"><span class="hs-identifier hs-var">TypeEqOrigin</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">uo_actual</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308932"><span class="hs-identifier hs-var">act_kind'</span></a><span>
</span><a name="line-1036"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uo_expected</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308928"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-1037"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uo_thing</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621680308925"><span class="hs-identifier hs-var">pp_hs_ty</span></a><span>
</span><a name="line-1038"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uo_visible</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- the hs_ty is visible</span><span>
</span><a name="line-1039"></a><span>            </span><a name="local-6989586621680308934"><a href="#local-6989586621680308934"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkNakedAppTys"><span class="hs-identifier hs-var">mkNakedAppTys</span></a><span> </span><a href="#local-6989586621680308926"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680308931"><span class="hs-identifier hs-var">new_args</span></a><span>
</span><a name="line-1040"></a><span>
</span><a name="line-1041"></a><span>      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;checkExpectedKind&quot;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1042"></a><span>        </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621680308925"><span class="hs-identifier hs-var">pp_hs_ty</span></a><span>
</span><a name="line-1043"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;act_kind:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308927"><span class="hs-identifier hs-var">act_kind</span></a><span>
</span><a name="line-1044"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;act_kind':&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308932"><span class="hs-identifier hs-var">act_kind'</span></a><span>
</span><a name="line-1045"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;exp_kind:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308928"><span class="hs-identifier hs-var">exp_kind</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1046"></a><span>
</span><a name="line-1047"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680308932"><span class="hs-identifier hs-var">act_kind'</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#tcEqType"><span class="hs-identifier hs-var">tcEqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680308928"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-1048"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308934"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308931"><span class="hs-identifier hs-var">new_args</span></a><span class="hs-special">,</span><span> </span><a href="TcEvidence.html#mkTcNomReflCo"><span class="hs-identifier hs-var">mkTcNomReflCo</span></a><span> </span><a href="#local-6989586621680308928"><span class="hs-identifier hs-var">exp_kind</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- This is very common</span><span>
</span><a name="line-1049"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308935"><a href="#local-6989586621680308935"><span class="hs-identifier">co_k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcUnify.html#uType"><span class="hs-identifier hs-var">uType</span></a><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><a href="#local-6989586621680308933"><span class="hs-identifier hs-var">origin</span></a><span> </span><a href="#local-6989586621680308932"><span class="hs-identifier hs-var">act_kind'</span></a><span> </span><a href="#local-6989586621680308928"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-1050"></a><span>                </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;checkExpectedKind&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308927"><span class="hs-identifier hs-var">act_kind</span></a><span>
</span><a name="line-1051"></a><span>                                                    </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308928"><span class="hs-identifier hs-var">exp_kind</span></a><span>
</span><a name="line-1052"></a><span>                                                    </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308935"><span class="hs-identifier hs-var">co_k</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1053"></a><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308936"><a href="#local-6989586621680308936"><span class="hs-identifier">result_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680308934"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#mkNakedCastTy"><span class="hs-identifier hs-var">mkNakedCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680308935"><span class="hs-identifier hs-var">co_k</span></a><span>
</span><a name="line-1054"></a><span>                      </span><span class="hs-comment">-- See Note [The tcType invariant]</span><span>
</span><a name="line-1055"></a><span>                </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308936"><span class="hs-identifier hs-var">result_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308931"><span class="hs-identifier hs-var">new_args</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308935"><span class="hs-identifier hs-var">co_k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1056"></a><span>
</span><a name="line-1057"></a><span class="hs-comment">-- | Instantiate @n@ invisible arguments to a type. If @n &lt;= 0@, no instantiation</span><span>
</span><a name="line-1058"></a><span class="hs-comment">-- occurs. If @n@ is too big, then all available invisible arguments are instantiated.</span><span>
</span><a name="line-1059"></a><span class="hs-comment">-- (In other words, this function is very forgiving about bad values of @n@.)</span><span>
</span><a name="line-1060"></a><span class="hs-identifier">instantiateTyN</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- ^ Predetermined instantiations</span><span>
</span><a name="line-1061"></a><span>                                                   </span><span class="hs-comment">-- (for assoc. type patterns)</span><span>
</span><a name="line-1062"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>                              </span><span class="hs-comment">-- ^ @n@</span><span>
</span><a name="line-1063"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>             </span><span class="hs-comment">-- ^ its kind</span><span>
</span><a name="line-1064"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ The inst'ed type, new args, kind</span><span>
</span><a name="line-1065"></a><a name="instantiateTyN"><a href="TcHsType.html#instantiateTyN"><span class="hs-identifier">instantiateTyN</span></a></a><span> </span><a name="local-6989586621680308937"><a href="#local-6989586621680308937"><span class="hs-identifier">mb_kind_env</span></a></a><span> </span><a name="local-6989586621680308938"><a href="#local-6989586621680308938"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680308939"><a href="#local-6989586621680308939"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-6989586621680308940"><a href="#local-6989586621680308940"><span class="hs-identifier">inner_ki</span></a></a><span>
</span><a name="line-1066"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680308938"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1067"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308943"><span class="hs-identifier hs-var">ki</span></a><span class="hs-special">)</span><span>
</span><a name="line-1068"></a><span>
</span><a name="line-1069"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1070"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308945"><a href="#local-6989586621680308945"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308946"><a href="#local-6989586621680308946"><span class="hs-identifier">inst_args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Inst.html#tcInstBinders"><span class="hs-identifier hs-var">tcInstBinders</span></a><span> </span><a href="#local-6989586621680308944"><span class="hs-identifier hs-var">empty_subst</span></a><span> </span><a href="#local-6989586621680308937"><span class="hs-identifier hs-var">mb_kind_env</span></a><span> </span><a href="#local-6989586621680308941"><span class="hs-identifier hs-var">inst_bndrs</span></a><span>
</span><a name="line-1071"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308947"><a href="#local-6989586621680308947"><span class="hs-identifier">rebuilt_ki</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkPiTys"><span class="hs-identifier hs-var">mkPiTys</span></a><span> </span><a href="#local-6989586621680308942"><span class="hs-identifier hs-var">leftover_bndrs</span></a><span> </span><a href="#local-6989586621680308940"><span class="hs-identifier hs-var">inner_ki</span></a><span>
</span><a name="line-1072"></a><span>             </span><a name="local-6989586621680308948"><a href="#local-6989586621680308948"><span class="hs-identifier">ki'</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621680308945"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621680308947"><span class="hs-identifier hs-var">rebuilt_ki</span></a><span>
</span><a name="line-1073"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;instantiateTyN&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308943"><span class="hs-identifier hs-var">ki</span></a><span>
</span><a name="line-1074"></a><span>                                        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308938"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1075"></a><span>                                        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308945"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-1076"></a><span>                                        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308947"><span class="hs-identifier hs-var">rebuilt_ki</span></a><span>
</span><a name="line-1077"></a><span>                                        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308948"><span class="hs-identifier hs-var">ki'</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1078"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308946"><span class="hs-identifier hs-var">inst_args</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308948"><span class="hs-identifier hs-var">ki'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1079"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1080"></a><span>     </span><span class="hs-comment">-- NB: splitAt is forgiving with invalid numbers</span><span>
</span><a name="line-1081"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621680308941"><a href="#local-6989586621680308941"><span class="hs-identifier">inst_bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308942"><a href="#local-6989586621680308942"><span class="hs-identifier">leftover_bndrs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a><span> </span><a href="#local-6989586621680308938"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680308939"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-1082"></a><span>     </span><a name="local-6989586621680308943"><a href="#local-6989586621680308943"><span class="hs-identifier">ki</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkPiTys"><span class="hs-identifier hs-var">mkPiTys</span></a><span> </span><a href="#local-6989586621680308939"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-6989586621680308940"><span class="hs-identifier hs-var">inner_ki</span></a><span>
</span><a name="line-1083"></a><span>     </span><a name="local-6989586621680308944"><a href="#local-6989586621680308944"><span class="hs-identifier">empty_subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621680308943"><span class="hs-identifier hs-var">ki</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1084"></a><span>
</span><a name="line-1085"></a><span class="hs-comment">-- | Instantiate a type to have at most @n@ invisible arguments.</span><span>
</span><a name="line-1086"></a><span class="hs-identifier">instantiateTyUntilN</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ Possibly, instantiations for vars</span><span>
</span><a name="line-1087"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>         </span><span class="hs-comment">-- ^ @n@</span><span>
</span><a name="line-1088"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>      </span><span class="hs-comment">-- ^ its kind</span><span>
</span><a name="line-1089"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ The new args, final kind</span><span>
</span><a name="line-1090"></a><a name="instantiateTyUntilN"><a href="TcHsType.html#instantiateTyUntilN"><span class="hs-identifier">instantiateTyUntilN</span></a></a><span> </span><a name="local-6989586621680308949"><a href="#local-6989586621680308949"><span class="hs-identifier">mb_kind_env</span></a></a><span> </span><a name="local-6989586621680308950"><a href="#local-6989586621680308950"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680308951"><a href="#local-6989586621680308951"><span class="hs-identifier">ki</span></a></a><span>
</span><a name="line-1091"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308952"><a href="#local-6989586621680308952"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308953"><a href="#local-6989586621680308953"><span class="hs-identifier">inner_ki</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitPiTysInvisible"><span class="hs-identifier hs-var">splitPiTysInvisible</span></a><span> </span><a href="#local-6989586621680308951"><span class="hs-identifier hs-var">ki</span></a><span>
</span><a name="line-1092"></a><span>        </span><a name="local-6989586621680308954"><a href="#local-6989586621680308954"><span class="hs-identifier">num_to_inst</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621680308952"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621680308950"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1093"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-1094"></a><span>    </span><a href="TcHsType.html#instantiateTyN"><span class="hs-identifier hs-var">instantiateTyN</span></a><span> </span><a href="#local-6989586621680308949"><span class="hs-identifier hs-var">mb_kind_env</span></a><span> </span><a href="#local-6989586621680308954"><span class="hs-identifier hs-var">num_to_inst</span></a><span> </span><a href="#local-6989586621680308952"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-6989586621680308953"><span class="hs-identifier hs-var">inner_ki</span></a><span>
</span><a name="line-1095"></a><span>
</span><a name="line-1096"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1097"></a><span class="hs-identifier">tcHsMbContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#LHsContext"><span class="hs-identifier hs-type">LHsContext</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-1098"></a><a name="tcHsMbContext"><a href="TcHsType.html#tcHsMbContext"><span class="hs-identifier">tcHsMbContext</span></a></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1099"></a><span class="hs-identifier">tcHsMbContext</span><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680308955"><a href="#local-6989586621680308955"><span class="hs-identifier">cxt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcHsContext"><span class="hs-identifier hs-var">tcHsContext</span></a><span> </span><a href="#local-6989586621680308955"><span class="hs-identifier hs-var">cxt</span></a><span>
</span><a name="line-1100"></a><span>
</span><a name="line-1101"></a><span class="hs-identifier">tcHsContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsContext"><span class="hs-identifier hs-type">LHsContext</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-1102"></a><a name="tcHsContext"><a href="TcHsType.html#tcHsContext"><span class="hs-identifier">tcHsContext</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_hs_context"><span class="hs-identifier hs-var">tc_hs_context</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span>
</span><a name="line-1103"></a><span>
</span><a name="line-1104"></a><span class="hs-identifier">tcLHsPredType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-1105"></a><a name="tcLHsPredType"><a href="TcHsType.html#tcLHsPredType"><span class="hs-identifier">tcLHsPredType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_pred"><span class="hs-identifier hs-var">tc_lhs_pred</span></a><span> </span><a href="TcHsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a><span>
</span><a name="line-1106"></a><span>
</span><a name="line-1107"></a><span class="hs-identifier">tc_hs_context</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsContext"><span class="hs-identifier hs-type">LHsContext</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-1108"></a><a name="tc_hs_context"><a href="TcHsType.html#tc_hs_context"><span class="hs-identifier">tc_hs_context</span></a></a><span> </span><a name="local-6989586621680308956"><a href="#local-6989586621680308956"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308957"><a href="#local-6989586621680308957"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tc_lhs_pred"><span class="hs-identifier hs-var">tc_lhs_pred</span></a><span> </span><a href="#local-6989586621680308956"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621680308957"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1109"></a><span>
</span><a name="line-1110"></a><span class="hs-identifier">tc_lhs_pred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-1111"></a><a name="tc_lhs_pred"><a href="TcHsType.html#tc_lhs_pred"><span class="hs-identifier">tc_lhs_pred</span></a></a><span> </span><a name="local-6989586621680308958"><a href="#local-6989586621680308958"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308959"><a href="#local-6989586621680308959"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><a href="#local-6989586621680308958"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621680308959"><span class="hs-identifier hs-var">pred</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-1112"></a><span>
</span><a name="line-1113"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1114"></a><span class="hs-identifier">tcTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1115"></a><span class="hs-comment">-- See Note [Type checking recursive type and class declarations]</span><span>
</span><a name="line-1116"></a><span class="hs-comment">-- in TcTyClsDecls</span><span>
</span><a name="line-1117"></a><a name="tcTyVar"><a href="TcHsType.html#tcTyVar"><span class="hs-identifier">tcTyVar</span></a></a><span> </span><a name="local-6989586621680308960"><a href="#local-6989586621680308960"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680308961"><a href="#local-6989586621680308961"><span class="hs-identifier">name</span></a></a><span>         </span><span class="hs-comment">-- Could be a tyvar, a tycon, or a datacon</span><span>
</span><a name="line-1118"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;lk1&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308961"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1119"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308980"><a href="#local-6989586621680308980"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookup"><span class="hs-identifier hs-var">tcLookup</span></a><span> </span><a href="#local-6989586621680308961"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1120"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680308980"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1121"></a><span>           </span><a href="TcRnTypes.html#ATyVar"><span class="hs-identifier hs-var">ATyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308981"><a href="#local-6989586621680308981"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- Important: zonk before returning</span><span>
</span><a name="line-1122"></a><span>                          </span><span class="hs-comment">-- We may have the application ((a::kappa) b)</span><span>
</span><a name="line-1123"></a><span>                          </span><span class="hs-comment">-- where kappa is already unified to (k1 -&gt; k2)</span><span>
</span><a name="line-1124"></a><span>                          </span><span class="hs-comment">-- Then we want to see that arrow.  Best done</span><span>
</span><a name="line-1125"></a><span>                          </span><span class="hs-comment">-- here because we are also maintaining</span><span>
</span><a name="line-1126"></a><span>                          </span><span class="hs-comment">-- Note [The tcType invariant], so we don't just</span><span>
</span><a name="line-1127"></a><span>                          </span><span class="hs-comment">-- want to zonk the kind, leaving the TyVar</span><span>
</span><a name="line-1128"></a><span>                          </span><span class="hs-comment">-- un-zonked  (Trac #114873)</span><span>
</span><a name="line-1129"></a><span>                          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308982"><a href="#local-6989586621680308982"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a><span> </span><a href="#local-6989586621680308981"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1130"></a><span>                             </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308982"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621680308982"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1131"></a><span>
</span><a name="line-1132"></a><span>           </span><a href="TcRnTypes.html#ATcTyCon"><span class="hs-identifier hs-var">ATcTyCon</span></a><span> </span><a name="local-6989586621680308983"><a href="#local-6989586621680308983"><span class="hs-identifier">tc_tc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- See Note [GADT kind self-reference]</span><span>
</span><a name="line-1133"></a><span>                                  </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span>
</span><a name="line-1134"></a><span>                                    </span><span class="hs-special">(</span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">isTypeLevel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode_level</span><span> </span><a href="#local-6989586621680308960"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1135"></a><span>                                    </span><span class="hs-special">(</span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-6989586621680308961"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="TcRnTypes.html#TyConPE"><span class="hs-identifier hs-var">TyConPE</span></a><span class="hs-special">)</span><span>
</span><a name="line-1136"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621680308962"><span class="hs-identifier hs-var">check_tc</span></a><span> </span><a href="#local-6989586621680308983"><span class="hs-identifier hs-var">tc_tc</span></a><span>
</span><a name="line-1137"></a><span>                                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308984"><a href="#local-6989586621680308984"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680308964"><span class="hs-identifier hs-var">get_loopy_tc</span></a><span> </span><a href="#local-6989586621680308961"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680308983"><span class="hs-identifier hs-var">tc_tc</span></a><span>
</span><a name="line-1138"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621680308963"><span class="hs-identifier hs-var">handle_tyfams</span></a><span> </span><a href="#local-6989586621680308984"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621680308983"><span class="hs-identifier hs-var">tc_tc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1139"></a><span>                             </span><span class="hs-comment">-- mkNakedTyConApp: see Note [Type-checking inside the knot]</span><span>
</span><a name="line-1140"></a><span>                 </span><span class="hs-comment">-- NB: we really should check if we're at the kind level</span><span>
</span><a name="line-1141"></a><span>                 </span><span class="hs-comment">-- and if the tycon is promotable if -XNoTypeInType is set.</span><span>
</span><a name="line-1142"></a><span>                 </span><span class="hs-comment">-- But this is a terribly large amount of work! Not worth it.</span><span>
</span><a name="line-1143"></a><span>
</span><a name="line-1144"></a><span>           </span><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-6989586621680308985"><a href="#local-6989586621680308985"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1145"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="#local-6989586621680308962"><span class="hs-identifier hs-var">check_tc</span></a><span> </span><a href="#local-6989586621680308985"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1146"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621680308963"><span class="hs-identifier hs-var">handle_tyfams</span></a><span> </span><a href="#local-6989586621680308985"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621680308985"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1147"></a><span>
</span><a name="line-1148"></a><span>           </span><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-6989586621680308986"><a href="#local-6989586621680308986"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1149"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308987"><a href="#local-6989586621680308987"><span class="hs-identifier">data_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DataKinds"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DataKinds</span></a><span>
</span><a name="line-1150"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308987"><span class="hs-identifier hs-var">data_kinds</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="DataCon.html#specialPromotedDc"><span class="hs-identifier hs-var">specialPromotedDc</span></a><span> </span><a href="#local-6989586621680308986"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1151"></a><span>                       </span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-6989586621680308961"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="TcRnTypes.html#NoDataKindsDC"><span class="hs-identifier hs-var">NoDataKindsDC</span></a><span>
</span><a name="line-1152"></a><span>                   </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308988"><a href="#local-6989586621680308988"><span class="hs-identifier">type_in_type</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#TypeInType"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TypeInType</span></a><span>
</span><a name="line-1153"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621680308988"><span class="hs-identifier hs-var">type_in_type</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-1154"></a><span>                              </span><span class="hs-special">(</span><span> </span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">isTypeLevel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode_level</span><span> </span><a href="#local-6989586621680308960"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1155"></a><span>                                </span><a href="DataCon.html#isLegacyPromotableDataCon"><span class="hs-identifier hs-var">isLegacyPromotableDataCon</span></a><span> </span><a href="#local-6989586621680308986"><span class="hs-identifier hs-var">dc</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-1156"></a><span>                              </span><span class="hs-special">(</span><span> </span><a href="TcRnTypes.html#isKindLevel"><span class="hs-identifier hs-var">isKindLevel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode_level</span><span> </span><a href="#local-6989586621680308960"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1157"></a><span>                                </span><a href="DataCon.html#specialPromotedDc"><span class="hs-identifier hs-var">specialPromotedDc</span></a><span> </span><a href="#local-6989586621680308986"><span class="hs-identifier hs-var">dc</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1158"></a><span>                       </span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-6989586621680308961"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="TcRnTypes.html#NoTypeInTypeDC"><span class="hs-identifier hs-var">NoTypeInTypeDC</span></a><span>
</span><a name="line-1159"></a><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308989"><a href="#local-6989586621680308989"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a><span> </span><a href="#local-6989586621680308986"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-1160"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkNakedTyConApp"><span class="hs-identifier hs-var">mkNakedTyConApp</span></a><span> </span><a href="#local-6989586621680308989"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621680308989"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1161"></a><span>
</span><a name="line-1162"></a><span>           </span><a href="TcRnTypes.html#APromotionErr"><span class="hs-identifier hs-var">APromotionErr</span></a><span> </span><a name="local-6989586621680308990"><a href="#local-6989586621680308990"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-6989586621680308961"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680308990"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-1163"></a><span>
</span><a name="line-1164"></a><span>           </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEnv.html#wrongThingErr"><span class="hs-identifier hs-var">wrongThingErr</span></a><span> </span><span class="hs-string">&quot;type&quot;</span><span> </span><a href="#local-6989586621680308980"><span class="hs-identifier hs-var">thing</span></a><span> </span><a href="#local-6989586621680308961"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1165"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1166"></a><span>    </span><span class="hs-identifier">check_tc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1167"></a><span>    </span><a name="local-6989586621680308962"><a href="#local-6989586621680308962"><span class="hs-identifier">check_tc</span></a></a><span> </span><a name="local-6989586621680308965"><a href="#local-6989586621680308965"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308966"><a href="#local-6989586621680308966"><span class="hs-identifier">type_in_type</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#TypeInType"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TypeInType</span></a><span>
</span><a name="line-1168"></a><span>                     </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680308967"><a href="#local-6989586621680308967"><span class="hs-identifier">data_kinds</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DataKinds"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DataKinds</span></a><span>
</span><a name="line-1169"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">isTypeLevel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode_level</span><span> </span><a href="#local-6989586621680308960"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-1170"></a><span>                               </span><a href="#local-6989586621680308967"><span class="hs-identifier hs-var">data_kinds</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-1171"></a><span>                               </span><a href="TyCon.html#isKindTyCon"><span class="hs-identifier hs-var">isKindTyCon</span></a><span> </span><a href="#local-6989586621680308965"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1172"></a><span>                       </span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-6989586621680308961"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="TcRnTypes.html#NoDataKindsTC"><span class="hs-identifier hs-var">NoDataKindsTC</span></a><span>
</span><a name="line-1173"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">isTypeLevel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode_level</span><span> </span><a href="#local-6989586621680308960"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-1174"></a><span>                               </span><a href="#local-6989586621680308966"><span class="hs-identifier hs-var">type_in_type</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-1175"></a><span>                               </span><a href="DataCon.html#isLegacyPromotableTyCon"><span class="hs-identifier hs-var">isLegacyPromotableTyCon</span></a><span> </span><a href="#local-6989586621680308965"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1176"></a><span>                       </span><a href="TcHsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a><span> </span><a href="#local-6989586621680308961"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="TcRnTypes.html#NoTypeInTypeTC"><span class="hs-identifier hs-var">NoTypeInTypeTC</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1177"></a><span>
</span><a name="line-1178"></a><span>    </span><span class="hs-comment">-- if we are type-checking a type family tycon, we must instantiate</span><span>
</span><a name="line-1179"></a><span>    </span><span class="hs-comment">-- any invisible arguments right away. Otherwise, we get #11246</span><span>
</span><a name="line-1180"></a><span>    </span><span class="hs-identifier">handle_tyfams</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>     </span><span class="hs-comment">-- the tycon to instantiate (might be loopy)</span><span>
</span><a name="line-1181"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a><span>   </span><span class="hs-comment">-- a non-loopy version of the tycon</span><span>
</span><a name="line-1182"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1183"></a><span>    </span><a name="local-6989586621680308963"><a href="#local-6989586621680308963"><span class="hs-identifier">handle_tyfams</span></a></a><span> </span><a name="local-6989586621680308968"><a href="#local-6989586621680308968"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621680308969"><a href="#local-6989586621680308969"><span class="hs-identifier">tc_tc</span></a></a><span>
</span><a name="line-1184"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#mightBeUnsaturatedTyCon"><span class="hs-identifier hs-var">mightBeUnsaturatedTyCon</span></a><span> </span><a href="#local-6989586621680308969"><span class="hs-identifier hs-var">tc_tc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier">mode_unsat</span><span> </span><a href="#local-6989586621680308960"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-1185"></a><span>                                         </span><span class="hs-comment">-- This is where mode_unsat is used</span><span>
</span><a name="line-1186"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcTyVar2a&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308969"><span class="hs-identifier hs-var">tc_tc</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308970"><span class="hs-identifier hs-var">tc_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1187"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkNakedTyConApp"><span class="hs-identifier hs-var">mkNakedTyConApp</span></a><span> </span><a href="#local-6989586621680308968"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308970"><span class="hs-identifier hs-var">tc_kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1188"></a><span>
</span><a name="line-1189"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1190"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680308973"><a href="#local-6989586621680308973"><span class="hs-identifier">tc_args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308974"><a href="#local-6989586621680308974"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#instantiateTyN"><span class="hs-identifier hs-var">instantiateTyN</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConBinders</span><span> </span><a href="#local-6989586621680308969"><span class="hs-identifier hs-var">tc_tc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1191"></a><span>                                               </span><a href="#local-6989586621680308971"><span class="hs-identifier hs-var">tc_kind_bndrs</span></a><span> </span><a href="#local-6989586621680308972"><span class="hs-identifier hs-var">tc_inner_ki</span></a><span>
</span><a name="line-1192"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680308975"><a href="#local-6989586621680308975"><span class="hs-identifier">tc_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkNakedTyConApp"><span class="hs-identifier hs-var">mkNakedTyConApp</span></a><span> </span><a href="#local-6989586621680308968"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621680308973"><span class="hs-identifier hs-var">tc_args</span></a><span>
</span><a name="line-1193"></a><span>           </span><span class="hs-comment">-- tc and tc_ty must not be traced here, because that would</span><span>
</span><a name="line-1194"></a><span>           </span><span class="hs-comment">-- force the evaluation of a potentially knot-tied variable (tc),</span><span>
</span><a name="line-1195"></a><span>           </span><span class="hs-comment">-- and the typechecker would hang, as per #11708</span><span>
</span><a name="line-1196"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcTyVar2b&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308969"><span class="hs-identifier hs-var">tc_tc</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308970"><span class="hs-identifier hs-var">tc_kind</span></a><span>
</span><a name="line-1197"></a><span>                                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308974"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1198"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680308975"><span class="hs-identifier hs-var">tc_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308974"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1199"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1200"></a><span>        </span><a name="local-6989586621680308970"><a href="#local-6989586621680308970"><span class="hs-identifier">tc_kind</span></a></a><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621680308969"><span class="hs-identifier hs-var">tc_tc</span></a><span>
</span><a name="line-1201"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680308971"><a href="#local-6989586621680308971"><span class="hs-identifier">tc_kind_bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680308972"><a href="#local-6989586621680308972"><span class="hs-identifier">tc_inner_ki</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitPiTysInvisible"><span class="hs-identifier hs-var">splitPiTysInvisible</span></a><span> </span><a href="#local-6989586621680308970"><span class="hs-identifier hs-var">tc_kind</span></a><span>
</span><a name="line-1202"></a><span>
</span><a name="line-1203"></a><span>    </span><span class="hs-identifier">get_loopy_tc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-1204"></a><span>    </span><span class="hs-comment">-- Return the knot-tied global TyCon if there is one</span><span>
</span><a name="line-1205"></a><span>    </span><span class="hs-comment">-- Otherwise the local TcTyCon; we must be doing kind checking</span><span>
</span><a name="line-1206"></a><span>    </span><span class="hs-comment">-- but we still want to return a TyCon of some sort to use in</span><span>
</span><a name="line-1207"></a><span>    </span><span class="hs-comment">-- error messages</span><span>
</span><a name="line-1208"></a><span>    </span><a name="local-6989586621680308964"><a href="#local-6989586621680308964"><span class="hs-identifier">get_loopy_tc</span></a></a><span> </span><a name="local-6989586621680308976"><a href="#local-6989586621680308976"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621680308977"><a href="#local-6989586621680308977"><span class="hs-identifier">tc_tc</span></a></a><span>
</span><a name="line-1209"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308978"><a href="#local-6989586621680308978"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-1210"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_type_env</span><span> </span><a href="#local-6989586621680308978"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680308976"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1211"></a><span>                </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-6989586621680308979"><a href="#local-6989586621680308979"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680308979"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1212"></a><span>                </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;lk1 (loopy)&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308976"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1213"></a><span>                                       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680308977"><span class="hs-identifier hs-var">tc_tc</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1214"></a><span>
</span><a name="line-1215"></a><span class="hs-comment">{-
Note [Type-checking inside the knot]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we are checking the argument types of a data constructor.  We
must zonk the types before making the DataCon, because once built we
can't change it.  So we must traverse the type.

BUT the parent TyCon is knot-tied, so we can't look at it yet.

So we must be careful not to use &quot;smart constructors&quot; for types that
look at the TyCon or Class involved.

  * Hence the use of mkNakedXXX functions. These do *not* enforce
    the invariants (for example that we use (FunTy s t) rather
    than (TyConApp (-&gt;) [s,t])).

  * The zonking functions establish invariants (even zonkTcType, a change from
    previous behaviour). So we must never inspect the result of a
    zonk that might mention a knot-tied TyCon. This is generally OK
    because we zonk *kinds* while kind-checking types. And the TyCons
    in kinds shouldn't be knot-tied, because they come from a previous
    mutually recursive group.

  * TcHsSyn.zonkTcTypeToType also can safely check/establish
    invariants.

This is horribly delicate.  I hate it.  A good example of how
delicate it is can be seen in Trac #7903.

Note [GADT kind self-reference]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A promoted type cannot be used in the body of that type's declaration.
Trac #11554 shows this example, which made GHC loop:

  import Data.Kind
  data P (x :: k) = Q
  data A :: Type where
    B :: forall (a :: A). P a -&gt; A

In order to check the constructor B, we need to have the promoted type A, but in
order to get that promoted type, B must first be checked. To prevent looping, a
TyConPE promotion error is given when tcTyVar checks an ATcTyCon in kind mode.
Any ATcTyCon is a TyCon being defined in the current recursive group (see data
type decl for TcTyThing), and all such TyCons are illegal in kinds.

Trac #11962 proposes checking the head of a data declaration separately from
its constructors. This would allow the example above to pass.

Note [Body kind of a HsForAllTy]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The body of a forall is usually a type, but in principle
there's no reason to prohibit *unlifted* types.
In fact, GHC can itself construct a function with an
unboxed tuple inside a for-all (via CPR analysis; see
typecheck/should_compile/tc170).

Moreover in instance heads we get forall-types with
kind Constraint.

It's tempting to check that the body kind is either * or #. But this is
wrong. For example:

  class C a b
  newtype N = Mk Foo deriving (C a)

We're doing newtype-deriving for C. But notice how `a` isn't in scope in
the predicate `C a`. So we quantify, yielding `forall a. C a` even though
`C a` has kind `* -&gt; Constraint`. The `forall a. C a` is a bit cheeky, but
convenient. Bottom line: don't check for * or # here.

Note [Body kind of a HsQualTy]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If ctxt is non-empty, the HsQualTy really is a /function/, so the
kind of the result really is '*', and in that case the kind of the
body-type can be lifted or unlifted.

However, consider
    instance Eq a =&gt; Eq [a] where ...
or
    f :: (Eq a =&gt; Eq [a]) =&gt; blah
Here both body-kind of the HsQualTy is Constraint rather than *.
Rather crudely we tell the difference by looking at exp_kind. It's
very convenient to typecheck instance types like any other HsSigType.

Admittedly the '(Eq a =&gt; Eq [a]) =&gt; blah' case is erroneous, but it's
better to reject in checkValidType.  If we say that the body kind
should be '*' we risk getting TWO error messages, one saying that Eq
[a] doens't have kind '*', and one saying that we need a Constraint to
the left of the outer (=&gt;).

How do we figure out the right body kind?  Well, it's a bit of a
kludge: I just look at the expected kind.  If it's Constraint, we
must be in this instance situation context. It's a kludge because it
wouldn't work if any unification was involved to compute that result
kind -- but it isn't.  (The true way might be to use the 'mode'
parameter, but that seemed like a sledgehammer to crack a nut.)

Note [Inferring tuple kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Give a tuple type (a,b,c), which the parser labels as HsBoxedOrConstraintTuple,
we try to figure out whether it's a tuple of kind * or Constraint.
  Step 1: look at the expected kind
  Step 2: infer argument kinds

If after Step 2 it's not clear from the arguments that it's
Constraint, then it must be *.  Once having decided that we re-check
the Check the arguments again to give good error messages
in eg. `(Maybe, Maybe)`

Note that we will still fail to infer the correct kind in this case:

  type T a = ((a,a), D a)
  type family D :: Constraint -&gt; Constraint

While kind checking T, we do not yet know the kind of D, so we will default the
kind of T to * -&gt; *. It works if we annotate `a` with kind `Constraint`.

Note [Desugaring types]
~~~~~~~~~~~~~~~~~~~~~~~
The type desugarer is phase 2 of dealing with HsTypes.  Specifically:

  * It transforms from HsType to Type

  * It zonks any kinds.  The returned type should have no mutable kind
    or type variables (hence returning Type not TcType):
      - any unconstrained kind variables are defaulted to (Any *) just
        as in TcHsSyn.
      - there are no mutable type variables because we are
        kind-checking a type
    Reason: the returned type may be put in a TyCon or DataCon where
    it will never subsequently be zonked.

You might worry about nested scopes:
        ..a:kappa in scope..
            let f :: forall b. T '[a,b] -&gt; Int
In this case, f's type could have a mutable kind variable kappa in it;
and we might then default it to (Any *) when dealing with f's type
signature.  But we don't expect this to happen because we can't get a
lexically scoped type variable with a mutable kind variable in it.  A
delicate point, this.  If it becomes an issue we might need to
distinguish top-level from nested uses.

Moreover
  * it cannot fail,
  * it does no unifications
  * it does no validity checking, except for structural matters, such as
        (a) spurious ! annotations.
        (b) a class used as a type

Note [Kind of a type splice]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider these terms, each with TH type splice inside:
     [| e1 :: Maybe $(..blah..) |]
     [| e2 :: $(..blah..) |]
When kind-checking the type signature, we'll kind-check the splice
$(..blah..); we want to give it a kind that can fit in any context,
as if $(..blah..) :: forall k. k.

In the e1 example, the context of the splice fixes kappa to *.  But
in the e2 example, we'll desugar the type, zonking the kind unification
variables as we go.  When we encounter the unconstrained kappa, we
want to default it to '*', not to (Any *).


Help functions for type applications
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-}</span><span>
</span><a name="line-1383"></a><span>
</span><a name="line-1384"></a><span class="hs-identifier">addTypeCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308540"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308540"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1385"></a><span>        </span><span class="hs-comment">-- Wrap a context around only if we want to show that contexts.</span><span>
</span><a name="line-1386"></a><span>        </span><span class="hs-comment">-- Omit invisible ones and ones user's won't grok</span><span>
</span><a name="line-1387"></a><a name="addTypeCtxt"><a href="TcHsType.html#addTypeCtxt"><span class="hs-identifier">addTypeCtxt</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680308991"><a href="#local-6989586621680308991"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680308992"><a href="#local-6989586621680308992"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-1388"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><a href="#local-6989586621680308993"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621680308992"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1389"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1390"></a><span>    </span><a name="local-6989586621680308993"><a href="#local-6989586621680308993"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In the type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680308991"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1391"></a><span>
</span><a name="line-1392"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Type-variable binders
%*                                                                      *
%************************************************************************

Note [Dependent LHsQTyVars]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
We track (in the renamer) which explicitly bound variables in a
LHsQTyVars are manifestly dependent; only precisely these variables
may be used within the LHsQTyVars. We must do this so that kcLHsQTyVars
can produce the right TyConBinders, and tell Anon vs. Required.

Example   data T k1 (a:k1) (b:k2) c
               = MkT (Proxy a) (Proxy b) (Proxy c)

Here
  (a:k1),(b:k2),(c:k3)
       are Anon     (explicitly specified as a binder, not used
                     in the kind of any other binder
  k1   is Required  (explicitly specifed as a binder, but used
                     in the kind of another binder i.e. dependently)
  k2   is Specified (not explicitly bound, but used in the kind
                     of another binder)
  k3   in Inferred  (not lexically in scope at all, but inferred
                     by kind inference)
and
  T :: forall {k3} k1. forall k3 -&gt; k1 -&gt; k2 -&gt; k3 -&gt; *

See Note [TyVarBndrs, TyVarBinders, TyConBinders, and visibility]
in TyCoRep.

kcLHsQTyVars uses the hsq_dependent field to decide whether
k1, a, b, c should be Required or Anon.

Earlier, thought it would work simply to do a free-variable check
during kcLHsQTyVars, but this is bogus, because there may be
unsolved equalities about. And we don't want to eagerly solve the
equalities, because we may get further information after
kcLHsQTyVars is called.  (Recall that kcLHsQTyVars is called
only from getInitialKind.)
This is what implements the rule that all variables intended to be
dependent must be manifestly so.

Sidenote: It's quite possible that later, we'll consider (t -&gt; s)
as a degenerate case of some (pi (x :: t) -&gt; s) and then this will
all get more permissive.

Note [Kind generalisation and SigTvs]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  data T (a :: k1) x = MkT (S a ())
  data S (b :: k2) y = MkS (T b ())

While we are doing kind inference for the mutually-recursive S,T,
we will end up unifying k1 and k2 together. So they can't be skolems.
We therefore make them SigTvs, which can unify with type variables,
but not with general types.  All this is very similar at the level
of terms: see Note [Quantified variables in partial type signatures]
in TcBinds.

There are some wrinkles

* We always want to kind-generalise over SigTvs, and /not/ default
  them to Type.  Another way to say this is: a SigTV should /never/
  stand for a type, even via defaulting. Hence the check in
  TcSimplify.defaultTyVarTcS, and TcMType.defaultTyVar.  Here's
  another example (Trac #14555):
     data Exp :: [TYPE rep] -&gt; TYPE rep -&gt; Type where
        Lam :: Exp (a:xs) b -&gt; Exp xs (a -&gt; b)
  We want to kind-generalise over the 'rep' variable.
  Trac #14563 is another example.

* Consider Trac #11203
    data SameKind :: k -&gt; k -&gt; *
    data Q (a :: k1) (b :: k2) c = MkQ (SameKind a b)
  Here we will unify k1 with k2, but this time doing so is an error,
  because k1 and k2 are bound in the same delcaration.

  We sort this out using findDupSigTvs, in TcTyClTyVars; very much
  as we do with partial type signatures in mk_psig_qtvs in
  TcBinds.chooseInferredQuantifiers

Note [Keeping scoped variables in order: Explicit]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When the user writes `forall a b c. blah`, we bring a, b, and c into
scope and then check blah. In the process of checking blah, we might
learn the kinds of a, b, and c, and these kinds might indicate that
b depends on c, and thus that we should reject the user-written type.

One approach to doing this would be to bring each of a, b, and c into
scope, one at a time, creating an implication constraint and
bumping the TcLevel for each one. This would work, because the kind
of, say, b would be untouchable when c is in scope (and the constraint
couldn't float out because c blocks it). However, it leads to terrible
error messages, complaining about skolem escape. While it is indeed
a problem of skolem escape, we can do better.

Instead, our approach is to bring the block of variables into scope
all at once, creating one implication constraint for the lot. The
user-written variables are skolems in the implication constraint. In
TcSimplify.setImplicationStatus, we check to make sure that the ordering
is correct, choosing ImplicationStatus IC_BadTelescope if they aren't.
Then, in TcErrors, we report if there is a bad telescope. This way,
we can report a suggested ordering to the user if there is a problem.

Note [Keeping scoped variables in order: Implicit]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When the user implicitly quantifies over variables (say, in a type
signature), we need to come up with some ordering on these variables.
This is done by bumping the TcLevel, bringing the tyvars into scope,
and then type-checking the thing_inside. The constraints are all
wrapped in an implication, which is then solved. Finally, we can
zonk all the binders and then order them with toposortTyVars.

It's critical to solve before zonking and ordering in order to uncover
any unifications. You might worry that this eager solving could cause
trouble elsewhere. I don't think it will. Because it will solve only
in an increased TcLevel, it can't unify anything that was mentioned
elsewhere. Additionally, we require that the order of implicitly
quantified variables is manifest by the scope of these variables, so
we're not going to learn more information later that will help order
these variables.

Note [Recipe for checking a signature]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Checking a user-written signature requires several steps:

 1. Generate constraints.
 2. Solve constraints.
 3. Zonk and promote tyvars.
 4. (Optional) Kind-generalize.
 5. Check validity.

There may be some surprises in here:

Step 2 is necessary for two reasons: most signatures also bring
implicitly quantified variables into scope, and solving is necessary
to get these in the right order (see Note [Keeping scoped variables in
order: Implicit]). Additionally, solving is necessary in order to
kind-generalize correctly.

Step 3 requires *promoting* type variables. If there are any foralls
in a type, the TcLevel will be bumped within the forall. This might
lead to the generation of matavars with a high level. If we don't promote,
we violate MetaTvInv of Note [TcLevel and untouchable type variables]
in TcType.

-}</span><span>
</span><a name="line-1542"></a><span>
</span><a name="line-1543"></a><span class="hs-identifier">tcWildCardBinders</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span>
</span><a name="line-1544"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1545"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308539"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1546"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308539"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1547"></a><a name="tcWildCardBinders"><a href="TcHsType.html#tcWildCardBinders"><span class="hs-identifier">tcWildCardBinders</span></a></a><span> </span><a name="local-6989586621680308994"><a href="#local-6989586621680308994"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcWildCardBindersX"><span class="hs-identifier hs-var">tcWildCardBindersX</span></a><span> </span><a href="#local-6989586621680308995"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621680308994"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span>
</span><a name="line-1548"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1549"></a><span>    </span><a name="local-6989586621680308995"><a href="#local-6989586621680308995"><span class="hs-identifier">new_tv</span></a></a><span> </span><a name="local-6989586621680308996"><a href="#local-6989586621680308996"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680308997"><a href="#local-6989586621680308997"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-1550"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#newSkolemTyVar"><span class="hs-identifier hs-var">newSkolemTyVar</span></a><span> </span><a href="#local-6989586621680308996"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680308997"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1551"></a><span>
</span><a name="line-1552"></a><span class="hs-identifier">tcWildCardBindersX</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-1553"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-comment">-- Just &lt;=&gt; we're bringing fresh vars</span><span>
</span><a name="line-1554"></a><span>                                       </span><span class="hs-comment">-- into scope; use scopeTyVars</span><span>
</span><a name="line-1555"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1556"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308538"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1557"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308538"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1558"></a><a name="tcWildCardBindersX"><a href="TcHsType.html#tcWildCardBindersX"><span class="hs-identifier">tcWildCardBindersX</span></a></a><span> </span><a name="local-6989586621680308998"><a href="#local-6989586621680308998"><span class="hs-identifier">new_wc</span></a></a><span> </span><a name="local-6989586621680308999"><a href="#local-6989586621680308999"><span class="hs-identifier">maybe_skol_info</span></a></a><span> </span><a name="local-6989586621680309000"><a href="#local-6989586621680309000"><span class="hs-identifier">wc_names</span></a></a><span> </span><a name="local-6989586621680309001"><a href="#local-6989586621680309001"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1559"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309004"><a href="#local-6989586621680309004"><span class="hs-identifier">wcs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-6989586621680308998"><span class="hs-identifier hs-var">new_wc</span></a><span> </span><a href="#local-6989586621680309000"><span class="hs-identifier hs-var">wc_names</span></a><span>
</span><a name="line-1560"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309005"><a href="#local-6989586621680309005"><span class="hs-identifier">wc_prs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680309000"><span class="hs-identifier hs-var">wc_names</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680309004"><span class="hs-identifier hs-var">wcs</span></a><span>
</span><a name="line-1561"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621680309002"><span class="hs-identifier hs-var">scope_tvs</span></a><span> </span><a href="#local-6989586621680309005"><span class="hs-identifier hs-var">wc_prs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1562"></a><span>         </span><a href="#local-6989586621680309001"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621680309005"><span class="hs-identifier hs-var">wc_prs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1563"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1564"></a><span>    </span><a name="local-6989586621680309002"><a href="#local-6989586621680309002"><span class="hs-identifier">scope_tvs</span></a></a><span>
</span><a name="line-1565"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680309003"><a href="#local-6989586621680309003"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680308999"><span class="hs-identifier hs-var">maybe_skol_info</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#scopeTyVars2"><span class="hs-identifier hs-var">scopeTyVars2</span></a><span> </span><a href="#local-6989586621680309003"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1566"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="TcEnv.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a><span>
</span><a name="line-1567"></a><span>
</span><a name="line-1568"></a><span class="hs-comment">-- | Kind-check a 'LHsQTyVars'. If the decl under consideration has a complete,</span><span>
</span><a name="line-1569"></a><span class="hs-comment">-- user-supplied kind signature (CUSK), generalise the result.</span><span>
</span><a name="line-1570"></a><span class="hs-comment">-- Used in 'getInitialKind' (for tycon kinds and other kinds)</span><span>
</span><a name="line-1571"></a><span class="hs-comment">-- and in kind-checking (but not for tycon kinds, which are checked with</span><span>
</span><a name="line-1572"></a><span class="hs-comment">-- tcTyClDecls). See also Note [Complete user-supplied kind signatures] in</span><span>
</span><a name="line-1573"></a><span class="hs-comment">-- HsDecls.</span><span>
</span><a name="line-1574"></a><span class="hs-comment">--</span><span>
</span><a name="line-1575"></a><span class="hs-comment">-- This function does not do telescope checking.</span><span>
</span><a name="line-1576"></a><span class="hs-identifier">kcLHsQTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>              </span><span class="hs-comment">-- ^ of the thing being checked</span><span>
</span><a name="line-1577"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a><span>      </span><span class="hs-comment">-- ^ What sort of 'TyCon' is being checked</span><span>
</span><a name="line-1578"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>              </span><span class="hs-comment">-- ^ True &lt;=&gt; the decl being checked has a CUSK</span><span>
</span><a name="line-1579"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>
</span><a name="line-1580"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308537"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ The result kind, possibly with other info</span><span>
</span><a name="line-1581"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308537"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ A suitably-kinded TcTyCon</span><span>
</span><a name="line-1582"></a><a name="kcLHsQTyVars"><a href="TcHsType.html#kcLHsQTyVars"><span class="hs-identifier">kcLHsQTyVars</span></a></a><span> </span><a name="local-6989586621680309006"><a href="#local-6989586621680309006"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621680309007"><a href="#local-6989586621680309007"><span class="hs-identifier">flav</span></a></a><span> </span><a name="local-6989586621680309008"><a href="#local-6989586621680309008"><span class="hs-identifier">cusk</span></a></a><span>
</span><a name="line-1583"></a><span>  </span><a name="local-6989586621680309009"><a href="#local-6989586621680309009"><span class="hs-identifier">user_tyvars</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsQTvs"><span class="hs-identifier hs-var">HsQTvs</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsq_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#HsQTvsRn"><span class="hs-identifier hs-var">HsQTvsRn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsq_implicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309010"><a href="#local-6989586621680309010"><span class="hs-identifier">kv_ns</span></a></a><span>
</span><a name="line-1584"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsq_dependent</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309011"><a href="#local-6989586621680309011"><span class="hs-identifier">dep_names</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1585"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsq_explicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309012"><a href="#local-6989586621680309012"><span class="hs-identifier">hs_tvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680309013"><a href="#local-6989586621680309013"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1586"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680309008"><span class="hs-identifier hs-var">cusk</span></a><span>
</span><a name="line-1587"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309031"><a href="#local-6989586621680309031"><span class="hs-identifier">typeintype</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#TypeInType"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TypeInType</span></a><span>
</span><a name="line-1588"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309032"><a href="#local-6989586621680309032"><span class="hs-identifier">m_kind</span></a></a><span>
</span><a name="line-1589"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680309031"><span class="hs-identifier hs-var">typeintype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1590"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-1591"></a><span>                 </span><span class="hs-comment">-- without -XTypeInType, default all kind variables to have kind *</span><span>
</span><a name="line-1592"></a><span>
</span><a name="line-1593"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309033"><a href="#local-6989586621680309033"><span class="hs-identifier">scoped_kvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309034"><a href="#local-6989586621680309034"><span class="hs-identifier">tc_tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309035"><a href="#local-6989586621680309035"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309036"><a href="#local-6989586621680309036"><span class="hs-identifier">stuff</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1594"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1595"></a><span>              </span><a href="TcHsType.html#tcImplicitTKBndrsX"><span class="hs-identifier hs-var">tcImplicitTKBndrsX</span></a><span> </span><a href="TcMType.html#newSkolemTyVar"><span class="hs-identifier hs-var">newSkolemTyVar</span></a><span> </span><a href="#local-6989586621680309032"><span class="hs-identifier hs-var">m_kind</span></a><span> </span><a href="#local-6989586621680309016"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680309010"><span class="hs-identifier hs-var">kv_ns</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1596"></a><span>              </span><a href="TcHsType.html#kcLHsTyVarBndrs"><span class="hs-identifier hs-var">kcLHsTyVarBndrs</span></a><span> </span><a href="#local-6989586621680309008"><span class="hs-identifier hs-var">cusk</span></a><span> </span><a href="#local-6989586621680309014"><span class="hs-identifier hs-var">open_fam</span></a><span> </span><a href="#local-6989586621680309016"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680309012"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><a href="#local-6989586621680309013"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1597"></a><span>
</span><a name="line-1598"></a><span>           </span><span class="hs-comment">-- Now, because we're in a CUSK, quantify over the mentioned</span><span>
</span><a name="line-1599"></a><span>           </span><span class="hs-comment">-- kind vars, in dependency order.</span><span>
</span><a name="line-1600"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309037"><a href="#local-6989586621680309037"><span class="hs-identifier">tc_tvs</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcTyVarToTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTyVar</span></a><span> </span><a href="#local-6989586621680309034"><span class="hs-identifier hs-var">tc_tvs</span></a><span>
</span><a name="line-1601"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309038"><a href="#local-6989586621680309038"><span class="hs-identifier">res_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621680309035"><span class="hs-identifier hs-var">res_kind</span></a><span>
</span><a name="line-1602"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309039"><a href="#local-6989586621680309039"><span class="hs-identifier">tc_binders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="#local-6989586621680309017"><span class="hs-identifier hs-var">mk_tc_binder</span></a><span> </span><a href="#local-6989586621680309012"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><a href="#local-6989586621680309037"><span class="hs-identifier hs-var">tc_tvs</span></a><span>
</span><a name="line-1603"></a><span>             </span><a name="local-6989586621680309040"><a href="#local-6989586621680309040"><span class="hs-identifier">qkvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tyCoVarsOfTypeWellScoped"><span class="hs-identifier hs-var">tyCoVarsOfTypeWellScoped</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#mkTyConKind"><span class="hs-identifier hs-var">mkTyConKind</span></a><span> </span><a href="#local-6989586621680309039"><span class="hs-identifier hs-var">tc_binders</span></a><span> </span><a href="#local-6989586621680309038"><span class="hs-identifier hs-var">res_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1604"></a><span>                   </span><span class="hs-comment">-- the visibility of tvs doesn't matter here; we just</span><span>
</span><a name="line-1605"></a><span>                   </span><span class="hs-comment">-- want the free variables not to include the tvs</span><span>
</span><a name="line-1606"></a><span>
</span><a name="line-1607"></a><span>          </span><span class="hs-comment">-- If there are any meta-tvs left, the user has</span><span>
</span><a name="line-1608"></a><span>          </span><span class="hs-comment">-- lied about having a CUSK. Error.</span><span>
</span><a name="line-1609"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309041"><a href="#local-6989586621680309041"><span class="hs-identifier">meta_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309042"><a href="#local-6989586621680309042"><span class="hs-identifier">good_tvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a><span> </span><a href="#local-6989586621680309040"><span class="hs-identifier hs-var">qkvs</span></a><span>
</span><a name="line-1610"></a><span>          </span><span class="hs-comment">-- skip this check for associated types. Why?</span><span>
</span><a name="line-1611"></a><span>          </span><span class="hs-comment">-- Any variables mentioned in the definition will get defaulted,</span><span>
</span><a name="line-1612"></a><span>          </span><span class="hs-comment">-- except those that appear in the class head. Defaulted vars do</span><span>
</span><a name="line-1613"></a><span>          </span><span class="hs-comment">-- not concern us here (they are fully determined). Variables from</span><span>
</span><a name="line-1614"></a><span>          </span><span class="hs-comment">-- the class head will be fully determined whenever the class has</span><span>
</span><a name="line-1615"></a><span>          </span><span class="hs-comment">-- a CUSK, and an associated family has a CUSK only when the enclosing</span><span>
</span><a name="line-1616"></a><span>          </span><span class="hs-comment">-- class has one. So skipping is safe. But why is it necessary?</span><span>
</span><a name="line-1617"></a><span>          </span><span class="hs-comment">-- It's possible that a class variable has too low a TcLevel to have</span><span>
</span><a name="line-1618"></a><span>          </span><span class="hs-comment">-- fully settled down by this point, and so this check will get</span><span>
</span><a name="line-1619"></a><span>          </span><span class="hs-comment">-- a false positive.</span><span>
</span><a name="line-1620"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309015"><span class="hs-identifier hs-var">not_associated</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680309041"><span class="hs-identifier hs-var">meta_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1621"></a><span>         </span><a href="#local-6989586621680309018"><span class="hs-identifier hs-var">report_non_cusk_tvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309040"><span class="hs-identifier hs-var">qkvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680309037"><span class="hs-identifier hs-var">tc_tvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309038"><span class="hs-identifier hs-var">res_kind</span></a><span>
</span><a name="line-1622"></a><span>
</span><a name="line-1623"></a><span>          </span><span class="hs-comment">-- If any of the scoped_kvs aren't actually mentioned in a binder's</span><span>
</span><a name="line-1624"></a><span>          </span><span class="hs-comment">-- kind (or the return kind), then we're in the CUSK case from</span><span>
</span><a name="line-1625"></a><span>          </span><span class="hs-comment">-- Note [Free-floating kind vars]</span><span>
</span><a name="line-1626"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309043"><a href="#local-6989586621680309043"><span class="hs-identifier">all_tc_tvs</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680309042"><span class="hs-identifier hs-var">good_tvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680309037"><span class="hs-identifier hs-var">tc_tvs</span></a><span>
</span><a name="line-1627"></a><span>             </span><a name="local-6989586621680309044"><a href="#local-6989586621680309044"><span class="hs-identifier">all_mentioned_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#mapUnionVarSet"><span class="hs-identifier hs-var">mapUnionVarSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1628"></a><span>                                                </span><a href="#local-6989586621680309043"><span class="hs-identifier hs-var">all_tc_tvs</span></a><span>
</span><a name="line-1629"></a><span>                                 </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621680309038"><span class="hs-identifier hs-var">res_kind</span></a><span>
</span><a name="line-1630"></a><span>             </span><a name="local-6989586621680309045"><a href="#local-6989586621680309045"><span class="hs-identifier">unmentioned_kvs</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680309044"><span class="hs-identifier hs-var">all_mentioned_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1631"></a><span>                                           </span><a href="#local-6989586621680309033"><span class="hs-identifier hs-var">scoped_kvs</span></a><span>
</span><a name="line-1632"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#reportFloatingKvs"><span class="hs-identifier hs-var">reportFloatingKvs</span></a><span> </span><a href="#local-6989586621680309006"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680309007"><span class="hs-identifier hs-var">flav</span></a><span> </span><a href="#local-6989586621680309043"><span class="hs-identifier hs-var">all_tc_tvs</span></a><span> </span><a href="#local-6989586621680309045"><span class="hs-identifier hs-var">unmentioned_kvs</span></a><span>
</span><a name="line-1633"></a><span>
</span><a name="line-1634"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309046"><a href="#local-6989586621680309046"><span class="hs-identifier">final_binders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#mkNamedTyConBinder"><span class="hs-identifier hs-var">mkNamedTyConBinder</span></a><span> </span><a href="Var.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309042"><span class="hs-identifier hs-var">good_tvs</span></a><span>
</span><a name="line-1635"></a><span>                            </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680309039"><span class="hs-identifier hs-var">tc_binders</span></a><span>
</span><a name="line-1636"></a><span>             </span><a name="local-6989586621680309047"><a href="#local-6989586621680309047"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#mkTcTyCon"><span class="hs-identifier hs-var">mkTcTyCon</span></a><span> </span><a href="#local-6989586621680309006"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309009"><span class="hs-identifier hs-var">user_tyvars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309046"><span class="hs-identifier hs-var">final_binders</span></a><span> </span><a href="#local-6989586621680309038"><span class="hs-identifier hs-var">res_kind</span></a><span>
</span><a name="line-1637"></a><span>                               </span><span class="hs-special">(</span><a href="TcType.html#mkTyVarNamePairs"><span class="hs-identifier hs-var">mkTyVarNamePairs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309033"><span class="hs-identifier hs-var">scoped_kvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680309037"><span class="hs-identifier hs-var">tc_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1638"></a><span>                               </span><a href="#local-6989586621680309007"><span class="hs-identifier hs-var">flav</span></a><span>
</span><a name="line-1639"></a><span>                           </span><span class="hs-comment">-- the tvs contain the binders already</span><span>
</span><a name="line-1640"></a><span>                           </span><span class="hs-comment">-- in scope from an enclosing class, but</span><span>
</span><a name="line-1641"></a><span>                           </span><span class="hs-comment">-- re-adding tvs to the env't doesn't cause</span><span>
</span><a name="line-1642"></a><span>                           </span><span class="hs-comment">-- harm</span><span>
</span><a name="line-1643"></a><span>
</span><a name="line-1644"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;kcLHsQTyVars: cusk&quot;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1645"></a><span>         </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309006"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309010"><span class="hs-identifier hs-var">kv_ns</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309012"><span class="hs-identifier hs-var">hs_tvs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309011"><span class="hs-identifier hs-var">dep_names</span></a><span>
</span><a name="line-1646"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309037"><span class="hs-identifier hs-var">tc_tvs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#mkTyConKind"><span class="hs-identifier hs-var">mkTyConKind</span></a><span> </span><a href="#local-6989586621680309046"><span class="hs-identifier hs-var">final_binders</span></a><span> </span><a href="#local-6989586621680309038"><span class="hs-identifier hs-var">res_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1647"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309040"><span class="hs-identifier hs-var">qkvs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309041"><span class="hs-identifier hs-var">meta_tvs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309042"><span class="hs-identifier hs-var">good_tvs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309046"><span class="hs-identifier hs-var">final_binders</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1648"></a><span>
</span><a name="line-1649"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309047"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309036"><span class="hs-identifier hs-var">stuff</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1650"></a><span>
</span><a name="line-1651"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1652"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309048"><a href="#local-6989586621680309048"><span class="hs-identifier">typeintype</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#TypeInType"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TypeInType</span></a><span>
</span><a name="line-1653"></a><span>
</span><a name="line-1654"></a><span>             </span><span class="hs-comment">-- if -XNoTypeInType and we know all the implicits are kind vars,</span><span>
</span><a name="line-1655"></a><span>             </span><span class="hs-comment">-- just give the kind *. This prevents test</span><span>
</span><a name="line-1656"></a><span>             </span><span class="hs-comment">-- dependent/should_fail/KindLevelsB from compiling, as it should</span><span>
</span><a name="line-1657"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309049"><a href="#local-6989586621680309049"><span class="hs-identifier">default_kind</span></a></a><span>
</span><a name="line-1658"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680309048"><span class="hs-identifier hs-var">typeintype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1659"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-1660"></a><span>           </span><span class="hs-comment">-- Why newSigTyVar?  See Note [Kind generalisation and sigTvs]</span><span>
</span><a name="line-1661"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309050"><a href="#local-6989586621680309050"><span class="hs-identifier">scoped_kvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309051"><a href="#local-6989586621680309051"><span class="hs-identifier">tc_tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309052"><a href="#local-6989586621680309052"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309053"><a href="#local-6989586621680309053"><span class="hs-identifier">stuff</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1662"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#kcImplicitTKBndrs"><span class="hs-identifier hs-var">kcImplicitTKBndrs</span></a><span> </span><a href="#local-6989586621680309010"><span class="hs-identifier hs-var">kv_ns</span></a><span> </span><a href="#local-6989586621680309049"><span class="hs-identifier hs-var">default_kind</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1663"></a><span>              </span><a href="TcHsType.html#kcLHsTyVarBndrs"><span class="hs-identifier hs-var">kcLHsTyVarBndrs</span></a><span> </span><a href="#local-6989586621680309008"><span class="hs-identifier hs-var">cusk</span></a><span> </span><a href="#local-6989586621680309014"><span class="hs-identifier hs-var">open_fam</span></a><span> </span><a href="#local-6989586621680309016"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680309012"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><a href="#local-6989586621680309013"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1664"></a><span>
</span><a name="line-1665"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>   </span><span class="hs-comment">-- NB: Don't add scoped_kvs to tyConTyVars, because they</span><span>
</span><a name="line-1666"></a><span>               </span><span class="hs-comment">-- must remain lined up with the binders</span><span>
</span><a name="line-1667"></a><span>             </span><a name="local-6989586621680309054"><a href="#local-6989586621680309054"><span class="hs-identifier">tc_binders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="#local-6989586621680309017"><span class="hs-identifier hs-var">mk_tc_binder</span></a><span> </span><a href="#local-6989586621680309012"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><a href="#local-6989586621680309051"><span class="hs-identifier hs-var">tc_tvs</span></a><span>
</span><a name="line-1668"></a><span>             </span><a name="local-6989586621680309055"><a href="#local-6989586621680309055"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#mkTcTyCon"><span class="hs-identifier hs-var">mkTcTyCon</span></a><span> </span><a href="#local-6989586621680309006"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309009"><span class="hs-identifier hs-var">user_tyvars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309054"><span class="hs-identifier hs-var">tc_binders</span></a><span> </span><a href="#local-6989586621680309052"><span class="hs-identifier hs-var">res_kind</span></a><span>
</span><a name="line-1669"></a><span>                               </span><span class="hs-special">(</span><a href="TcType.html#mkTyVarNamePairs"><span class="hs-identifier hs-var">mkTyVarNamePairs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309050"><span class="hs-identifier hs-var">scoped_kvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680309051"><span class="hs-identifier hs-var">tc_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1670"></a><span>                               </span><a href="#local-6989586621680309007"><span class="hs-identifier hs-var">flav</span></a><span>
</span><a name="line-1671"></a><span>
</span><a name="line-1672"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;kcLHsQTyVars: not-cusk&quot;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1673"></a><span>         </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309006"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309010"><span class="hs-identifier hs-var">kv_ns</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309012"><span class="hs-identifier hs-var">hs_tvs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309011"><span class="hs-identifier hs-var">dep_names</span></a><span>
</span><a name="line-1674"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309051"><span class="hs-identifier hs-var">tc_tvs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#mkTyConKind"><span class="hs-identifier hs-var">mkTyConKind</span></a><span> </span><a href="#local-6989586621680309054"><span class="hs-identifier hs-var">tc_binders</span></a><span> </span><a href="#local-6989586621680309052"><span class="hs-identifier hs-var">res_kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1675"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309055"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309053"><span class="hs-identifier hs-var">stuff</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1676"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1677"></a><span>    </span><a name="local-6989586621680309014"><a href="#local-6989586621680309014"><span class="hs-identifier">open_fam</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tcFlavourIsOpen"><span class="hs-identifier hs-var">tcFlavourIsOpen</span></a><span> </span><a href="#local-6989586621680309007"><span class="hs-identifier hs-var">flav</span></a><span>
</span><a name="line-1678"></a><span>    </span><a name="local-6989586621680309015"><a href="#local-6989586621680309015"><span class="hs-identifier">not_associated</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680309007"><span class="hs-identifier hs-var">flav</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1679"></a><span>      </span><a href="TyCon.html#DataFamilyFlavour"><span class="hs-identifier hs-var">DataFamilyFlavour</span></a><span> </span><a name="local-6989586621680309019"><a href="#local-6989586621680309019"><span class="hs-identifier">assoc</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621680309019"><span class="hs-identifier hs-var">assoc</span></a><span>
</span><a name="line-1680"></a><span>      </span><a href="TyCon.html#OpenTypeFamilyFlavour"><span class="hs-identifier hs-var">OpenTypeFamilyFlavour</span></a><span> </span><a name="local-6989586621680309020"><a href="#local-6989586621680309020"><span class="hs-identifier">assoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621680309020"><span class="hs-identifier hs-var">assoc</span></a><span>
</span><a name="line-1681"></a><span>      </span><span class="hs-identifier">_</span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1682"></a><span>
</span><a name="line-1683"></a><span>    </span><a name="local-6989586621680309016"><a href="#local-6989586621680309016"><span class="hs-identifier">skol_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TyConSkol"><span class="hs-identifier hs-var">TyConSkol</span></a><span> </span><a href="#local-6989586621680309007"><span class="hs-identifier hs-var">flav</span></a><span> </span><a href="#local-6989586621680309006"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1684"></a><span>
</span><a name="line-1685"></a><span>    </span><span class="hs-identifier">mk_tc_binder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span>
</span><a name="line-1686"></a><span>    </span><span class="hs-comment">-- See Note [Dependent LHsQTyVars]</span><span>
</span><a name="line-1687"></a><span>    </span><a name="local-6989586621680309017"><a href="#local-6989586621680309017"><span class="hs-identifier">mk_tc_binder</span></a></a><span> </span><a name="local-6989586621680309021"><a href="#local-6989586621680309021"><span class="hs-identifier">hs_tv</span></a></a><span> </span><a name="local-6989586621680309022"><a href="#local-6989586621680309022"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1688"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="HsTypes.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a><span> </span><a href="#local-6989586621680309021"><span class="hs-identifier hs-var">hs_tv</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680309011"><span class="hs-identifier hs-var">dep_names</span></a><span>
</span><a name="line-1689"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#mkNamedTyConBinder"><span class="hs-identifier hs-var">mkNamedTyConBinder</span></a><span> </span><a href="Var.html#Required"><span class="hs-identifier hs-var">Required</span></a><span> </span><a href="#local-6989586621680309022"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1690"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1691"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#mkAnonTyConBinder"><span class="hs-identifier hs-var">mkAnonTyConBinder</span></a><span> </span><a href="#local-6989586621680309022"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1692"></a><span>
</span><a name="line-1693"></a><span>    </span><a name="local-6989586621680309018"><a href="#local-6989586621680309018"><span class="hs-identifier">report_non_cusk_tvs</span></a></a><span> </span><a name="local-6989586621680309023"><a href="#local-6989586621680309023"><span class="hs-identifier">all_tvs</span></a></a><span> </span><a name="local-6989586621680309024"><a href="#local-6989586621680309024"><span class="hs-identifier">res_kind</span></a></a><span>
</span><a name="line-1694"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309027"><a href="#local-6989586621680309027"><span class="hs-identifier">all_tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a><span> </span><a href="#local-6989586621680309023"><span class="hs-identifier hs-var">all_tvs</span></a><span>
</span><a name="line-1695"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680309028"><a href="#local-6989586621680309028"><span class="hs-identifier">tidy_tvs</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyOpenTyCoVars"><span class="hs-identifier hs-var">tidyOpenTyCoVars</span></a><span> </span><a href="VarEnv.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a><span> </span><a href="#local-6989586621680309027"><span class="hs-identifier hs-var">all_tvs</span></a><span>
</span><a name="line-1696"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621680309029"><a href="#local-6989586621680309029"><span class="hs-identifier">meta_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309030"><a href="#local-6989586621680309030"><span class="hs-identifier">other_tvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a><span> </span><a href="#local-6989586621680309028"><span class="hs-identifier hs-var">tidy_tvs</span></a><span>
</span><a name="line-1697"></a><span>
</span><a name="line-1698"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1699"></a><span>             </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;You have written a *complete user-suppled kind signature*,&quot;</span><span>
</span><a name="line-1700"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;but the following variable&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a><span> </span><a href="#local-6989586621680309029"><span class="hs-identifier hs-var">meta_tvs</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1701"></a><span>                          </span><a href="Outputable.html#isOrAre"><span class="hs-identifier hs-var">isOrAre</span></a><span> </span><a href="#local-6989586621680309029"><span class="hs-identifier hs-var">meta_tvs</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;undetermined:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1702"></a><span>                       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621680309025"><span class="hs-identifier hs-var">pp_tv</span></a><span> </span><a href="#local-6989586621680309029"><span class="hs-identifier hs-var">meta_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1703"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Perhaps add a kind signature.&quot;</span><span>
</span><a name="line-1704"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680309030"><span class="hs-identifier hs-var">other_tvs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1705"></a><span>                    </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Inferred kinds of user-written variables:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1706"></a><span>                       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621680309025"><span class="hs-identifier hs-var">pp_tv</span></a><span> </span><a href="#local-6989586621680309030"><span class="hs-identifier hs-var">other_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1707"></a><span>                    </span><span class="hs-comment">-- It's possible that the result kind contains</span><span>
</span><a name="line-1708"></a><span>                    </span><span class="hs-comment">-- underdetermined, forall-bound variables which weren't</span><span>
</span><a name="line-1709"></a><span>                    </span><span class="hs-comment">-- reported earier (see #13777).</span><span>
</span><a name="line-1710"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Inferred result kind:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1711"></a><span>                       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309024"><span class="hs-identifier hs-var">res_kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1712"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1713"></a><span>        </span><a name="local-6989586621680309025"><a href="#local-6989586621680309025"><span class="hs-identifier">pp_tv</span></a></a><span> </span><a name="local-6989586621680309026"><a href="#local-6989586621680309026"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309026"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621680309026"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1714"></a><span class="hs-identifier">kcLHsQTyVars</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XLHsQTyVars"><span class="hs-identifier hs-var">XLHsQTyVars</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;kcLHsQTyVars&quot;</span><span>
</span><a name="line-1715"></a><span>
</span><a name="line-1716"></a><span class="hs-identifier">kcLHsTyVarBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>   </span><span class="hs-comment">-- True &lt;=&gt; bump the TcLevel when bringing vars into scope</span><span>
</span><a name="line-1717"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>   </span><span class="hs-comment">-- True &lt;=&gt; Default un-annotated tyvar</span><span>
</span><a name="line-1718"></a><span>                          </span><span class="hs-comment">--          binders to kind *</span><span>
</span><a name="line-1719"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span>
</span><a name="line-1720"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span>
</span><a name="line-1721"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308536"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-1722"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308536"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1723"></a><span class="hs-comment">-- There may be dependency between the explicit &quot;ty&quot; vars.</span><span>
</span><a name="line-1724"></a><span class="hs-comment">-- So, we have to handle them one at a time.</span><span>
</span><a name="line-1725"></a><a name="kcLHsTyVarBndrs"><a href="TcHsType.html#kcLHsTyVarBndrs"><span class="hs-identifier">kcLHsTyVarBndrs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680309056"><a href="#local-6989586621680309056"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-1726"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309057"><a href="#local-6989586621680309057"><span class="hs-identifier">stuff</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309056"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309057"><span class="hs-identifier hs-var">stuff</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1727"></a><span>
</span><a name="line-1728"></a><span class="hs-identifier">kcLHsTyVarBndrs</span><span> </span><a name="local-6989586621680309058"><a href="#local-6989586621680309058"><span class="hs-identifier">cusk</span></a></a><span> </span><a name="local-6989586621680309059"><a href="#local-6989586621680309059"><span class="hs-identifier">open_fam</span></a></a><span> </span><a name="local-6989586621680309060"><a href="#local-6989586621680309060"><span class="hs-identifier">skol_info</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680309061"><a href="#local-6989586621680309061"><span class="hs-identifier">hs_tv</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680309062"><a href="#local-6989586621680309062"><span class="hs-identifier">hs_tvs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680309063"><a href="#local-6989586621680309063"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-1729"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309078"><a href="#local-6989586621680309078"><span class="hs-identifier">tv_pair</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621680309079"><a href="#local-6989586621680309079"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309065"><span class="hs-identifier hs-var">kc_hs_tv</span></a><span> </span><a href="#local-6989586621680309061"><span class="hs-identifier hs-var">hs_tv</span></a><span>
</span><a name="line-1730"></a><span>               </span><span class="hs-comment">-- NB: Bring all tvs into scope, even non-dependent ones,</span><span>
</span><a name="line-1731"></a><span>               </span><span class="hs-comment">-- as they're needed in type synonyms, data constructors, etc.</span><span>
</span><a name="line-1732"></a><span>
</span><a name="line-1733"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309080"><a href="#local-6989586621680309080"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309081"><a href="#local-6989586621680309081"><span class="hs-identifier">stuff</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309064"><span class="hs-identifier hs-var">bind_unless_scoped</span></a><span> </span><a href="#local-6989586621680309078"><span class="hs-identifier hs-var">tv_pair</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1734"></a><span>                         </span><a href="TcHsType.html#kcLHsTyVarBndrs"><span class="hs-identifier hs-var">kcLHsTyVarBndrs</span></a><span> </span><a href="#local-6989586621680309058"><span class="hs-identifier hs-var">cusk</span></a><span> </span><a href="#local-6989586621680309059"><span class="hs-identifier hs-var">open_fam</span></a><span> </span><a href="#local-6989586621680309060"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680309062"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1735"></a><span>                         </span><a href="#local-6989586621680309063"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1736"></a><span>
</span><a name="line-1737"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621680309079"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680309080"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309081"><span class="hs-identifier hs-var">stuff</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1738"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1739"></a><span>    </span><span class="hs-comment">-- | Bind the tyvar in the env't unless the bool is True</span><span>
</span><a name="line-1740"></a><span>    </span><span class="hs-identifier">bind_unless_scoped</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680309066"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680309066"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1741"></a><span>    </span><a name="local-6989586621680309064"><a href="#local-6989586621680309064"><span class="hs-identifier">bind_unless_scoped</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>   </span><a name="local-6989586621680309067"><a href="#local-6989586621680309067"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680309067"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1742"></a><span>    </span><span class="hs-identifier">bind_unless_scoped</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309068"><a href="#local-6989586621680309068"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680309069"><a href="#local-6989586621680309069"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1743"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680309058"><span class="hs-identifier hs-var">cusk</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#scopeTyVars"><span class="hs-identifier hs-var">scopeTyVars</span></a><span> </span><a href="#local-6989586621680309060"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680309068"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621680309069"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1744"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span>      </span><span class="hs-special">[</span><a href="#local-6989586621680309068"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621680309069"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1745"></a><span>         </span><span class="hs-comment">-- These variables haven't settled down yet, so we don't want to bump</span><span>
</span><a name="line-1746"></a><span>         </span><span class="hs-comment">-- the TcLevel. If we do, then we'll have metavars of too high a level</span><span>
</span><a name="line-1747"></a><span>         </span><span class="hs-comment">-- floating about. Changing this causes many, many failures in the</span><span>
</span><a name="line-1748"></a><span>         </span><span class="hs-comment">-- `dependent` testsuite directory.</span><span>
</span><a name="line-1749"></a><span>
</span><a name="line-1750"></a><span>    </span><span class="hs-identifier">kc_hs_tv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-1751"></a><span>    </span><a name="local-6989586621680309065"><a href="#local-6989586621680309065"><span class="hs-identifier">kc_hs_tv</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#UserTyVar"><span class="hs-identifier hs-var">UserTyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680309070"><a href="#local-6989586621680309070"><span class="hs-identifier">lname</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680309071"><a href="#local-6989586621680309071"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1752"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309072"><a href="#local-6989586621680309072"><span class="hs-identifier">tv_pair</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621680309073"><a href="#local-6989586621680309073"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309074"><a href="#local-6989586621680309074"><span class="hs-identifier">in_scope</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier hs-var">tcHsTyVarName</span></a><span> </span><a href="TcMType.html#newSkolemTyVar"><span class="hs-identifier hs-var">newSkolemTyVar</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621680309071"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1753"></a><span>
</span><a name="line-1754"></a><span>             </span><span class="hs-comment">-- Open type/data families default their variables to kind *.</span><span>
</span><a name="line-1755"></a><span>             </span><span class="hs-comment">-- But don't default in-scope class tyvars, of course</span><span>
</span><a name="line-1756"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309059"><span class="hs-identifier hs-var">open_fam</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621680309074"><span class="hs-identifier hs-var">in_scope</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1757"></a><span>             </span><a href="TcRnMonad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcUnify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a><span> </span><a href="HsExtension.html#noExt"><span class="hs-identifier hs-var">noExt</span></a><span> </span><a href="HsTypes.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a><span> </span><a href="#local-6989586621680309070"><span class="hs-identifier hs-var">lname</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1758"></a><span>                                       </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621680309073"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1759"></a><span>
</span><a name="line-1760"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680309072"><span class="hs-identifier hs-var">tv_pair</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1761"></a><span>
</span><a name="line-1762"></a><span>    </span><span class="hs-identifier">kc_hs_tv</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#KindedTyVar"><span class="hs-identifier hs-var">KindedTyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680309075"><a href="#local-6989586621680309075"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680309076"><a href="#local-6989586621680309076"><span class="hs-identifier">lhs_kind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1763"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309077"><a href="#local-6989586621680309077"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcLHsKindSig"><span class="hs-identifier hs-var">tcLHsKindSig</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TyVarBndrKindCtxt"><span class="hs-identifier hs-var">TyVarBndrKindCtxt</span></a><span> </span><a href="#local-6989586621680309075"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309076"><span class="hs-identifier hs-var">lhs_kind</span></a><span>
</span><a name="line-1764"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier hs-var">tcHsTyVarName</span></a><span> </span><a href="TcMType.html#newSkolemTyVar"><span class="hs-identifier hs-var">newSkolemTyVar</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621680309077"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309075"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1765"></a><span>
</span><a name="line-1766"></a><span>    </span><span class="hs-identifier">kc_hs_tv</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XTyVarBndr"><span class="hs-identifier hs-var">XTyVarBndr</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;kc_hs_tv&quot;</span><span>
</span><a name="line-1767"></a><span>
</span><a name="line-1768"></a><span class="hs-identifier">tcImplicitTKBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span>
</span><a name="line-1769"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1770"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308535"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1771"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308535"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1772"></a><a name="tcImplicitTKBndrs"><a href="TcHsType.html#tcImplicitTKBndrs"><span class="hs-identifier">tcImplicitTKBndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcImplicitTKBndrsX"><span class="hs-identifier hs-var">tcImplicitTKBndrsX</span></a><span> </span><a href="TcMType.html#newSkolemTyVar"><span class="hs-identifier hs-var">newSkolemTyVar</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1773"></a><span>
</span><a name="line-1774"></a><span class="hs-comment">-- | Like 'tcImplicitTKBndrs', but uses 'newSigTyVar' to create tyvars</span><span>
</span><a name="line-1775"></a><span class="hs-identifier">tcImplicitTKBndrsSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span>
</span><a name="line-1776"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1777"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308534"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1778"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308534"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1779"></a><a name="tcImplicitTKBndrsSig"><a href="TcHsType.html#tcImplicitTKBndrsSig"><span class="hs-identifier">tcImplicitTKBndrsSig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcImplicitTKBndrsX"><span class="hs-identifier hs-var">tcImplicitTKBndrsX</span></a><span> </span><a href="TcMType.html#newSigTyVar"><span class="hs-identifier hs-var">newSigTyVar</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1780"></a><span>
</span><a name="line-1781"></a><span class="hs-identifier">tcImplicitTKBndrsX</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- new_tv function</span><span>
</span><a name="line-1782"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>           </span><span class="hs-comment">-- Just k &lt;=&gt; assign all names this kind</span><span>
</span><a name="line-1783"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span>
</span><a name="line-1784"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1785"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308533"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1786"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308533"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- these tyvars are dependency-ordered</span><span>
</span><a name="line-1787"></a><span class="hs-comment">-- * Guarantees to call solveLocalEqualities to unify</span><span>
</span><a name="line-1788"></a><span class="hs-comment">--   all constraints from thing_inside.</span><span>
</span><a name="line-1789"></a><span class="hs-comment">--</span><span>
</span><a name="line-1790"></a><span class="hs-comment">-- * Returned TcTyVars have the supplied HsTyVarBndrs,</span><span>
</span><a name="line-1791"></a><span class="hs-comment">--   but may be in different order to the original [Name]</span><span>
</span><a name="line-1792"></a><span class="hs-comment">--   (because of sorting to respect dependency)</span><span>
</span><a name="line-1793"></a><span class="hs-comment">--</span><span>
</span><a name="line-1794"></a><span class="hs-comment">-- * Returned TcTyVars have zonked kinds</span><span>
</span><a name="line-1795"></a><span class="hs-comment">--   See Note [Keeping scoped variables in order: Implicit]</span><span>
</span><a name="line-1796"></a><a name="tcImplicitTKBndrsX"><a href="TcHsType.html#tcImplicitTKBndrsX"><span class="hs-identifier">tcImplicitTKBndrsX</span></a></a><span> </span><a name="local-6989586621680309082"><a href="#local-6989586621680309082"><span class="hs-identifier">new_tv</span></a></a><span> </span><a name="local-6989586621680309083"><a href="#local-6989586621680309083"><span class="hs-identifier">m_kind</span></a></a><span> </span><a name="local-6989586621680309084"><a href="#local-6989586621680309084"><span class="hs-identifier">skol_info</span></a></a><span> </span><a name="local-6989586621680309085"><a href="#local-6989586621680309085"><span class="hs-identifier">tv_names</span></a></a><span> </span><a name="local-6989586621680309086"><a href="#local-6989586621680309086"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1797"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680309085"><span class="hs-identifier hs-var">tv_names</span></a><span> </span><span class="hs-comment">-- Short cut for the common case where there</span><span>
</span><a name="line-1798"></a><span>                  </span><span class="hs-comment">-- are no implicit type variables to bind</span><span>
</span><a name="line-1799"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309087"><a href="#local-6989586621680309087"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#solveLocalEqualities"><span class="hs-identifier hs-var">solveLocalEqualities</span></a><span> </span><a href="#local-6989586621680309086"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1800"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309087"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1801"></a><span>
</span><a name="line-1802"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1803"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309092"><a href="#local-6989586621680309092"><span class="hs-identifier">skol_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309093"><a href="#local-6989586621680309093"><span class="hs-identifier">result</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1804"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#solveLocalEqualities"><span class="hs-identifier hs-var">solveLocalEqualities</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1805"></a><span>              </span><a href="TcUnify.html#checkTvConstraints"><span class="hs-identifier hs-var">checkTvConstraints</span></a><span> </span><a href="#local-6989586621680309084"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1806"></a><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309088"><a href="#local-6989586621680309088"><span class="hs-identifier">tv_pairs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier hs-var">tcHsTyVarName</span></a><span> </span><a href="#local-6989586621680309082"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><a href="#local-6989586621680309083"><span class="hs-identifier hs-var">m_kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309085"><span class="hs-identifier hs-var">tv_names</span></a><span>
</span><a name="line-1807"></a><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309089"><a href="#local-6989586621680309089"><span class="hs-identifier">must_scope_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621680309090"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309090"><a href="#local-6989586621680309090"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309088"><span class="hs-identifier hs-var">tv_pairs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1808"></a><span>                 </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309091"><a href="#local-6989586621680309091"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><a href="#local-6989586621680309089"><span class="hs-identifier hs-var">must_scope_tvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1809"></a><span>                             </span><a href="#local-6989586621680309086"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1810"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-6989586621680309088"><span class="hs-identifier hs-var">tv_pairs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309091"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1811"></a><span>
</span><a name="line-1812"></a><span>
</span><a name="line-1813"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309094"><a href="#local-6989586621680309094"><span class="hs-identifier">skol_tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcTyCoVarBndr"><span class="hs-identifier hs-var">zonkTcTyCoVarBndr</span></a><span> </span><a href="#local-6989586621680309092"><span class="hs-identifier hs-var">skol_tvs</span></a><span>
</span><a name="line-1814"></a><span>          </span><span class="hs-comment">-- use zonkTcTyCoVarBndr because a skol_tv might be a SigTv</span><span>
</span><a name="line-1815"></a><span>
</span><a name="line-1816"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309095"><a href="#local-6989586621680309095"><span class="hs-identifier">final_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#toposortTyVars"><span class="hs-identifier hs-var">toposortTyVars</span></a><span> </span><a href="#local-6989586621680309094"><span class="hs-identifier hs-var">skol_tvs</span></a><span>
</span><a name="line-1817"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcImplicitTKBndrs&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309085"><span class="hs-identifier hs-var">tv_names</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309095"><span class="hs-identifier hs-var">final_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1818"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309095"><span class="hs-identifier hs-var">final_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309093"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1819"></a><span>
</span><a name="line-1820"></a><span class="hs-comment">-- | Bring implicitly quantified type/kind variables into scope during</span><span>
</span><a name="line-1821"></a><span class="hs-comment">-- kind checking. Uses SigTvs, as per Note [Use SigTvs in kind-checking pass]</span><span>
</span><a name="line-1822"></a><span class="hs-comment">-- in TcTyClsDecls.</span><span>
</span><a name="line-1823"></a><span class="hs-identifier">kcImplicitTKBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- of the vars</span><span>
</span><a name="line-1824"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-comment">-- Just k &lt;=&gt; use k as the kind for all vars</span><span>
</span><a name="line-1825"></a><span>                                </span><span class="hs-comment">-- Nothing &lt;=&gt; use a meta-tyvar</span><span>
</span><a name="line-1826"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308532"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1827"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308532"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- returns the tyvars created</span><span>
</span><a name="line-1828"></a><span>                                         </span><span class="hs-comment">-- these are *not* dependency ordered</span><span>
</span><a name="line-1829"></a><a name="kcImplicitTKBndrs"><a href="TcHsType.html#kcImplicitTKBndrs"><span class="hs-identifier">kcImplicitTKBndrs</span></a></a><span> </span><a name="local-6989586621680309096"><a href="#local-6989586621680309096"><span class="hs-identifier">var_ns</span></a></a><span> </span><a name="local-6989586621680309097"><a href="#local-6989586621680309097"><span class="hs-identifier">m_kind</span></a></a><span> </span><a name="local-6989586621680309098"><a href="#local-6989586621680309098"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1830"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309099"><a href="#local-6989586621680309099"><span class="hs-identifier">tkvs_pairs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier hs-var">tcHsTyVarName</span></a><span> </span><a href="TcMType.html#newSigTyVar"><span class="hs-identifier hs-var">newSigTyVar</span></a><span> </span><a href="#local-6989586621680309097"><span class="hs-identifier hs-var">m_kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309096"><span class="hs-identifier hs-var">var_ns</span></a><span>
</span><a name="line-1831"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309100"><a href="#local-6989586621680309100"><span class="hs-identifier">must_scope_tkvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621680309101"><span class="hs-identifier hs-var">tkv</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309101"><a href="#local-6989586621680309101"><span class="hs-identifier">tkv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309099"><span class="hs-identifier hs-var">tkvs_pairs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1832"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309102"><a href="#local-6989586621680309102"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><a href="#local-6989586621680309100"><span class="hs-identifier hs-var">must_scope_tkvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1833"></a><span>                   </span><a href="#local-6989586621680309098"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1834"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-6989586621680309099"><span class="hs-identifier hs-var">tkvs_pairs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309102"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1835"></a><span>
</span><a name="line-1836"></a><span class="hs-identifier">tcExplicitTKBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span>
</span><a name="line-1837"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span>
</span><a name="line-1838"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308531"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1839"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680308531"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1840"></a><span class="hs-comment">-- See also Note [Associated type tyvar names] in Class</span><span>
</span><a name="line-1841"></a><a name="tcExplicitTKBndrs"><a href="TcHsType.html#tcExplicitTKBndrs"><span class="hs-identifier">tcExplicitTKBndrs</span></a></a><span> </span><a name="local-6989586621680309103"><a href="#local-6989586621680309103"><span class="hs-identifier">skol_info</span></a></a><span> </span><a name="local-6989586621680309104"><a href="#local-6989586621680309104"><span class="hs-identifier">hs_tvs</span></a></a><span> </span><a name="local-6989586621680309105"><a href="#local-6989586621680309105"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1842"></a><span class="hs-comment">-- This function brings into scope a telescope of binders as written by</span><span>
</span><a name="line-1843"></a><span class="hs-comment">-- the user. At first blush, it would then seem that we should bring</span><span>
</span><a name="line-1844"></a><span class="hs-comment">-- them into scope one at a time, bumping the TcLevel each time.</span><span>
</span><a name="line-1845"></a><span class="hs-comment">-- (Recall that we bump the level to prevent skolem escape from happening.)</span><span>
</span><a name="line-1846"></a><span class="hs-comment">-- However, this leads to terrible error messages, because we end up</span><span>
</span><a name="line-1847"></a><span class="hs-comment">-- failing to unify with some `k0`. Better would be to allow type inference</span><span>
</span><a name="line-1848"></a><span class="hs-comment">-- to work, potentially creating a skolem-escape problem, and then to</span><span>
</span><a name="line-1849"></a><span class="hs-comment">-- notice that the telescope is out of order. That's what we do here,</span><span>
</span><a name="line-1850"></a><span class="hs-comment">-- following the logic of tcImplicitTKBndrsX.</span><span>
</span><a name="line-1851"></a><span class="hs-comment">-- See also Note [Keeping scoped variables in order: Explicit]</span><span>
</span><a name="line-1852"></a><span class="hs-comment">--</span><span>
</span><a name="line-1853"></a><span class="hs-comment">-- No cloning: returned TyVars have the same Name as the incoming LHsTyVarBndrs</span><span>
</span><a name="line-1854"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680309104"><span class="hs-identifier hs-var">hs_tvs</span></a><span>  </span><span class="hs-comment">-- Short cut that avoids creating an implication</span><span>
</span><a name="line-1855"></a><span>                 </span><span class="hs-comment">-- constraint in the common case where none is needed</span><span>
</span><a name="line-1856"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309115"><a href="#local-6989586621680309115"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309105"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1857"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309115"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1858"></a><span>
</span><a name="line-1859"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1860"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309116"><a href="#local-6989586621680309116"><span class="hs-identifier">skol_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309117"><a href="#local-6989586621680309117"><span class="hs-identifier">result</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcUnify.html#checkTvConstraints"><span class="hs-identifier hs-var">checkTvConstraints</span></a><span> </span><a href="#local-6989586621680309103"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621680309107"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1861"></a><span>                               </span><a href="#local-6989586621680309106"><span class="hs-identifier hs-var">bind_tvbs</span></a><span> </span><a href="#local-6989586621680309104"><span class="hs-identifier hs-var">hs_tvs</span></a><span>
</span><a name="line-1862"></a><span>
</span><a name="line-1863"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcExplicitTKBndrs&quot;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1864"></a><span>           </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Hs vars:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309104"><span class="hs-identifier hs-var">hs_tvs</span></a><span>
</span><a name="line-1865"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;tvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a><span> </span><a href="#local-6989586621680309116"><span class="hs-identifier hs-var">skol_tvs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1866"></a><span>
</span><a name="line-1867"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309116"><span class="hs-identifier hs-var">skol_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309117"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1868"></a><span>
</span><a name="line-1869"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1870"></a><span>    </span><a name="local-6989586621680309106"><a href="#local-6989586621680309106"><span class="hs-identifier">bind_tvbs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309108"><a href="#local-6989586621680309108"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309105"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1871"></a><span>                      </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309108"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1872"></a><span>    </span><span class="hs-identifier">bind_tvbs</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680309109"><a href="#local-6989586621680309109"><span class="hs-identifier">tvb</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680309110"><a href="#local-6989586621680309110"><span class="hs-identifier">tvbs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1873"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309111"><a href="#local-6989586621680309111"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309112"><a href="#local-6989586621680309112"><span class="hs-identifier">in_scope</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsTyVarBndr"><span class="hs-identifier hs-var">tcHsTyVarBndr</span></a><span> </span><a href="TcMType.html#newSkolemTyVar"><span class="hs-identifier hs-var">newSkolemTyVar</span></a><span> </span><a href="#local-6989586621680309109"><span class="hs-identifier hs-var">tvb</span></a><span>
</span><a name="line-1874"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680309112"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680309111"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1875"></a><span>           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309113"><a href="#local-6989586621680309113"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309114"><a href="#local-6989586621680309114"><span class="hs-identifier">result</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309106"><span class="hs-identifier hs-var">bind_tvbs</span></a><span> </span><a href="#local-6989586621680309110"><span class="hs-identifier hs-var">tvbs</span></a><span>
</span><a name="line-1876"></a><span>              </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309111"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680309113"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309114"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1877"></a><span>
</span><a name="line-1878"></a><span>    </span><a name="local-6989586621680309107"><a href="#local-6989586621680309107"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309104"><span class="hs-identifier hs-var">hs_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1879"></a><span>
</span><a name="line-1880"></a><span class="hs-comment">-- | Used during the &quot;kind-checking&quot; pass in TcTyClsDecls only.</span><span>
</span><a name="line-1881"></a><span class="hs-comment">-- See Note [Use SigTvs in kind-checking pass] in TcTyClsDecls</span><span>
</span><a name="line-1882"></a><span class="hs-identifier">kcExplicitTKBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span>
</span><a name="line-1883"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308530"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1884"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308530"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1885"></a><a name="kcExplicitTKBndrs"><a href="TcHsType.html#kcExplicitTKBndrs"><span class="hs-identifier">kcExplicitTKBndrs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680309118"><a href="#local-6989586621680309118"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680309118"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1886"></a><span class="hs-identifier">kcExplicitTKBndrs</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680309119"><a href="#local-6989586621680309119"><span class="hs-identifier">hs_tv</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680309120"><a href="#local-6989586621680309120"><span class="hs-identifier">hs_tvs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680309121"><a href="#local-6989586621680309121"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1887"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309122"><a href="#local-6989586621680309122"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsTyVarBndr"><span class="hs-identifier hs-var">tcHsTyVarBndr</span></a><span> </span><a href="TcMType.html#newSigTyVar"><span class="hs-identifier hs-var">newSigTyVar</span></a><span> </span><a href="#local-6989586621680309119"><span class="hs-identifier hs-var">hs_tv</span></a><span>
</span><a name="line-1888"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680309122"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1889"></a><span>         </span><a href="TcHsType.html#kcExplicitTKBndrs"><span class="hs-identifier hs-var">kcExplicitTKBndrs</span></a><span> </span><a href="#local-6989586621680309120"><span class="hs-identifier hs-var">hs_tvs</span></a><span> </span><a href="#local-6989586621680309121"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1890"></a><span>
</span><a name="line-1891"></a><span class="hs-identifier">tcHsTyVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-1892"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-1893"></a><span class="hs-comment">-- Return a TcTyVar, built using the provided function</span><span>
</span><a name="line-1894"></a><span class="hs-comment">-- Typically the Kind inside the HsTyVarBndr will be a tyvar</span><span>
</span><a name="line-1895"></a><span class="hs-comment">-- with a mutable kind in it.</span><span>
</span><a name="line-1896"></a><span class="hs-comment">--</span><span>
</span><a name="line-1897"></a><span class="hs-comment">-- These variables might be in scope already (with associated types, for example).</span><span>
</span><a name="line-1898"></a><span class="hs-comment">-- This function then checks that the kind annotation (if any) matches the</span><span>
</span><a name="line-1899"></a><span class="hs-comment">-- kind of the in-scope type variable.</span><span>
</span><a name="line-1900"></a><span class="hs-comment">--</span><span>
</span><a name="line-1901"></a><span class="hs-comment">-- Returned TcTyVar has the same name; no cloning</span><span>
</span><a name="line-1902"></a><span class="hs-comment">--</span><span>
</span><a name="line-1903"></a><span class="hs-comment">-- See also Note [Associated type tyvar names] in Class</span><span>
</span><a name="line-1904"></a><span class="hs-comment">--</span><span>
</span><a name="line-1905"></a><span class="hs-comment">-- Returns True iff the tyvar was already in scope</span><span>
</span><a name="line-1906"></a><a name="tcHsTyVarBndr"><a href="TcHsType.html#tcHsTyVarBndr"><span class="hs-identifier">tcHsTyVarBndr</span></a></a><span> </span><a name="local-6989586621680309123"><a href="#local-6989586621680309123"><span class="hs-identifier">new_tv</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#UserTyVar"><span class="hs-identifier hs-var">UserTyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680309124"><a href="#local-6989586621680309124"><span class="hs-identifier">tv_nm</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1907"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier hs-var">tcHsTyVarName</span></a><span> </span><a href="#local-6989586621680309123"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621680309124"><span class="hs-identifier hs-var">tv_nm</span></a><span>
</span><a name="line-1908"></a><span class="hs-identifier">tcHsTyVarBndr</span><span> </span><a name="local-6989586621680309125"><a href="#local-6989586621680309125"><span class="hs-identifier">new_tv</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#KindedTyVar"><span class="hs-identifier hs-var">KindedTyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680309126"><a href="#local-6989586621680309126"><span class="hs-identifier">tv_nm</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680309127"><a href="#local-6989586621680309127"><span class="hs-identifier">lhs_kind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1909"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309128"><a href="#local-6989586621680309128"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcLHsKindSig"><span class="hs-identifier hs-var">tcLHsKindSig</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TyVarBndrKindCtxt"><span class="hs-identifier hs-var">TyVarBndrKindCtxt</span></a><span> </span><a href="#local-6989586621680309126"><span class="hs-identifier hs-var">tv_nm</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309127"><span class="hs-identifier hs-var">lhs_kind</span></a><span>
</span><a name="line-1910"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier hs-var">tcHsTyVarName</span></a><span> </span><a href="#local-6989586621680309125"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621680309128"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309126"><span class="hs-identifier hs-var">tv_nm</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1911"></a><span class="hs-identifier">tcHsTyVarBndr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XTyVarBndr"><span class="hs-identifier hs-var">XTyVarBndr</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tcHsTyVarBndr&quot;</span><span>
</span><a name="line-1912"></a><span>
</span><a name="line-1913"></a><span class="hs-identifier">newWildTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-1914"></a><span class="hs-comment">-- ^ New unification variable for a wildcard</span><span>
</span><a name="line-1915"></a><a name="newWildTyVar"><a href="TcHsType.html#newWildTyVar"><span class="hs-identifier">newWildTyVar</span></a></a><span> </span><a name="local-6989586621680309129"><a href="#local-6989586621680309129"><span class="hs-identifier">_name</span></a></a><span>
</span><a name="line-1916"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309130"><a href="#local-6989586621680309130"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-1917"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309131"><a href="#local-6989586621680309131"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-1918"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309132"><a href="#local-6989586621680309132"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a><span> </span><a href="TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a><span>
</span><a name="line-1919"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309133"><a href="#local-6989586621680309133"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#mkSysTvName"><span class="hs-identifier hs-var">mkSysTvName</span></a><span> </span><a href="#local-6989586621680309131"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;w&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1920"></a><span>             </span><a name="local-6989586621680309134"><a href="#local-6989586621680309134"><span class="hs-identifier">tyvar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-6989586621680309133"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680309130"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-6989586621680309132"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span>
</span><a name="line-1921"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;newWildTyVar&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309134"><span class="hs-identifier hs-var">tyvar</span></a><span class="hs-special">)</span><span>
</span><a name="line-1922"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680309134"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1923"></a><span>
</span><a name="line-1924"></a><span class="hs-comment">-- | Produce a tyvar of the given name (with the kind provided, or</span><span>
</span><a name="line-1925"></a><span class="hs-comment">-- otherwise a meta-var kind). If</span><span>
</span><a name="line-1926"></a><span class="hs-comment">-- the name is already in scope, return the scoped variable, checking</span><span>
</span><a name="line-1927"></a><span class="hs-comment">-- to make sure the known kind matches any kind provided. The</span><span>
</span><a name="line-1928"></a><span class="hs-comment">-- second return value says whether the variable is in scope (True)</span><span>
</span><a name="line-1929"></a><span class="hs-comment">-- or not (False). (Use this for associated types, for example.)</span><span>
</span><a name="line-1930"></a><span class="hs-identifier">tcHsTyVarName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- new_tv function</span><span>
</span><a name="line-1931"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>  </span><span class="hs-comment">-- Just k &lt;=&gt; use k as the variable's kind</span><span>
</span><a name="line-1932"></a><span>                             </span><span class="hs-comment">-- Nothing &lt;=&gt; use a meta-tyvar</span><span>
</span><a name="line-1933"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-1934"></a><a name="tcHsTyVarName"><a href="TcHsType.html#tcHsTyVarName"><span class="hs-identifier">tcHsTyVarName</span></a></a><span> </span><a name="local-6989586621680309135"><a href="#local-6989586621680309135"><span class="hs-identifier">new_tv</span></a></a><span> </span><a name="local-6989586621680309136"><a href="#local-6989586621680309136"><span class="hs-identifier">m_kind</span></a></a><span> </span><a name="local-6989586621680309137"><a href="#local-6989586621680309137"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1935"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309138"><a href="#local-6989586621680309138"><span class="hs-identifier">mb_tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupLcl_maybe"><span class="hs-identifier hs-var">tcLookupLcl_maybe</span></a><span> </span><a href="#local-6989586621680309137"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1936"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680309138"><span class="hs-identifier hs-var">mb_tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1937"></a><span>           </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ATyVar"><span class="hs-identifier hs-var">ATyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680309139"><a href="#local-6989586621680309139"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1938"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="Maybes.html#whenIsJust"><span class="hs-identifier hs-var">whenIsJust</span></a><span> </span><a href="#local-6989586621680309136"><span class="hs-identifier hs-var">m_kind</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621680309140"><a href="#local-6989586621680309140"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1939"></a><span>                     </span><a href="TcRnMonad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1940"></a><span>                     </span><a href="TcUnify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a><span> </span><a href="HsExtension.html#noExt"><span class="hs-identifier hs-var">noExt</span></a><span> </span><a href="HsTypes.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="#local-6989586621680309137"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1941"></a><span>                       </span><a href="#local-6989586621680309140"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621680309139"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1942"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309139"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1943"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309142"><a href="#local-6989586621680309142"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680309136"><span class="hs-identifier hs-var">m_kind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1944"></a><span>                               </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680309141"><a href="#local-6989586621680309141"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680309141"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1945"></a><span>                               </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-1946"></a><span>                   </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309143"><a href="#local-6989586621680309143"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309135"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><a href="#local-6989586621680309137"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680309142"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1947"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309143"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1948"></a><span>
</span><a name="line-1949"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1950"></a><span class="hs-comment">-- Bringing tyvars into scope</span><span>
</span><a name="line-1951"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1952"></a><span>
</span><a name="line-1953"></a><span class="hs-comment">-- | Bring tyvars into scope, wrapping the thing_inside in an implication</span><span>
</span><a name="line-1954"></a><span class="hs-comment">-- constraint. The implication constraint is necessary to provide SkolemInfo</span><span>
</span><a name="line-1955"></a><span class="hs-comment">-- for the tyvars and to ensure that no unification variables made outside</span><span>
</span><a name="line-1956"></a><span class="hs-comment">-- the scope of these tyvars (i.e. lower TcLevel) unify with the locally-scoped</span><span>
</span><a name="line-1957"></a><span class="hs-comment">-- tyvars (i.e. higher TcLevel).</span><span>
</span><a name="line-1958"></a><span class="hs-comment">--</span><span>
</span><a name="line-1959"></a><span class="hs-comment">-- INVARIANT: The thing_inside must check only types, never terms.</span><span>
</span><a name="line-1960"></a><span class="hs-comment">--</span><span>
</span><a name="line-1961"></a><span class="hs-comment">-- Use this (not tcExtendTyVarEnv) wherever you expect a &#923; or &#8704; in Core.</span><span>
</span><a name="line-1962"></a><span class="hs-comment">-- Use tcExtendTyVarEnv otherwise.</span><span>
</span><a name="line-1963"></a><span class="hs-identifier">scopeTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308529"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308529"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1964"></a><a name="scopeTyVars"><a href="TcHsType.html#scopeTyVars"><span class="hs-identifier">scopeTyVars</span></a></a><span> </span><a name="local-6989586621680309144"><a href="#local-6989586621680309144"><span class="hs-identifier">skol_info</span></a></a><span> </span><a name="local-6989586621680309145"><a href="#local-6989586621680309145"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#scopeTyVars2"><span class="hs-identifier hs-var">scopeTyVars2</span></a><span> </span><a href="#local-6989586621680309144"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-6989586621680309146"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309146"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680309146"><a href="#local-6989586621680309146"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309145"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1965"></a><span>
</span><a name="line-1966"></a><span class="hs-comment">-- | Like 'scopeTyVars', but allows you to specify different scoped names</span><span>
</span><a name="line-1967"></a><span class="hs-comment">-- than the Names stored within the tyvars.</span><span>
</span><a name="line-1968"></a><span class="hs-identifier">scopeTyVars2</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308528"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308528"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1969"></a><a name="scopeTyVars2"><a href="TcHsType.html#scopeTyVars2"><span class="hs-identifier">scopeTyVars2</span></a></a><span> </span><a name="local-6989586621680309147"><a href="#local-6989586621680309147"><span class="hs-identifier">skol_info</span></a></a><span> </span><a name="local-6989586621680309148"><a href="#local-6989586621680309148"><span class="hs-identifier">prs</span></a></a><span> </span><a name="local-6989586621680309149"><a href="#local-6989586621680309149"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1970"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-comment">-- discard the TcEvBinds, which will always be empty</span><span>
</span><a name="line-1971"></a><span>    </span><a href="TcUnify.html#checkConstraints"><span class="hs-identifier hs-var">checkConstraints</span></a><span> </span><a href="#local-6989586621680309147"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-6989586621680309148"><span class="hs-identifier hs-var">prs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-comment">{- no EvVars -}</span><span class="hs-special">]</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1972"></a><span>    </span><a href="TcEnv.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a><span> </span><a href="#local-6989586621680309148"><span class="hs-identifier hs-var">prs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1973"></a><span>    </span><a href="#local-6989586621680309149"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1974"></a><span>
</span><a name="line-1975"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-1976"></a><span class="hs-identifier">kindGeneralize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="Var.html#KindVar"><span class="hs-identifier hs-type">KindVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-1977"></a><span class="hs-comment">-- Quantify the free kind variables of a kind or type</span><span>
</span><a name="line-1978"></a><span class="hs-comment">-- In the latter case the type is closed, so it has no free</span><span>
</span><a name="line-1979"></a><span class="hs-comment">-- type variables.  So in both cases, all the free vars are kind vars</span><span>
</span><a name="line-1980"></a><span class="hs-comment">-- Input must be zonked.</span><span>
</span><a name="line-1981"></a><span class="hs-comment">-- NB: You must call solveEqualities or solveLocalEqualities before</span><span>
</span><a name="line-1982"></a><span class="hs-comment">-- kind generalization</span><span>
</span><a name="line-1983"></a><a name="kindGeneralize"><a href="TcHsType.html#kindGeneralize"><span class="hs-identifier">kindGeneralize</span></a></a><span> </span><a name="local-6989586621680309150"><a href="#local-6989586621680309150"><span class="hs-identifier">kind_or_type</span></a></a><span>
</span><a name="line-1984"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309151"><a href="#local-6989586621680309151"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypeDSet</span></a><span> </span><a href="#local-6989586621680309150"><span class="hs-identifier hs-var">kind_or_type</span></a><span>
</span><a name="line-1985"></a><span>             </span><a name="local-6989586621680309152"><a href="#local-6989586621680309152"><span class="hs-identifier">dvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680309151"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyDVarSet"><span class="hs-identifier hs-var">emptyDVarSet</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1986"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309153"><a href="#local-6989586621680309153"><span class="hs-identifier">gbl_tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#tcGetGlobalTyCoVars"><span class="hs-identifier hs-var">tcGetGlobalTyCoVars</span></a><span> </span><span class="hs-comment">-- Already zonked</span><span>
</span><a name="line-1987"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#quantifyTyVars"><span class="hs-identifier hs-var">quantifyTyVars</span></a><span> </span><a href="#local-6989586621680309153"><span class="hs-identifier hs-var">gbl_tvs</span></a><span> </span><a href="#local-6989586621680309152"><span class="hs-identifier hs-var">dvs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1988"></a><span>
</span><a name="line-1989"></a><span class="hs-comment">{-
Note [Kind generalisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~
We do kind generalisation only at the outer level of a type signature.
For example, consider
  T :: forall k. k -&gt; *
  f :: (forall a. T a -&gt; Int) -&gt; Int
When kind-checking f's type signature we generalise the kind at
the outermost level, thus:
  f1 :: forall k. (forall (a:k). T k a -&gt; Int) -&gt; Int  -- YES!
and *not* at the inner forall:
  f2 :: (forall k. forall (a:k). T k a -&gt; Int) -&gt; Int  -- NO!
Reason: same as for HM inference on value level declarations,
we want to infer the most general type.  The f2 type signature
would be *less applicable* than f1, because it requires a more
polymorphic argument.

NB: There are no explicit kind variables written in f's signature.
When there are, the renamer adds these kind variables to the list of
variables bound by the forall, so you can indeed have a type that's
higher-rank in its kind. But only by explicit request.

Note [Kinds of quantified type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tcTyVarBndrsGen quantifies over a specified list of type variables,
*and* over the kind variables mentioned in the kinds of those tyvars.

Note that we must zonk those kinds (obviously) but less obviously, we
must return type variables whose kinds are zonked too. Example
    (a :: k7)  where  k7 := k9 -&gt; k9
We must return
    [k9, a:k9-&gt;k9]
and NOT
    [k9, a:k7]
Reason: we're going to turn this into a for-all type,
   forall k9. forall (a:k7). blah
which the type checker will then instantiate, and instantiate does not
look through unification variables!

Hence using zonked_kinds when forming tvs'.

Note [Free-floating kind vars]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  data T = MkT (forall (a :: k). Proxy a)
  -- from test ghci/scripts/T7873

This is not an existential datatype, but a higher-rank one (the forall
to the right of MkT). Also consider

  data S a = MkS (Proxy (a :: k))

According to the rules around implicitly-bound kind variables, in both
cases those k's scope over the whole declaration. The renamer grabs
it and adds it to the hsq_implicits field of the HsQTyVars of the
tycon. So it must be in scope during type-checking, but we want to
reject T while accepting S.

Why reject T? Because the kind variable isn't fixed by anything. For
a variable like k to be implicit, it needs to be mentioned in the kind
of a tycon tyvar. But it isn't.

Why accept S? Because kind inference tells us that a has kind k, so it's
all OK.

Our approach depends on whether or not the datatype has a CUSK.

Non-CUSK: In the first pass (kcTyClTyVars) we just bring
k into scope. In the second pass (tcTyClTyVars),
we check to make sure that k has been unified with some other variable
(or generalized over, making k into a skolem). If it hasn't been, then
it must be a free-floating kind var. Error.

CUSK: When we determine the tycon's final, never-to-be-changed kind
in kcLHsQTyVars, we check to make sure all implicitly-bound kind
vars are indeed mentioned in a kind somewhere. If not, error.

We also perform free-floating kind var analysis for type family instances
(see #13985). Here is an interesting example:

    type family   T :: k
    type instance T = (Nothing :: Maybe a)

Upon a cursory glance, it may appear that the kind variable `a` is
free-floating above, since there are no (visible) LHS patterns in `T`. However,
there is an *invisible* pattern due to the return kind, so inside of GHC, the
instance looks closer to this:

    type family T @k :: k
    type instance T @(Maybe a) = (Nothing :: Maybe a)

Here, we can see that `a` really is bound by a LHS type pattern, so `a` is in
fact not free-floating. Contrast that with this example:

    type instance T = Proxy (Nothing :: Maybe a)

This would looks like this inside of GHC:

    type instance T @(*) = Proxy (Nothing :: Maybe a)

So this time, `a` is neither bound by a visible nor invisible type pattern on
the LHS, so it would be reported as free-floating.

Finally, here's one more brain-teaser (from #9574). In the example below:

    class Funct f where
      type Codomain f :: *
    instance Funct ('KProxy :: KProxy o) where
      type Codomain 'KProxy = NatTr (Proxy :: o -&gt; *)

As it turns out, `o` is not free-floating in this example. That is because `o`
bound by the kind signature of the LHS type pattern 'KProxy. To make this more
obvious, one can also write the instance like so:

    instance Funct ('KProxy :: KProxy o) where
      type Codomain ('KProxy :: KProxy o) = NatTr (Proxy :: o -&gt; *)

-}</span><span>
</span><a name="line-2108"></a><span>
</span><a name="line-2109"></a><span class="hs-comment">--------------------</span><span>
</span><a name="line-2110"></a><span class="hs-comment">-- getInitialKind has made a suitably-shaped kind for the type or class</span><span>
</span><a name="line-2111"></a><span class="hs-comment">-- Look it up in the local environment. This is used only for tycons</span><span>
</span><a name="line-2112"></a><span class="hs-comment">-- that we're currently type-checking, so we're sure to find a TcTyCon.</span><span>
</span><a name="line-2113"></a><span class="hs-identifier">kcLookupTcTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a><span>
</span><a name="line-2114"></a><a name="kcLookupTcTyCon"><a href="TcHsType.html#kcLookupTcTyCon"><span class="hs-identifier">kcLookupTcTyCon</span></a></a><span> </span><a name="local-6989586621680309154"><a href="#local-6989586621680309154"><span class="hs-identifier">nm</span></a></a><span>
</span><a name="line-2115"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309155"><a href="#local-6989586621680309155"><span class="hs-identifier">tc_ty_thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookup"><span class="hs-identifier hs-var">tcLookup</span></a><span> </span><a href="#local-6989586621680309154"><span class="hs-identifier hs-var">nm</span></a><span>
</span><a name="line-2116"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680309155"><span class="hs-identifier hs-var">tc_ty_thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2117"></a><span>           </span><a href="TcRnTypes.html#ATcTyCon"><span class="hs-identifier hs-var">ATcTyCon</span></a><span> </span><a name="local-6989586621680309156"><a href="#local-6989586621680309156"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680309156"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2118"></a><span>           </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;kcLookupTcTyCon&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309155"><span class="hs-identifier hs-var">tc_ty_thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2119"></a><span>
</span><a name="line-2120"></a><span class="hs-comment">-----------------------</span><span>
</span><a name="line-2121"></a><span class="hs-comment">-- | Bring tycon tyvars into scope. This is used during the &quot;kind-checking&quot;</span><span>
</span><a name="line-2122"></a><span class="hs-comment">-- pass in TcTyClsDecls. (Never in getInitialKind, never in the</span><span>
</span><a name="line-2123"></a><span class="hs-comment">-- &quot;type-checking&quot;/desugaring pass.)</span><span>
</span><a name="line-2124"></a><span class="hs-comment">-- Never emits constraints, though the thing_inside might.</span><span>
</span><a name="line-2125"></a><span class="hs-identifier">kcTyClTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308527"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308527"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2126"></a><a name="kcTyClTyVars"><a href="TcHsType.html#kcTyClTyVars"><span class="hs-identifier">kcTyClTyVars</span></a></a><span> </span><a name="local-6989586621680309157"><a href="#local-6989586621680309157"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-6989586621680309158"><a href="#local-6989586621680309158"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-2127"></a><span>  </span><span class="hs-comment">-- See Note [Use SigTvs in kind-checking pass] in TcTyClsDecls</span><span>
</span><a name="line-2128"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309159"><a href="#local-6989586621680309159"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#kcLookupTcTyCon"><span class="hs-identifier hs-var">kcLookupTcTyCon</span></a><span> </span><a href="#local-6989586621680309157"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-2129"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcEnv.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcTyConScopedTyVars</span><span> </span><a href="#local-6989586621680309159"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621680309158"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2130"></a><span>
</span><a name="line-2131"></a><span class="hs-identifier">tcTyClTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-2132"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308526"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308526"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2133"></a><span class="hs-comment">-- ^ Used for the type variables of a type or class decl</span><span>
</span><a name="line-2134"></a><span class="hs-comment">-- on the second full pass (type-checking/desugaring) in TcTyClDecls.</span><span>
</span><a name="line-2135"></a><span class="hs-comment">-- This is *not* used in the initial-kind run, nor in the &quot;kind-checking&quot; pass.</span><span>
</span><a name="line-2136"></a><span class="hs-comment">-- Accordingly, everything passed to the continuation is fully zonked.</span><span>
</span><a name="line-2137"></a><span class="hs-comment">--</span><span>
</span><a name="line-2138"></a><span class="hs-comment">-- (tcTyClTyVars T [a,b] thing_inside)</span><span>
</span><a name="line-2139"></a><span class="hs-comment">--   where T : forall k1 k2 (a:k1 -&gt; *) (b:k1). k2 -&gt; *</span><span>
</span><a name="line-2140"></a><span class="hs-comment">--   calls thing_inside with arguments</span><span>
</span><a name="line-2141"></a><span class="hs-comment">--      [k1,k2,a,b] [k1:*, k2:*, Anon (k1 -&gt; *), Anon k1] (k2 -&gt; *)</span><span>
</span><a name="line-2142"></a><span class="hs-comment">--   having also extended the type environment with bindings</span><span>
</span><a name="line-2143"></a><span class="hs-comment">--   for k1,k2,a,b</span><span>
</span><a name="line-2144"></a><span class="hs-comment">--</span><span>
</span><a name="line-2145"></a><span class="hs-comment">-- Never emits constraints.</span><span>
</span><a name="line-2146"></a><span class="hs-comment">--</span><span>
</span><a name="line-2147"></a><span class="hs-comment">-- The LHsTyVarBndrs is always user-written, and the full, generalised</span><span>
</span><a name="line-2148"></a><span class="hs-comment">-- kind of the tycon is available in the local env.</span><span>
</span><a name="line-2149"></a><a name="tcTyClTyVars"><a href="TcHsType.html#tcTyClTyVars"><span class="hs-identifier">tcTyClTyVars</span></a></a><span> </span><a name="local-6989586621680309160"><a href="#local-6989586621680309160"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-6989586621680309161"><a href="#local-6989586621680309161"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-2150"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309174"><a href="#local-6989586621680309174"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#kcLookupTcTyCon"><span class="hs-identifier hs-var">kcLookupTcTyCon</span></a><span> </span><a href="#local-6989586621680309160"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-2151"></a><span>
</span><a name="line-2152"></a><span>       </span><span class="hs-comment">-- Do checks on scoped tyvars</span><span>
</span><a name="line-2153"></a><span>       </span><span class="hs-comment">-- See Note [Free-floating kind vars]</span><span>
</span><a name="line-2154"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309175"><a href="#local-6989586621680309175"><span class="hs-identifier">flav</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConFlavour"><span class="hs-identifier hs-var">tyConFlavour</span></a><span> </span><a href="#local-6989586621680309174"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-2155"></a><span>             </span><a name="local-6989586621680309176"><a href="#local-6989586621680309176"><span class="hs-identifier">scoped_prs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcTyConScopedTyVars</span><span> </span><a href="#local-6989586621680309174"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-2156"></a><span>             </span><a name="local-6989586621680309177"><a href="#local-6989586621680309177"><span class="hs-identifier">scoped_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-6989586621680309176"><span class="hs-identifier hs-var">scoped_prs</span></a><span>
</span><a name="line-2157"></a><span>             </span><a name="local-6989586621680309178"><a href="#local-6989586621680309178"><span class="hs-identifier">still_sig_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="TcType.html#isSigTyVar"><span class="hs-identifier hs-var">isSigTyVar</span></a><span> </span><a href="#local-6989586621680309177"><span class="hs-identifier hs-var">scoped_tvs</span></a><span>
</span><a name="line-2158"></a><span>
</span><a name="line-2159"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="#local-6989586621680309162"><span class="hs-identifier hs-var">report_sig_tv_err</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#findDupSigTvs"><span class="hs-identifier hs-var">findDupSigTvs</span></a><span> </span><a href="#local-6989586621680309176"><span class="hs-identifier hs-var">scoped_prs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2160"></a><span>
</span><a name="line-2161"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcHsType.html#reportFloatingKvs"><span class="hs-identifier hs-var">reportFloatingKvs</span></a><span> </span><a href="#local-6989586621680309160"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-6989586621680309175"><span class="hs-identifier hs-var">flav</span></a><span>
</span><a name="line-2162"></a><span>                                         </span><a href="#local-6989586621680309177"><span class="hs-identifier hs-var">scoped_tvs</span></a><span> </span><a href="#local-6989586621680309178"><span class="hs-identifier hs-var">still_sig_tvs</span></a><span>
</span><a name="line-2163"></a><span>
</span><a name="line-2164"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309179"><a href="#local-6989586621680309179"><span class="hs-identifier">res_kind</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConResKind</span><span> </span><a href="#local-6989586621680309174"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-2165"></a><span>             </span><a name="local-6989586621680309180"><a href="#local-6989586621680309180"><span class="hs-identifier">binders</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680309163"><span class="hs-identifier hs-var">correct_binders</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConBinders</span><span> </span><a href="#local-6989586621680309174"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309179"><span class="hs-identifier hs-var">res_kind</span></a><span>
</span><a name="line-2166"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcTyClTyVars&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309160"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309180"><span class="hs-identifier hs-var">binders</span></a><span class="hs-special">)</span><span>
</span><a name="line-2167"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#scopeTyVars2"><span class="hs-identifier hs-var">scopeTyVars2</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TyConSkol"><span class="hs-identifier hs-var">TyConSkol</span></a><span> </span><a href="#local-6989586621680309175"><span class="hs-identifier hs-var">flav</span></a><span> </span><a href="#local-6989586621680309160"><span class="hs-identifier hs-var">tycon_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309176"><span class="hs-identifier hs-var">scoped_prs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2168"></a><span>         </span><a href="#local-6989586621680309161"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621680309180"><span class="hs-identifier hs-var">binders</span></a><span> </span><a href="#local-6989586621680309179"><span class="hs-identifier hs-var">res_kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2169"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2170"></a><span>    </span><a name="local-6989586621680309162"><a href="#local-6989586621680309162"><span class="hs-identifier">report_sig_tv_err</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680309164"><a href="#local-6989586621680309164"><span class="hs-identifier">n1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309165"><a href="#local-6989586621680309165"><span class="hs-identifier">n2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2171"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a><span> </span><a href="#local-6989586621680309165"><span class="hs-identifier hs-var">n2</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2172"></a><span>        </span><a href="TcRnMonad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Couldn't match&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309164"><span class="hs-identifier hs-var">n1</span></a><span class="hs-special">)</span><span>
</span><a name="line-2173"></a><span>                        </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;with&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309165"><span class="hs-identifier hs-var">n2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2174"></a><span>
</span><a name="line-2175"></a><span>    </span><span class="hs-comment">-- Given some TyConBinders and a TyCon's result kind, make sure that the</span><span>
</span><a name="line-2176"></a><span>    </span><span class="hs-comment">-- correct any wrong Named/Anon choices. For example, consider</span><span>
</span><a name="line-2177"></a><span>    </span><span class="hs-comment">--   type Syn k = forall (a :: k). Proxy a</span><span>
</span><a name="line-2178"></a><span>    </span><span class="hs-comment">-- At first, it looks like k should be named -- after all, it appears on the RHS.</span><span>
</span><a name="line-2179"></a><span>    </span><span class="hs-comment">-- However, the correct kind for Syn is (* -&gt; *).</span><span>
</span><a name="line-2180"></a><span>    </span><span class="hs-comment">-- (Why? Because k is the kind of a type, so k's kind is *. And the RHS also has</span><span>
</span><a name="line-2181"></a><span>    </span><span class="hs-comment">-- kind *.) See also #13963.</span><span>
</span><a name="line-2182"></a><span>    </span><span class="hs-identifier">correct_binders</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span class="hs-special">]</span><span>
</span><a name="line-2183"></a><span>    </span><a name="local-6989586621680309163"><a href="#local-6989586621680309163"><span class="hs-identifier">correct_binders</span></a></a><span> </span><a name="local-6989586621680309166"><a href="#local-6989586621680309166"><span class="hs-identifier">binders</span></a></a><span> </span><a name="local-6989586621680309167"><a href="#local-6989586621680309167"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-2184"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680309168"><span class="hs-identifier hs-var">binders'</span></a><span>
</span><a name="line-2185"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-2186"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680309168"><a href="#local-6989586621680309168"><span class="hs-identifier">binders'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapAccumR"><span class="hs-identifier hs-var">mapAccumR</span></a><span> </span><a href="#local-6989586621680309169"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621680309167"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309166"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-2187"></a><span>
</span><a name="line-2188"></a><span>        </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span class="hs-special">)</span><span>
</span><a name="line-2189"></a><span>        </span><a name="local-6989586621680309169"><a href="#local-6989586621680309169"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621680309170"><a href="#local-6989586621680309170"><span class="hs-identifier">fvs</span></a></a><span> </span><a name="local-6989586621680309171"><a href="#local-6989586621680309171"><span class="hs-identifier">binder</span></a></a><span>
</span><a name="line-2190"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isNamedTyConBinder"><span class="hs-identifier hs-var">isNamedTyConBinder</span></a><span> </span><a href="#local-6989586621680309171"><span class="hs-identifier hs-var">binder</span></a><span>
</span><a name="line-2191"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309172"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680309170"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2192"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309173"><span class="hs-identifier hs-var">new_fvs</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#mkAnonTyConBinder"><span class="hs-identifier hs-var">mkAnonTyConBinder</span></a><span> </span><a href="#local-6989586621680309172"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2193"></a><span>
</span><a name="line-2194"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#isNamedTyConBinder"><span class="hs-identifier hs-var">isNamedTyConBinder</span></a><span> </span><a href="#local-6989586621680309171"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-2195"></a><span>          </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309172"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680309170"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-2196"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309173"><span class="hs-identifier hs-var">new_fvs</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#mkNamedTyConBinder"><span class="hs-identifier hs-var">mkNamedTyConBinder</span></a><span> </span><a href="Var.html#Required"><span class="hs-identifier hs-var">Required</span></a><span> </span><a href="#local-6989586621680309172"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2197"></a><span>             </span><span class="hs-comment">-- always Required, because it was anonymous (i.e. visible) previously</span><span>
</span><a name="line-2198"></a><span>
</span><a name="line-2199"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2200"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309173"><span class="hs-identifier hs-var">new_fvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309171"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-2201"></a><span>
</span><a name="line-2202"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-2203"></a><span>            </span><a name="local-6989586621680309172"><a href="#local-6989586621680309172"><span class="hs-identifier">tv</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a><span> </span><a href="#local-6989586621680309171"><span class="hs-identifier hs-var">binder</span></a><span>
</span><a name="line-2204"></a><span>            </span><a name="local-6989586621680309173"><a href="#local-6989586621680309173"><span class="hs-identifier">new_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680309170"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#delVarSet"><span class="hs-identifier hs-var">delVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680309172"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621680309172"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2205"></a><span>
</span><a name="line-2206"></a><span class="hs-comment">-----------------------------------</span><span>
</span><a name="line-2207"></a><span class="hs-identifier">tcDataKindSig</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span class="hs-special">]</span><span>
</span><a name="line-2208"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-2209"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2210"></a><span class="hs-comment">-- GADT decls can have a (perhaps partial) kind signature</span><span>
</span><a name="line-2211"></a><span class="hs-comment">--      e.g.  data T a :: * -&gt; * -&gt; * where ...</span><span>
</span><a name="line-2212"></a><span class="hs-comment">-- This function makes up suitable (kinded) TyConBinders for the</span><span>
</span><a name="line-2213"></a><span class="hs-comment">-- argument kinds.  E.g. in this case it might return</span><span>
</span><a name="line-2214"></a><span class="hs-comment">--   ([b::*, c::*], *)</span><span>
</span><a name="line-2215"></a><span class="hs-comment">-- Never emits constraints.</span><span>
</span><a name="line-2216"></a><span class="hs-comment">-- It's a little trickier than you might think: see</span><span>
</span><a name="line-2217"></a><span class="hs-comment">-- Note [TyConBinders for the result kind signature of a data type]</span><span>
</span><a name="line-2218"></a><a name="tcDataKindSig"><a href="TcHsType.html#tcDataKindSig"><span class="hs-identifier">tcDataKindSig</span></a></a><span> </span><a name="local-6989586621680309181"><a href="#local-6989586621680309181"><span class="hs-identifier">tc_bndrs</span></a></a><span> </span><a name="local-6989586621680309182"><a href="#local-6989586621680309182"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-2219"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309208"><a href="#local-6989586621680309208"><span class="hs-identifier">loc</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-2220"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309209"><a href="#local-6989586621680309209"><span class="hs-identifier">uniqs</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a><span>
</span><a name="line-2221"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309210"><a href="#local-6989586621680309210"><span class="hs-identifier">rdr_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a><span>
</span><a name="line-2222"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309211"><a href="#local-6989586621680309211"><span class="hs-identifier">new_occs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621680309215"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-2223"></a><span>                         </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680309214"><a href="#local-6989586621680309214"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelNames.html#allNameStrings"><span class="hs-identifier hs-var">allNameStrings</span></a><span>
</span><a name="line-2224"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309215"><a href="#local-6989586621680309215"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkOccName"><span class="hs-identifier hs-var">mkOccName</span></a><span> </span><a href="OccName.html#tvName"><span class="hs-identifier hs-var">tvName</span></a><span> </span><a href="#local-6989586621680309214"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-2225"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#lookupLocalRdrOcc"><span class="hs-identifier hs-var">lookupLocalRdrOcc</span></a><span> </span><a href="#local-6989586621680309210"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621680309215"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-2226"></a><span>                         </span><span class="hs-comment">-- Note [Avoid name clashes for associated data types]</span><span>
</span><a name="line-2227"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309215"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680309184"><span class="hs-identifier hs-var">lhs_occs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2228"></a><span>              </span><a name="local-6989586621680309212"><a href="#local-6989586621680309212"><span class="hs-identifier">new_uniqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#uniqsFromSupply"><span class="hs-identifier hs-var">uniqsFromSupply</span></a><span> </span><a href="#local-6989586621680309209"><span class="hs-identifier hs-var">uniqs</span></a><span>
</span><a name="line-2229"></a><span>              </span><a name="local-6989586621680309213"><a href="#local-6989586621680309213"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="VarSet.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a><span> </span><a href="#local-6989586621680309183"><span class="hs-identifier hs-var">lhs_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2230"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309185"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680309208"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621680309211"><span class="hs-identifier hs-var">new_occs</span></a><span> </span><a href="#local-6989586621680309212"><span class="hs-identifier hs-var">new_uniqs</span></a><span> </span><a href="#local-6989586621680309213"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621680309182"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2231"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2232"></a><span>    </span><a name="local-6989586621680309183"><a href="#local-6989586621680309183"><span class="hs-identifier">lhs_tvs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a><span> </span><a href="#local-6989586621680309181"><span class="hs-identifier hs-var">tc_bndrs</span></a><span>
</span><a name="line-2233"></a><span>    </span><a name="local-6989586621680309184"><a href="#local-6989586621680309184"><span class="hs-identifier">lhs_occs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-6989586621680309183"><span class="hs-identifier hs-var">lhs_tvs</span></a><span>
</span><a name="line-2234"></a><span>
</span><a name="line-2235"></a><span>    </span><a name="local-6989586621680309185"><a href="#local-6989586621680309185"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621680309186"><a href="#local-6989586621680309186"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621680309187"><a href="#local-6989586621680309187"><span class="hs-identifier">occs</span></a></a><span> </span><a name="local-6989586621680309188"><a href="#local-6989586621680309188"><span class="hs-identifier">uniqs</span></a></a><span> </span><a name="local-6989586621680309189"><a href="#local-6989586621680309189"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621680309190"><a href="#local-6989586621680309190"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621680309191"><a href="#local-6989586621680309191"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-2236"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitPiTy_maybe"><span class="hs-identifier hs-var">splitPiTy_maybe</span></a><span> </span><a href="#local-6989586621680309191"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2237"></a><span>          </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-6989586621680309190"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621680309189"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621680309191"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2238"></a><span>
</span><a name="line-2239"></a><span>          </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-6989586621680309192"><a href="#local-6989586621680309192"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309193"><a href="#local-6989586621680309193"><span class="hs-identifier">kind'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2240"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680309185"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680309186"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621680309201"><span class="hs-identifier hs-var">occs'</span></a><span> </span><a href="#local-6989586621680309199"><span class="hs-identifier hs-var">uniqs'</span></a><span> </span><a href="#local-6989586621680309196"><span class="hs-identifier hs-var">subst'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309197"><span class="hs-identifier hs-var">tcb</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680309190"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309193"><span class="hs-identifier hs-var">kind'</span></a><span>
</span><a name="line-2241"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-2242"></a><span>              </span><a name="local-6989586621680309194"><a href="#local-6989586621680309194"><span class="hs-identifier">arg'</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621680309189"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621680309192"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2243"></a><span>              </span><a name="local-6989586621680309195"><a href="#local-6989586621680309195"><span class="hs-identifier">tv</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkTyVar"><span class="hs-identifier hs-var">mkTyVar</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a><span> </span><a href="#local-6989586621680309198"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621680309200"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-6989586621680309186"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309194"><span class="hs-identifier hs-var">arg'</span></a><span>
</span><a name="line-2244"></a><span>              </span><a name="local-6989586621680309196"><a href="#local-6989586621680309196"><span class="hs-identifier">subst'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#extendTCvInScope"><span class="hs-identifier hs-var">extendTCvInScope</span></a><span> </span><a href="#local-6989586621680309189"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621680309195"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2245"></a><span>              </span><a name="local-6989586621680309197"><a href="#local-6989586621680309197"><span class="hs-identifier">tcb</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a href="#local-6989586621680309195"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="TyCon.html#AnonTCB"><span class="hs-identifier hs-var">AnonTCB</span></a><span>
</span><a name="line-2246"></a><span>              </span><span class="hs-special">(</span><a name="local-6989586621680309198"><a href="#local-6989586621680309198"><span class="hs-identifier">uniq</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680309199"><a href="#local-6989586621680309199"><span class="hs-identifier">uniqs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680309188"><span class="hs-identifier hs-var">uniqs</span></a><span>
</span><a name="line-2247"></a><span>              </span><span class="hs-special">(</span><a name="local-6989586621680309200"><a href="#local-6989586621680309200"><span class="hs-identifier">occ</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680309201"><a href="#local-6989586621680309201"><span class="hs-identifier">occs'</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680309187"><span class="hs-identifier hs-var">occs</span></a><span>
</span><a name="line-2248"></a><span>
</span><a name="line-2249"></a><span>          </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a name="local-6989586621680309202"><a href="#local-6989586621680309202"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621680309203"><a href="#local-6989586621680309203"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680309204"><a href="#local-6989586621680309204"><span class="hs-identifier">kind'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2250"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680309185"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680309186"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621680309187"><span class="hs-identifier hs-var">occs</span></a><span> </span><a href="#local-6989586621680309188"><span class="hs-identifier hs-var">uniqs</span></a><span> </span><a href="#local-6989586621680309205"><span class="hs-identifier hs-var">subst'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309207"><span class="hs-identifier hs-var">tcb</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680309190"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309204"><span class="hs-identifier hs-var">kind'</span></a><span>
</span><a name="line-2251"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-2252"></a><span>              </span><span class="hs-special">(</span><a name="local-6989586621680309205"><a href="#local-6989586621680309205"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309206"><a href="#local-6989586621680309206"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyVarBndr"><span class="hs-identifier hs-var">substTyVarBndr</span></a><span> </span><a href="#local-6989586621680309189"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621680309202"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2253"></a><span>              </span><a name="local-6989586621680309207"><a href="#local-6989586621680309207"><span class="hs-identifier">tcb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a href="#local-6989586621680309206"><span class="hs-identifier hs-var">tv'</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#NamedTCB"><span class="hs-identifier hs-var">NamedTCB</span></a><span> </span><a href="#local-6989586621680309203"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span>
</span><a name="line-2254"></a><span>
</span><a name="line-2255"></a><span class="hs-identifier">badKindSig</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2256"></a><a name="badKindSig"><a href="TcHsType.html#badKindSig"><span class="hs-identifier">badKindSig</span></a></a><span> </span><a name="local-6989586621680309216"><a href="#local-6989586621680309216"><span class="hs-identifier">check_for_type</span></a></a><span> </span><a name="local-6989586621680309217"><a href="#local-6989586621680309217"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-2257"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Kind signature on data type declaration has non-*&quot;</span><span>
</span><a name="line-2258"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680309216"><span class="hs-identifier hs-var">check_for_type</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;and non-variable&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-2259"></a><span>               </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;return kind&quot;</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2260"></a><span>        </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309217"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2261"></a><span>
</span><a name="line-2262"></a><span class="hs-comment">{- Note [TyConBinders for the result kind signature of a data type]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Given
  data T (a::*) :: * -&gt; forall k. k -&gt; *
we want to generate the extra TyConBinders for T, so we finally get
  (a::*) (b::*) (k::*) (c::k)
The function tcDataKindSig generates these extra TyConBinders from
the result kind signature.

We need to take care to give the TyConBinders
  (a) OccNames that are fresh (because the TyConBinders of a TyCon
      must have distinct OccNames

  (b) Uniques that are fresh (obviously)

For (a) we need to avoid clashes with the tyvars declared by
the user before the &quot;::&quot;; in the above example that is 'a'.
And also see Note [Avoid name clashes for associated data types].

For (b) suppose we have
   data T :: forall k. k -&gt; forall k. k -&gt; *
where the two k's are identical even up to their uniques.  Surprisingly,
this can happen: see Trac #14515.

It's reasonably easy to solve all this; just run down the list with a
substitution; hence the recursive 'go' function.  But it has to be
done.

Note [Avoid name clashes for associated data types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider    class C a b where
               data D b :: * -&gt; *
When typechecking the decl for D, we'll invent an extra type variable
for D, to fill out its kind.  Ideally we don't want this type variable
to be 'a', because when pretty printing we'll get
            class C a b where
               data D b a0
(NB: the tidying happens in the conversion to IfaceSyn, which happens
as part of pretty-printing a TyThing.)

That's why we look in the LocalRdrEnv to see what's in scope. This is
important only to get nice-looking output when doing &quot;:info C&quot; in GHCi.
It isn't essential for correctness.


************************************************************************
*                                                                      *
             Partial signatures
*                                                                      *
************************************************************************

-}</span><span>
</span><a name="line-2314"></a><span>
</span><a name="line-2315"></a><span class="hs-identifier">tcHsPartialSigType</span><span>
</span><a name="line-2316"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>
</span><a name="line-2317"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>       </span><span class="hs-comment">-- The type signature</span><span>
</span><a name="line-2318"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Wildcards</span><span>
</span><a name="line-2319"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>       </span><span class="hs-comment">-- Extra-constraints wildcard</span><span>
</span><a name="line-2320"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- Original tyvar names, in correspondence with ...</span><span>
</span><a name="line-2321"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- ... Implicitly and explicitly bound type variables</span><span>
</span><a name="line-2322"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span>        </span><span class="hs-comment">-- Theta part</span><span>
</span><a name="line-2323"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Tau part</span><span>
</span><a name="line-2324"></a><span class="hs-comment">-- See Note [Recipe for checking a signature]</span><span>
</span><a name="line-2325"></a><a name="tcHsPartialSigType"><a href="TcHsType.html#tcHsPartialSigType"><span class="hs-identifier">tcHsPartialSigType</span></a></a><span> </span><a name="local-6989586621680309218"><a href="#local-6989586621680309218"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621680309219"><a href="#local-6989586621680309219"><span class="hs-identifier">sig_ty</span></a></a><span>
</span><a name="line-2326"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="HsTypes.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_ext</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309221"><a href="#local-6989586621680309221"><span class="hs-identifier">sig_wcs</span></a></a><span class="hs-special">,</span><span>         </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309222"><a href="#local-6989586621680309222"><span class="hs-identifier">ib_ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309219"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-2327"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#HsIBRn"><span class="hs-identifier hs-var">HsIBRn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309223"><a href="#local-6989586621680309223"><span class="hs-identifier">implicit_hs_tvs</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2328"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309224"><a href="#local-6989586621680309224"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309222"><span class="hs-identifier hs-var">ib_ty</span></a><span>
</span><a name="line-2329"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309225"><a href="#local-6989586621680309225"><span class="hs-identifier">explicit_hs_tvs</span></a></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680309226"><a href="#local-6989586621680309226"><span class="hs-identifier">hs_ctxt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309227"><a href="#local-6989586621680309227"><span class="hs-identifier">hs_tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HsTypes.html#splitLHsSigmaTy"><span class="hs-identifier hs-var">splitLHsSigmaTy</span></a><span> </span><a href="#local-6989586621680309224"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-2330"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span> </span><a href="#local-6989586621680309218"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621680309224"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2331"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309232"><a href="#local-6989586621680309232"><span class="hs-identifier">implicit_tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309233"><a href="#local-6989586621680309233"><span class="hs-identifier">explicit_tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309234"><a href="#local-6989586621680309234"><span class="hs-identifier">wcs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309235"><a href="#local-6989586621680309235"><span class="hs-identifier">wcx</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309236"><a href="#local-6989586621680309236"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309237"><a href="#local-6989586621680309237"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2332"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcWildCardBindersX"><span class="hs-identifier hs-var">tcWildCardBindersX</span></a><span> </span><a href="TcHsType.html#newWildTyVar"><span class="hs-identifier hs-var">newWildTyVar</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621680309221"><span class="hs-identifier hs-var">sig_wcs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621680309228"><a href="#local-6989586621680309228"><span class="hs-identifier">wcs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2333"></a><span>               </span><a href="TcHsType.html#tcImplicitTKBndrsSig"><span class="hs-identifier hs-var">tcImplicitTKBndrsSig</span></a><span> </span><a href="#local-6989586621680309220"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680309223"><span class="hs-identifier hs-var">implicit_hs_tvs</span></a><span>      </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2334"></a><span>               </span><a href="TcHsType.html#tcExplicitTKBndrs"><span class="hs-identifier hs-var">tcExplicitTKBndrs</span></a><span>    </span><a href="#local-6989586621680309220"><span class="hs-identifier hs-var">skol_info</span></a><span> </span><a href="#local-6989586621680309225"><span class="hs-identifier hs-var">explicit_hs_tvs</span></a><span>      </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2335"></a><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">-- Instantiate the type-class context; but if there</span><span>
</span><a name="line-2336"></a><span>                      </span><span class="hs-comment">-- is an extra-constraints wildcard, just discard it here</span><span>
</span><a name="line-2337"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621680309229"><a href="#local-6989586621680309229"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309230"><a href="#local-6989586621680309230"><span class="hs-identifier">wcx</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcPartialContext"><span class="hs-identifier hs-var">tcPartialContext</span></a><span> </span><a href="#local-6989586621680309226"><span class="hs-identifier hs-var">hs_ctxt</span></a><span>
</span><a name="line-2338"></a><span>
</span><a name="line-2339"></a><span>                  </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309231"><a href="#local-6989586621680309231"><span class="hs-identifier">tau</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsOpenType"><span class="hs-identifier hs-var">tcHsOpenType</span></a><span> </span><a href="#local-6989586621680309227"><span class="hs-identifier hs-var">hs_tau</span></a><span>
</span><a name="line-2340"></a><span>
</span><a name="line-2341"></a><span>                  </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309228"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309230"><span class="hs-identifier hs-var">wcx</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309229"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309231"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2342"></a><span>
</span><a name="line-2343"></a><span>         </span><span class="hs-comment">-- We must return these separately, because all the zonking below</span><span>
</span><a name="line-2344"></a><span>         </span><span class="hs-comment">-- might change the name of a SigTv. This, in turn, causes trouble</span><span>
</span><a name="line-2345"></a><span>         </span><span class="hs-comment">-- in partial type signatures that bind scoped type variables, as</span><span>
</span><a name="line-2346"></a><span>         </span><span class="hs-comment">-- we bring the wrong name into scope in the function body.</span><span>
</span><a name="line-2347"></a><span>         </span><span class="hs-comment">-- Test case: partial-sigs/should_compile/LocalDefinitionBug</span><span>
</span><a name="line-2348"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309238"><a href="#local-6989586621680309238"><span class="hs-identifier">tv_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309232"><span class="hs-identifier hs-var">implicit_tvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680309233"><span class="hs-identifier hs-var">explicit_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2349"></a><span>
</span><a name="line-2350"></a><span>       </span><span class="hs-comment">-- Spit out the wildcards (including the extra-constraints one)</span><span>
</span><a name="line-2351"></a><span>       </span><span class="hs-comment">-- as &quot;hole&quot; constraints, so that they'll be reported if necessary</span><span>
</span><a name="line-2352"></a><span>       </span><span class="hs-comment">-- See Note [Extra-constraint holes in partial type signatures]</span><span>
</span><a name="line-2353"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#emitWildCardHoleConstraints"><span class="hs-identifier hs-var">emitWildCardHoleConstraints</span></a><span> </span><a href="#local-6989586621680309234"><span class="hs-identifier hs-var">wcs</span></a><span>
</span><a name="line-2354"></a><span>
</span><a name="line-2355"></a><span>         </span><span class="hs-comment">-- The SigTvs created above will sometimes have too high a TcLevel</span><span>
</span><a name="line-2356"></a><span>         </span><span class="hs-comment">-- (note that they are generated *after* bumping the level in</span><span>
</span><a name="line-2357"></a><span>         </span><span class="hs-comment">-- the tc{Im,Ex}plicitTKBndrsSig functions. Bumping the level</span><span>
</span><a name="line-2358"></a><span>         </span><span class="hs-comment">-- is still important here, because the kinds of these variables</span><span>
</span><a name="line-2359"></a><span>         </span><span class="hs-comment">-- do indeed need to have the higher level, so they can unify</span><span>
</span><a name="line-2360"></a><span>         </span><span class="hs-comment">-- with other local type variables. But, now that we've type-checked</span><span>
</span><a name="line-2361"></a><span>         </span><span class="hs-comment">-- everything (and solved equalities in the tcImplicit call)</span><span>
</span><a name="line-2362"></a><span>         </span><span class="hs-comment">-- we need to promote the SigTvs so we don't violate the TcLevel</span><span>
</span><a name="line-2363"></a><span>         </span><span class="hs-comment">-- invariant</span><span>
</span><a name="line-2364"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309239"><a href="#local-6989586621680309239"><span class="hs-identifier">all_tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcHsType.html#zonkPromoteTyCoVarBndr"><span class="hs-identifier hs-var">zonkPromoteTyCoVarBndr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309232"><span class="hs-identifier hs-var">implicit_tvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621680309233"><span class="hs-identifier hs-var">explicit_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2365"></a><span>            </span><span class="hs-comment">-- zonkPromoteTyCoVarBndr deals well with SigTvs</span><span>
</span><a name="line-2366"></a><span>
</span><a name="line-2367"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309240"><a href="#local-6989586621680309240"><span class="hs-identifier">theta</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcHsType.html#zonkPromoteType"><span class="hs-identifier hs-var">zonkPromoteType</span></a><span> </span><a href="#local-6989586621680309236"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-2368"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309241"><a href="#local-6989586621680309241"><span class="hs-identifier">tau</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#zonkPromoteType"><span class="hs-identifier hs-var">zonkPromoteType</span></a><span> </span><a href="#local-6989586621680309237"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-2369"></a><span>
</span><a name="line-2370"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span> </span><a href="#local-6989586621680309218"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span> </span><a href="#local-6989586621680309239"><span class="hs-identifier hs-var">all_tvs</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a><span> </span><a href="#local-6989586621680309240"><span class="hs-identifier hs-var">theta</span></a><span> </span><a href="#local-6989586621680309241"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span>
</span><a name="line-2371"></a><span>
</span><a name="line-2372"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcHsPartialSigType&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309239"><span class="hs-identifier hs-var">all_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2373"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309234"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309235"><span class="hs-identifier hs-var">wcx</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309238"><span class="hs-identifier hs-var">tv_names</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309239"><span class="hs-identifier hs-var">all_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309240"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309241"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2374"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2375"></a><span>    </span><a name="local-6989586621680309220"><a href="#local-6989586621680309220"><span class="hs-identifier">skol_info</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#SigTypeSkol"><span class="hs-identifier hs-var">SigTypeSkol</span></a><span> </span><a href="#local-6989586621680309218"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-2376"></a><span class="hs-identifier">tcHsPartialSigType</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XHsImplicitBndrs"><span class="hs-identifier hs-var">XHsImplicitBndrs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tcHsPartialSigType&quot;</span><span>
</span><a name="line-2377"></a><span class="hs-identifier">tcHsPartialSigType</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XHsWildCardBndrs"><span class="hs-identifier hs-var">XHsWildCardBndrs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tcHsPartialSigType&quot;</span><span>
</span><a name="line-2378"></a><span>
</span><a name="line-2379"></a><span class="hs-identifier">tcPartialContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#HsContext"><span class="hs-identifier hs-type">HsContext</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>
</span><a name="line-2380"></a><a name="tcPartialContext"><a href="TcHsType.html#tcPartialContext"><span class="hs-identifier">tcPartialContext</span></a></a><span> </span><a name="local-6989586621680309242"><a href="#local-6989586621680309242"><span class="hs-identifier">hs_theta</span></a></a><span>
</span><a name="line-2381"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680309243"><a href="#local-6989586621680309243"><span class="hs-identifier">hs_theta1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309244"><a href="#local-6989586621680309244"><span class="hs-identifier">hs_ctxt_last</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Util.html#snocView"><span class="hs-identifier hs-var">snocView</span></a><span> </span><a href="#local-6989586621680309242"><span class="hs-identifier hs-var">hs_theta</span></a><span>
</span><a name="line-2382"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsWildCardTy"><span class="hs-identifier hs-var">HsWildCardTy</span></a><span> </span><a name="local-6989586621680309245"><a href="#local-6989586621680309245"><span class="hs-identifier">wc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HsTypes.html#ignoreParens"><span class="hs-identifier hs-var">ignoreParens</span></a><span> </span><a href="#local-6989586621680309244"><span class="hs-identifier hs-var">hs_ctxt_last</span></a><span>
</span><a name="line-2383"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309246"><a href="#local-6989586621680309246"><span class="hs-identifier">wc_tv_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcWildCardOcc"><span class="hs-identifier hs-var">tcWildCardOcc</span></a><span> </span><a href="#local-6989586621680309245"><span class="hs-identifier hs-var">wc</span></a><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-2384"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309247"><a href="#local-6989586621680309247"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcHsType.html#tcLHsPredType"><span class="hs-identifier hs-var">tcLHsPredType</span></a><span> </span><a href="#local-6989586621680309243"><span class="hs-identifier hs-var">hs_theta1</span></a><span>
</span><a name="line-2385"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309247"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621680309246"><span class="hs-identifier hs-var">wc_tv_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2386"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2387"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309248"><a href="#local-6989586621680309248"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcHsType.html#tcLHsPredType"><span class="hs-identifier hs-var">tcLHsPredType</span></a><span> </span><a href="#local-6989586621680309242"><span class="hs-identifier hs-var">hs_theta</span></a><span>
</span><a name="line-2388"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309248"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2389"></a><span>
</span><a name="line-2390"></a><span class="hs-comment">{- Note [Extra-constraint holes in partial type signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  f :: (_) =&gt; a -&gt; a
  f x = ...

* The renamer makes a wildcard name for the &quot;_&quot;, and puts it in
  the hswc_wcs field.

* Then, in tcHsPartialSigType, we make a new hole TcTyVar, in
  tcWildCardBindersX.

* TcBinds.chooseInferredQuantifiers fills in that hole TcTyVar
  with the inferred constraints, e.g. (Eq a, Show a)

* TcErrors.mkHoleError finally reports the error.

An annoying difficulty happens if there are more than 62 inferred
constraints. Then we need to fill in the TcTyVar with (say) a 70-tuple.
Where do we find the TyCon?  For good reasons we only have constraint
tuples up to 62 (see Note [How tuples work] in TysWiredIn).  So how
can we make a 70-tuple?  This was the root cause of Trac #14217.

It's incredibly tiresome, because we only need this type to fill
in the hole, to communicate to the error reporting machinery.  Nothing
more.  So I use a HACK:

* I make an /ordinary/ tuple of the constraints, in
  TcBinds.chooseInferredQuantifiers. This is ill-kinded because
  ordinary tuples can't contain constraints, but it works fine. And for
  ordinary tuples we don't have the same limit as for constraint
  tuples (which need selectors and an assocated class).

* Because it is ill-kinded, it trips an assert in writeMetaTyVar,
  so now I disable the assertion if we are writing a type of
  kind Constraint.  (That seldom/never normally happens so we aren't
  losing much.)

Result works fine, but it may eventually bite us.


************************************************************************
*                                                                      *
      Pattern signatures (i.e signatures that occur in patterns)
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-2436"></a><span>
</span><a name="line-2437"></a><span class="hs-identifier">tcHsPatSigType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>
</span><a name="line-2438"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>          </span><span class="hs-comment">-- The type signature</span><span>
</span><a name="line-2439"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Wildcards</span><span>
</span><a name="line-2440"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- The new bit of type environment, binding</span><span>
</span><a name="line-2441"></a><span>                                              </span><span class="hs-comment">-- the scoped type variables</span><span>
</span><a name="line-2442"></a><span>                      </span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- The type</span><span>
</span><a name="line-2443"></a><span class="hs-comment">-- Used for type-checking type signatures in</span><span>
</span><a name="line-2444"></a><span class="hs-comment">-- (a) patterns           e.g  f (x::Int) = e</span><span>
</span><a name="line-2445"></a><span class="hs-comment">-- (b) RULE forall bndrs  e.g. forall (x::Int). f x = x</span><span>
</span><a name="line-2446"></a><span class="hs-comment">--</span><span>
</span><a name="line-2447"></a><span class="hs-comment">-- This may emit constraints</span><span>
</span><a name="line-2448"></a><span class="hs-comment">-- See Note [Recipe for checking a signature]</span><span>
</span><a name="line-2449"></a><a name="tcHsPatSigType"><a href="TcHsType.html#tcHsPatSigType"><span class="hs-identifier">tcHsPatSigType</span></a></a><span> </span><a name="local-6989586621680309249"><a href="#local-6989586621680309249"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621680309250"><a href="#local-6989586621680309250"><span class="hs-identifier">sig_ty</span></a></a><span>
</span><a name="line-2450"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="HsTypes.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309258"><a href="#local-6989586621680309258"><span class="hs-identifier">sig_wcs</span></a></a><span class="hs-special">,</span><span>   </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309259"><a href="#local-6989586621680309259"><span class="hs-identifier">ib_ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309250"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-2451"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#HsIBRn"><span class="hs-identifier hs-var">HsIBRn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309260"><a href="#local-6989586621680309260"><span class="hs-identifier">sig_vars</span></a></a><span class="hs-special">}</span><span>
</span><a name="line-2452"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680309261"><a href="#local-6989586621680309261"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309259"><span class="hs-identifier hs-var">ib_ty</span></a><span>
</span><a name="line-2453"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a><span> </span><a href="#local-6989586621680309249"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621680309261"><span class="hs-identifier hs-var">hs_ty</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2454"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309262"><a href="#local-6989586621680309262"><span class="hs-identifier">sig_tkvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-6989586621680309251"><span class="hs-identifier hs-var">new_implicit_tv</span></a><span> </span><a href="#local-6989586621680309260"><span class="hs-identifier hs-var">sig_vars</span></a><span>
</span><a name="line-2455"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309265"><a href="#local-6989586621680309265"><span class="hs-identifier">wcs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309266"><a href="#local-6989586621680309266"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2456"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcWildCardBindersX"><span class="hs-identifier hs-var">tcWildCardBindersX</span></a><span> </span><a href="TcHsType.html#newWildTyVar"><span class="hs-identifier hs-var">newWildTyVar</span></a><span>    </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621680309258"><span class="hs-identifier hs-var">sig_wcs</span></a><span>  </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621680309263"><a href="#local-6989586621680309263"><span class="hs-identifier">wcs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2457"></a><span>               </span><a href="TcEnv.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a><span> </span><a href="#local-6989586621680309262"><span class="hs-identifier hs-var">sig_tkvs</span></a><span>                           </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2458"></a><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309264"><a href="#local-6989586621680309264"><span class="hs-identifier">sig_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsOpenType"><span class="hs-identifier hs-var">tcHsOpenType</span></a><span> </span><a href="#local-6989586621680309261"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-2459"></a><span>                  </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309263"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309264"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2460"></a><span>
</span><a name="line-2461"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#emitWildCardHoleConstraints"><span class="hs-identifier hs-var">emitWildCardHoleConstraints</span></a><span> </span><a href="#local-6989586621680309265"><span class="hs-identifier hs-var">wcs</span></a><span>
</span><a name="line-2462"></a><span>
</span><a name="line-2463"></a><span>          </span><span class="hs-comment">-- sig_ty might have tyvars that are at a higher TcLevel (if hs_ty</span><span>
</span><a name="line-2464"></a><span>          </span><span class="hs-comment">-- contains a forall). Promote these.</span><span>
</span><a name="line-2465"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309267"><a href="#local-6989586621680309267"><span class="hs-identifier">sig_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#zonkPromoteType"><span class="hs-identifier hs-var">zonkPromoteType</span></a><span> </span><a href="#local-6989586621680309266"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-2466"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span> </span><a href="#local-6989586621680309249"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621680309267"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-2467"></a><span>
</span><a name="line-2468"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309268"><a href="#local-6989586621680309268"><span class="hs-identifier">tv_pairs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-6989586621680309253"><span class="hs-identifier hs-var">mk_tv_pair</span></a><span> </span><a href="#local-6989586621680309262"><span class="hs-identifier hs-var">sig_tkvs</span></a><span>
</span><a name="line-2469"></a><span>
</span><a name="line-2470"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;tcHsPatSigType&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309260"><span class="hs-identifier hs-var">sig_vars</span></a><span class="hs-special">)</span><span>
</span><a name="line-2471"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309265"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309268"><span class="hs-identifier hs-var">tv_pairs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309267"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2472"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2473"></a><span>    </span><a name="local-6989586621680309251"><a href="#local-6989586621680309251"><span class="hs-identifier">new_implicit_tv</span></a></a><span> </span><a name="local-6989586621680309254"><a href="#local-6989586621680309254"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309255"><a href="#local-6989586621680309255"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-2474"></a><span>                              </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621680309252"><span class="hs-identifier hs-var">new_tv</span></a><span> </span><a href="#local-6989586621680309254"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680309255"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2475"></a><span>
</span><a name="line-2476"></a><span>    </span><a name="local-6989586621680309252"><a href="#local-6989586621680309252"><span class="hs-identifier">new_tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680309249"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2477"></a><span>               </span><a href="TcType.html#RuleSigCtxt"><span class="hs-identifier hs-var">RuleSigCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#newSkolemTyVar"><span class="hs-identifier hs-var">newSkolemTyVar</span></a><span>
</span><a name="line-2478"></a><span>               </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#newSigTyVar"><span class="hs-identifier hs-var">newSigTyVar</span></a><span>
</span><a name="line-2479"></a><span>      </span><span class="hs-comment">-- See Note [Pattern signature binders]</span><span>
</span><a name="line-2480"></a><span>      </span><span class="hs-comment">-- See Note [Unifying SigTvs]</span><span>
</span><a name="line-2481"></a><span>
</span><a name="line-2482"></a><span>    </span><a name="local-6989586621680309253"><a href="#local-6989586621680309253"><span class="hs-identifier">mk_tv_pair</span></a></a><span> </span><a name="local-6989586621680309256"><a href="#local-6989586621680309256"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309257"><a href="#local-6989586621680309257"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcTyVarToTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTyVar</span></a><span> </span><a href="#local-6989586621680309256"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2483"></a><span>                       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-6989586621680309256"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309257"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2484"></a><span>         </span><span class="hs-comment">-- The Name is one of sig_vars, the lexically scoped name</span><span>
</span><a name="line-2485"></a><span>         </span><span class="hs-comment">-- But if it's a SigTyVar, it might have been unified</span><span>
</span><a name="line-2486"></a><span>         </span><span class="hs-comment">-- with an existing in-scope skolem, so we must zonk</span><span>
</span><a name="line-2487"></a><span>         </span><span class="hs-comment">-- here.  See Note [Pattern signature binders]</span><span>
</span><a name="line-2488"></a><span class="hs-identifier">tcHsPatSigType</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsWC"><span class="hs-identifier hs-var">HsWC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XHsImplicitBndrs"><span class="hs-identifier hs-var">XHsImplicitBndrs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tcHsPatSigType&quot;</span><span>
</span><a name="line-2489"></a><span class="hs-identifier">tcHsPatSigType</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsTypes.html#XHsWildCardBndrs"><span class="hs-identifier hs-var">XHsWildCardBndrs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tcHsPatSigType&quot;</span><span>
</span><a name="line-2490"></a><span>
</span><a name="line-2491"></a><span class="hs-identifier">tcPatSig</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>                    </span><span class="hs-comment">-- True &lt;=&gt; pattern binding</span><span>
</span><a name="line-2492"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>
</span><a name="line-2493"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a><span>
</span><a name="line-2494"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- The type to use for &quot;inside&quot; the signature</span><span>
</span><a name="line-2495"></a><span>                 </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- The new bit of type environment, binding</span><span>
</span><a name="line-2496"></a><span>                                    </span><span class="hs-comment">-- the scoped type variables</span><span>
</span><a name="line-2497"></a><span>                 </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- The wildcards</span><span>
</span><a name="line-2498"></a><span>                 </span><a href="TcEvidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Coercion due to unification with actual ty</span><span>
</span><a name="line-2499"></a><span>                                    </span><span class="hs-comment">-- Of shape:  res_ty ~ sig_ty</span><span>
</span><a name="line-2500"></a><a name="tcPatSig"><a href="TcHsType.html#tcPatSig"><span class="hs-identifier">tcPatSig</span></a></a><span> </span><a name="local-6989586621680309269"><a href="#local-6989586621680309269"><span class="hs-identifier">in_pat_bind</span></a></a><span> </span><a name="local-6989586621680309270"><a href="#local-6989586621680309270"><span class="hs-identifier">sig</span></a></a><span> </span><a name="local-6989586621680309271"><a href="#local-6989586621680309271"><span class="hs-identifier">res_ty</span></a></a><span>
</span><a name="line-2501"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309281"><a href="#local-6989586621680309281"><span class="hs-identifier">sig_wcs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309282"><a href="#local-6989586621680309282"><span class="hs-identifier">sig_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309283"><a href="#local-6989586621680309283"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#tcHsPatSigType"><span class="hs-identifier hs-var">tcHsPatSigType</span></a><span> </span><a href="TcType.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a><span> </span><a href="#local-6989586621680309270"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-2502"></a><span>        </span><span class="hs-comment">-- sig_tvs are the type variables free in 'sig',</span><span>
</span><a name="line-2503"></a><span>        </span><span class="hs-comment">-- and not already in scope. These are the ones</span><span>
</span><a name="line-2504"></a><span>        </span><span class="hs-comment">-- that should be brought into scope</span><span>
</span><a name="line-2505"></a><span>
</span><a name="line-2506"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680309282"><span class="hs-identifier hs-var">sig_tvs</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2507"></a><span>                </span><span class="hs-comment">-- Just do the subsumption check and return</span><span>
</span><a name="line-2508"></a><span>                  </span><a name="local-6989586621680309284"><a href="#local-6989586621680309284"><span class="hs-identifier">wrap</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309272"><span class="hs-identifier hs-var">mk_msg</span></a><span> </span><a href="#local-6989586621680309283"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2509"></a><span>                          </span><a href="TcUnify.html#tcSubTypeET"><span class="hs-identifier hs-var">tcSubTypeET</span></a><span> </span><a href="TcRnTypes.html#PatSigOrigin"><span class="hs-identifier hs-var">PatSigOrigin</span></a><span> </span><a href="TcType.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a><span> </span><a href="#local-6989586621680309271"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-6989586621680309283"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-2510"></a><span>                </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309283"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309281"><span class="hs-identifier hs-var">sig_wcs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309284"><span class="hs-identifier hs-var">wrap</span></a><span class="hs-special">)</span><span>
</span><a name="line-2511"></a><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2512"></a><span>                </span><span class="hs-comment">-- Type signature binds at least one scoped type variable</span><span>
</span><a name="line-2513"></a><span>
</span><a name="line-2514"></a><span>                </span><span class="hs-comment">-- A pattern binding cannot bind scoped type variables</span><span>
</span><a name="line-2515"></a><span>                </span><span class="hs-comment">-- It is more convenient to make the test here</span><span>
</span><a name="line-2516"></a><span>                </span><span class="hs-comment">-- than in the renamer</span><span>
</span><a name="line-2517"></a><span>        </span><span class="hs-special">{</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="#local-6989586621680309269"><span class="hs-identifier hs-var">in_pat_bind</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#patBindSigErr"><span class="hs-identifier hs-var">patBindSigErr</span></a><span> </span><a href="#local-6989586621680309282"><span class="hs-identifier hs-var">sig_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2518"></a><span>
</span><a name="line-2519"></a><span>                </span><span class="hs-comment">-- Check that all newly-in-scope tyvars are in fact</span><span>
</span><a name="line-2520"></a><span>                </span><span class="hs-comment">-- constrained by the pattern.  This catches tiresome</span><span>
</span><a name="line-2521"></a><span>                </span><span class="hs-comment">-- cases like</span><span>
</span><a name="line-2522"></a><span>                </span><span class="hs-comment">--      type T a = Int</span><span>
</span><a name="line-2523"></a><span>                </span><span class="hs-comment">--      f :: Int -&gt; Int</span><span>
</span><a name="line-2524"></a><span>                </span><span class="hs-comment">--      f (x :: T a) = ...</span><span>
</span><a name="line-2525"></a><span>                </span><span class="hs-comment">-- Here 'a' doesn't get a binding.  Sigh</span><span>
</span><a name="line-2526"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309285"><a href="#local-6989586621680309285"><span class="hs-identifier">bad_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621680309286"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621680309286"><a href="#local-6989586621680309286"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680309282"><span class="hs-identifier hs-var">sig_tvs</span></a><span>
</span><a name="line-2527"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309286"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TcType.html#exactTyCoVarsOfType"><span class="hs-identifier hs-var">exactTyCoVarsOfType</span></a><span> </span><a href="#local-6989586621680309283"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2528"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680309285"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcHsType.html#badPatSigTvs"><span class="hs-identifier hs-var">badPatSigTvs</span></a><span> </span><a href="#local-6989586621680309283"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><a href="#local-6989586621680309285"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2529"></a><span>
</span><a name="line-2530"></a><span>        </span><span class="hs-comment">-- Now do a subsumption check of the pattern signature against res_ty</span><span>
</span><a name="line-2531"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309287"><a href="#local-6989586621680309287"><span class="hs-identifier">wrap</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309272"><span class="hs-identifier hs-var">mk_msg</span></a><span> </span><a href="#local-6989586621680309283"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2532"></a><span>                  </span><a href="TcUnify.html#tcSubTypeET"><span class="hs-identifier hs-var">tcSubTypeET</span></a><span> </span><a href="TcRnTypes.html#PatSigOrigin"><span class="hs-identifier hs-var">PatSigOrigin</span></a><span> </span><a href="TcType.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a><span> </span><a href="#local-6989586621680309271"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-6989586621680309283"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-2533"></a><span>
</span><a name="line-2534"></a><span>        </span><span class="hs-comment">-- Phew!</span><span>
</span><a name="line-2535"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309283"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309282"><span class="hs-identifier hs-var">sig_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309281"><span class="hs-identifier hs-var">sig_wcs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309287"><span class="hs-identifier hs-var">wrap</span></a><span class="hs-special">)</span><span>
</span><a name="line-2536"></a><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2537"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2538"></a><span>    </span><a name="local-6989586621680309272"><a href="#local-6989586621680309272"><span class="hs-identifier">mk_msg</span></a></a><span> </span><a name="local-6989586621680309273"><a href="#local-6989586621680309273"><span class="hs-identifier">sig_ty</span></a></a><span> </span><a name="local-6989586621680309274"><a href="#local-6989586621680309274"><span class="hs-identifier">tidy_env</span></a></a><span>
</span><a name="line-2539"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309275"><a href="#local-6989586621680309275"><span class="hs-identifier">tidy_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309276"><a href="#local-6989586621680309276"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-6989586621680309274"><span class="hs-identifier hs-var">tidy_env</span></a><span> </span><a href="#local-6989586621680309273"><span class="hs-identifier hs-var">sig_ty</span></a><span>
</span><a name="line-2540"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309277"><a href="#local-6989586621680309277"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a><span> </span><a href="#local-6989586621680309271"><span class="hs-identifier hs-var">res_ty</span></a><span>   </span><span class="hs-comment">-- should be filled in by now</span><span>
</span><a name="line-2541"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309278"><a href="#local-6989586621680309278"><span class="hs-identifier">tidy_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309279"><a href="#local-6989586621680309279"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-6989586621680309275"><span class="hs-identifier hs-var">tidy_env</span></a><span> </span><a href="#local-6989586621680309277"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-2542"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309280"><a href="#local-6989586621680309280"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;When checking that the pattern signature:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2543"></a><span>                                  </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309276"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2544"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;fits the type of its context:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2545"></a><span>                                          </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309279"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2546"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309278"><span class="hs-identifier hs-var">tidy_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309280"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2547"></a><span>
</span><a name="line-2548"></a><span class="hs-identifier">patBindSigErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2549"></a><a name="patBindSigErr"><a href="TcHsType.html#patBindSigErr"><span class="hs-identifier">patBindSigErr</span></a></a><span> </span><a name="local-6989586621680309288"><a href="#local-6989586621680309288"><span class="hs-identifier">sig_tvs</span></a></a><span>
</span><a name="line-2550"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;You cannot bind scoped type variable&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a><span> </span><a href="#local-6989586621680309288"><span class="hs-identifier hs-var">sig_tvs</span></a><span>
</span><a name="line-2551"></a><span>          </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprQuotedList"><span class="hs-identifier hs-var">pprQuotedList</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-6989586621680309288"><span class="hs-identifier hs-var">sig_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2552"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in a pattern binding signature&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2553"></a><span>
</span><a name="line-2554"></a><span class="hs-comment">{- Note [Pattern signature binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
   data T = forall a. T a (a-&gt;Int)
   f (T x (f :: b-&gt;Int)) = blah

Here
 * The pattern (T p1 p2) creates a *skolem* type variable 'a_sk',
   It must be a skolem so that that it retains its identity, and
   TcErrors.getSkolemInfo can thereby find the binding site for the skolem.

 * The type signature pattern (f :: b-&gt;Int) makes a fresh meta-tyvar b_sig
   (a SigTv), and binds &quot;b&quot; :-&gt; b_sig in the envt

 * Then unification makes b_sig := a_sk
   That's why we must make b_sig a MetaTv (albeit a SigTv),
   not a SkolemTv, so that it can unify to a_sk.

 * Finally, in 'blah' we must have the envt &quot;b&quot; :-&gt; a_sk.  The pair
   (&quot;b&quot; :-&gt; a_sk) is returned by tcHsPatSigType, constructed by
   mk_tv_pair in that function.

Another example (Trac #13881):
   fl :: forall (l :: [a]). Sing l -&gt; Sing l
   fl (SNil :: Sing (l :: [y])) = SNil
When we reach the pattern signature, 'l' is in scope from the
outer 'forall':
   &quot;a&quot; :-&gt; a_sk :: *
   &quot;l&quot; :-&gt; l_sk :: [a_sk]
We make up a fresh meta-SigTv, y_sig, for 'y', and kind-check
the pattern signature
   Sing (l :: [y])
That unifies y_sig := a_sk.  We return from tcHsPatSigType with
the pair (&quot;y&quot; :-&gt; a_sk).

For RULE binders, though, things are a bit different (yuk).
  RULE &quot;foo&quot; forall (x::a) (y::[a]).  f x y = ...
Here this really is the binding site of the type variable so we'd like
to use a skolem, so that we get a complaint if we unify two of them
together.

Note [Unifying SigTvs]
~~~~~~~~~~~~~~~~~~~~~~
ALAS we have no decent way of avoiding two SigTvs getting unified.
Consider
  f (x::(a,b)) (y::c)) = [fst x, y]
Here we'd really like to complain that 'a' and 'c' are unified. But
for the reasons above we can't make a,b,c into skolems, so they
are just SigTvs that can unify.  And indeed, this would be ok,
  f x (y::c) = case x of
                 (x1 :: a1, True) -&gt; [x,y]
                 (x1 :: a2, False) -&gt; [x,y,y]
Here the type of x's first component is called 'a1' in one branch and
'a2' in the other.  We could try insisting on the same OccName, but
they definitely won't have the sane lexical Name.

I think we could solve this by recording in a SigTv a list of all the
in-scope variables that it should not unify with, but it's fiddly.


************************************************************************
*                                                                      *
        Checking kinds
*                                                                      *
************************************************************************

-}</span><span>
</span><a name="line-2621"></a><span>
</span><a name="line-2622"></a><span class="hs-identifier">unifyKinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2623"></a><a name="unifyKinds"><a href="TcHsType.html#unifyKinds"><span class="hs-identifier">unifyKinds</span></a></a><span> </span><a name="local-6989586621680309289"><a href="#local-6989586621680309289"><span class="hs-identifier">rn_tys</span></a></a><span> </span><a name="local-6989586621680309290"><a href="#local-6989586621680309290"><span class="hs-identifier">act_kinds</span></a></a><span>
</span><a name="line-2624"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309291"><a href="#local-6989586621680309291"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span>
</span><a name="line-2625"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309292"><a href="#local-6989586621680309292"><span class="hs-identifier">check</span></a></a><span> </span><a name="local-6989586621680309293"><a href="#local-6989586621680309293"><span class="hs-identifier">rn_ty</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680309294"><a href="#local-6989586621680309294"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309295"><a href="#local-6989586621680309295"><span class="hs-identifier">act_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621680309293"><span class="hs-identifier hs-var">rn_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309294"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680309295"><span class="hs-identifier hs-var">act_kind</span></a><span> </span><a href="#local-6989586621680309291"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-2626"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309296"><a href="#local-6989586621680309296"><span class="hs-identifier">tys'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a><span> </span><a href="#local-6989586621680309292"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621680309289"><span class="hs-identifier hs-var">rn_tys</span></a><span> </span><a href="#local-6989586621680309290"><span class="hs-identifier hs-var">act_kinds</span></a><span>
</span><a name="line-2627"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309296"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680309291"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2628"></a><span>
</span><a name="line-2629"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
    Promotion
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2636"></a><span>
</span><a name="line-2637"></a><span class="hs-comment">-- | Whenever a type is about to be added to the environment, it's necessary</span><span>
</span><a name="line-2638"></a><span class="hs-comment">-- to make sure that any free meta-tyvars in the type are promoted to the</span><span>
</span><a name="line-2639"></a><span class="hs-comment">-- current TcLevel. (They might be at a higher level due to the level-bumping</span><span>
</span><a name="line-2640"></a><span class="hs-comment">-- in tcExplicitTKBndrs, for example.) This function both zonks *and*</span><span>
</span><a name="line-2641"></a><span class="hs-comment">-- promotes.</span><span>
</span><a name="line-2642"></a><span class="hs-identifier">zonkPromoteType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-2643"></a><a name="zonkPromoteType"><a href="TcHsType.html#zonkPromoteType"><span class="hs-identifier">zonkPromoteType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><a href="TcHsType.html#zonkPromoteMapper"><span class="hs-identifier hs-var">zonkPromoteMapper</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2644"></a><span>
</span><a name="line-2645"></a><span class="hs-comment">-- cf. TcMType.zonkTcTypeMapper</span><span>
</span><a name="line-2646"></a><span class="hs-identifier">zonkPromoteMapper</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-type">TyCoMapper</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span>
</span><a name="line-2647"></a><a name="zonkPromoteMapper"><a href="TcHsType.html#zonkPromoteMapper"><span class="hs-identifier">zonkPromoteMapper</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-var">TyCoMapper</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcm_smart</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2648"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tyvar</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="TcHsType.html#zonkPromoteTcTyVar"><span class="hs-identifier hs-var">zonkPromoteTcTyVar</span></a><span>
</span><a name="line-2649"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_covar</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="#local-6989586621680309297"><span class="hs-identifier hs-var">covar</span></a><span>
</span><a name="line-2650"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_hole</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="#local-6989586621680309298"><span class="hs-identifier hs-var">hole</span></a><span>
</span><a name="line-2651"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tybinder</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="#local-6989586621680309299"><span class="hs-identifier hs-var">tybinder</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2652"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2653"></a><span>    </span><a name="local-6989586621680309297"><a href="#local-6989586621680309297"><span class="hs-identifier">covar</span></a></a><span> </span><a name="local-6989586621680309300"><a href="#local-6989586621680309300"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-2654"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcHsType.html#zonkPromoteTyCoVarKind"><span class="hs-identifier hs-var">zonkPromoteTyCoVarKind</span></a><span> </span><a href="#local-6989586621680309300"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-2655"></a><span>
</span><a name="line-2656"></a><span>    </span><span class="hs-identifier">hole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2657"></a><span>    </span><a name="local-6989586621680309298"><a href="#local-6989586621680309298"><span class="hs-identifier">hole</span></a></a><span> </span><a name="local-6989586621680309301"><a href="#local-6989586621680309301"><span class="hs-identifier">h</span></a></a><span>
</span><a name="line-2658"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309303"><a href="#local-6989586621680309303"><span class="hs-identifier">contents</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#unpackCoercionHole_maybe"><span class="hs-identifier hs-var">unpackCoercionHole_maybe</span></a><span> </span><a href="#local-6989586621680309301"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-2659"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680309303"><span class="hs-identifier hs-var">contents</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2660"></a><span>               </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621680309304"><a href="#local-6989586621680309304"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309305"><a href="#local-6989586621680309305"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#zonkPromoteCoercion"><span class="hs-identifier hs-var">zonkPromoteCoercion</span></a><span> </span><a href="#local-6989586621680309304"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2661"></a><span>                             </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#checkCoercionHole"><span class="hs-identifier hs-var">checkCoercionHole</span></a><span> </span><a href="#local-6989586621680309302"><span class="hs-identifier hs-var">cv</span></a><span> </span><a href="#local-6989586621680309305"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2662"></a><span>               </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309306"><a href="#local-6989586621680309306"><span class="hs-identifier">cv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#zonkPromoteTyCoVarKind"><span class="hs-identifier hs-var">zonkPromoteTyCoVarKind</span></a><span> </span><a href="#local-6989586621680309302"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-2663"></a><span>                             </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Coercion.html#mkHoleCo"><span class="hs-identifier hs-var">mkHoleCo</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#setCoHoleCoVar"><span class="hs-identifier hs-var">setCoHoleCoVar</span></a><span> </span><a href="#local-6989586621680309301"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621680309306"><span class="hs-identifier hs-var">cv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2664"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-2665"></a><span>        </span><a name="local-6989586621680309302"><a href="#local-6989586621680309302"><span class="hs-identifier">cv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a><span> </span><a href="#local-6989586621680309301"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-2666"></a><span>
</span><a name="line-2667"></a><span>    </span><span class="hs-identifier">tybinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2668"></a><span>    </span><a name="local-6989586621680309299"><a href="#local-6989586621680309299"><span class="hs-identifier">tybinder</span></a></a><span> </span><a name="local-6989586621680309307"><a href="#local-6989586621680309307"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621680309308"><a href="#local-6989586621680309308"><span class="hs-identifier">_flag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcHsType.html#zonkPromoteTyCoVarKind"><span class="hs-identifier hs-var">zonkPromoteTyCoVarKind</span></a><span> </span><a href="#local-6989586621680309307"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2669"></a><span>
</span><a name="line-2670"></a><span class="hs-identifier">zonkPromoteTcTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-2671"></a><a name="zonkPromoteTcTyVar"><a href="TcHsType.html#zonkPromoteTcTyVar"><span class="hs-identifier">zonkPromoteTcTyVar</span></a></a><span> </span><a name="local-6989586621680309309"><a href="#local-6989586621680309309"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2672"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a><span> </span><a href="#local-6989586621680309309"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2673"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680309310"><a href="#local-6989586621680309310"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#metaTyVarRef"><span class="hs-identifier hs-var">metaTyVarRef</span></a><span> </span><a href="#local-6989586621680309309"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2674"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309311"><a href="#local-6989586621680309311"><span class="hs-identifier">contents</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-6989586621680309310"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-2675"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680309311"><span class="hs-identifier hs-var">contents</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2676"></a><span>           </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309312"><a href="#local-6989586621680309312"><span class="hs-identifier">promoted</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#promoteTyVar"><span class="hs-identifier hs-var">promoteTyVar</span></a><span> </span><a href="#local-6989586621680309309"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2677"></a><span>                       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680309312"><span class="hs-identifier hs-var">promoted</span></a><span>
</span><a name="line-2678"></a><span>                         </span><span class="hs-keyword">then</span><span> </span><a href="TcHsType.html#zonkPromoteTcTyVar"><span class="hs-identifier hs-var">zonkPromoteTcTyVar</span></a><span> </span><a href="#local-6989586621680309309"><span class="hs-identifier hs-var">tv</span></a><span>   </span><span class="hs-comment">-- read it again</span><span>
</span><a name="line-2679"></a><span>                         </span><span class="hs-keyword">else</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcHsType.html#zonkPromoteTyCoVarKind"><span class="hs-identifier hs-var">zonkPromoteTyCoVarKind</span></a><span> </span><a href="#local-6989586621680309309"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2680"></a><span>           </span><a href="TcType.html#Indirect"><span class="hs-identifier hs-var">Indirect</span></a><span> </span><a name="local-6989586621680309313"><a href="#local-6989586621680309313"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsType.html#zonkPromoteType"><span class="hs-identifier hs-var">zonkPromoteType</span></a><span> </span><a href="#local-6989586621680309313"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2681"></a><span>
</span><a name="line-2682"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a><span> </span><a href="#local-6989586621680309309"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TcType.html#isSkolemTyVar"><span class="hs-identifier hs-var">isSkolemTyVar</span></a><span> </span><a href="#local-6989586621680309309"><span class="hs-identifier hs-var">tv</span></a><span>  </span><span class="hs-comment">-- NB: isSkolemTyVar says &quot;True&quot; to pure TyVars</span><span>
</span><a name="line-2683"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309314"><a href="#local-6989586621680309314"><span class="hs-identifier">tc_lvl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a><span>
</span><a name="line-2684"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcHsType.html#zonkPromoteTyCoVarKind"><span class="hs-identifier hs-var">zonkPromoteTyCoVarKind</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#promoteSkolem"><span class="hs-identifier hs-var">promoteSkolem</span></a><span> </span><a href="#local-6989586621680309314"><span class="hs-identifier hs-var">tc_lvl</span></a><span> </span><a href="#local-6989586621680309309"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2685"></a><span>
</span><a name="line-2686"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2687"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcHsType.html#zonkPromoteTyCoVarKind"><span class="hs-identifier hs-var">zonkPromoteTyCoVarKind</span></a><span> </span><a href="#local-6989586621680309309"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2688"></a><span>
</span><a name="line-2689"></a><span class="hs-identifier">zonkPromoteTyCoVarKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span>
</span><a name="line-2690"></a><a name="zonkPromoteTyCoVarKind"><a href="TcHsType.html#zonkPromoteTyCoVarKind"><span class="hs-identifier">zonkPromoteTyCoVarKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#updateTyVarKindM"><span class="hs-identifier hs-var">updateTyVarKindM</span></a><span> </span><a href="TcHsType.html#zonkPromoteType"><span class="hs-identifier hs-var">zonkPromoteType</span></a><span>
</span><a name="line-2691"></a><span>
</span><a name="line-2692"></a><span class="hs-identifier">zonkPromoteTyCoVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span>
</span><a name="line-2693"></a><a name="zonkPromoteTyCoVarBndr"><a href="TcHsType.html#zonkPromoteTyCoVarBndr"><span class="hs-identifier">zonkPromoteTyCoVarBndr</span></a></a><span> </span><a name="local-6989586621680309315"><a href="#local-6989586621680309315"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2694"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#isSigTyVar"><span class="hs-identifier hs-var">isSigTyVar</span></a><span> </span><a href="#local-6989586621680309315"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2695"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcGetTyVar"><span class="hs-identifier hs-var">tcGetTyVar</span></a><span> </span><span class="hs-string">&quot;zonkPromoteTyCoVarBndr SigTv&quot;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcHsType.html#zonkPromoteTcTyVar"><span class="hs-identifier hs-var">zonkPromoteTcTyVar</span></a><span> </span><a href="#local-6989586621680309315"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2696"></a><span>
</span><a name="line-2697"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a><span> </span><a href="#local-6989586621680309315"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TcType.html#isSkolemTyVar"><span class="hs-identifier hs-var">isSkolemTyVar</span></a><span> </span><a href="#local-6989586621680309315"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2698"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309316"><a href="#local-6989586621680309316"><span class="hs-identifier">tc_lvl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a><span>
</span><a name="line-2699"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsType.html#zonkPromoteTyCoVarKind"><span class="hs-identifier hs-var">zonkPromoteTyCoVarKind</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#promoteSkolem"><span class="hs-identifier hs-var">promoteSkolem</span></a><span> </span><a href="#local-6989586621680309316"><span class="hs-identifier hs-var">tc_lvl</span></a><span> </span><a href="#local-6989586621680309315"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2700"></a><span>
</span><a name="line-2701"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2702"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsType.html#zonkPromoteTyCoVarKind"><span class="hs-identifier hs-var">zonkPromoteTyCoVarKind</span></a><span> </span><a href="#local-6989586621680309315"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2703"></a><span>
</span><a name="line-2704"></a><span class="hs-identifier">zonkPromoteCoercion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2705"></a><a name="zonkPromoteCoercion"><a href="TcHsType.html#zonkPromoteCoercion"><span class="hs-identifier">zonkPromoteCoercion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mapCoercion"><span class="hs-identifier hs-var">mapCoercion</span></a><span> </span><a href="TcHsType.html#zonkPromoteMapper"><span class="hs-identifier hs-var">zonkPromoteMapper</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2706"></a><span>
</span><a name="line-2707"></a><span class="hs-identifier">zonkPromoteTypeInKnot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-2708"></a><a name="zonkPromoteTypeInKnot"><a href="TcHsType.html#zonkPromoteTypeInKnot"><span class="hs-identifier">zonkPromoteTypeInKnot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#zonkPromoteMapper"><span class="hs-identifier hs-var">zonkPromoteMapper</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcm_smart</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2709"></a><span>  </span><span class="hs-comment">-- NB: Just changing smart to False will still use the smart zonker (not suitable</span><span>
</span><a name="line-2710"></a><span>  </span><span class="hs-comment">-- for in-the-knot) for kinds. But that's OK, because kinds aren't knot-tied.</span><span>
</span><a name="line-2711"></a><span>
</span><a name="line-2712"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Sort checking kinds
*                                                                      *
************************************************************************

tcLHsKindSig converts a user-written kind to an internal, sort-checked kind.
It does sort checking and desugaring at the same time, in one single pass.
-}</span><span>
</span><a name="line-2722"></a><span>
</span><a name="line-2723"></a><span class="hs-identifier">tcLHsKindSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-2724"></a><a name="tcLHsKindSig"><a href="TcHsType.html#tcLHsKindSig"><span class="hs-identifier">tcLHsKindSig</span></a></a><span> </span><a name="local-6989586621680309317"><a href="#local-6989586621680309317"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621680309318"><a href="#local-6989586621680309318"><span class="hs-identifier">hs_kind</span></a></a><span>
</span><a name="line-2725"></a><span class="hs-comment">-- See  Note [Recipe for checking a signature] in TcHsType</span><span>
</span><a name="line-2726"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309319"><a href="#local-6989586621680309319"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcSimplify.html#solveLocalEqualities"><span class="hs-identifier hs-var">solveLocalEqualities</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2727"></a><span>                 </span><a href="TcHsType.html#tc_lhs_kind"><span class="hs-identifier hs-var">tc_lhs_kind</span></a><span> </span><a href="TcHsType.html#kindLevelMode"><span class="hs-identifier hs-var">kindLevelMode</span></a><span> </span><a href="#local-6989586621680309318"><span class="hs-identifier hs-var">hs_kind</span></a><span>
</span><a name="line-2728"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309320"><a href="#local-6989586621680309320"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsType.html#zonkPromoteType"><span class="hs-identifier hs-var">zonkPromoteType</span></a><span> </span><a href="#local-6989586621680309319"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-2729"></a><span>         </span><span class="hs-comment">-- This zonk is very important in the case of higher rank kinds</span><span>
</span><a name="line-2730"></a><span>         </span><span class="hs-comment">-- E.g. Trac #13879    f :: forall (p :: forall z (y::z). &lt;blah&gt;).</span><span>
</span><a name="line-2731"></a><span>         </span><span class="hs-comment">--                          &lt;more blah&gt;</span><span>
</span><a name="line-2732"></a><span>         </span><span class="hs-comment">--      When instantiating p's kind at occurrences of p in &lt;more blah&gt;</span><span>
</span><a name="line-2733"></a><span>         </span><span class="hs-comment">--      it's crucial that the kind we instantiate is fully zonked,</span><span>
</span><a name="line-2734"></a><span>         </span><span class="hs-comment">--      else we may fail to substitute properly</span><span>
</span><a name="line-2735"></a><span>
</span><a name="line-2736"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcValidity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a><span> </span><a href="#local-6989586621680309317"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621680309320"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-2737"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621680309320"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2738"></a><span>
</span><a name="line-2739"></a><span class="hs-identifier">tc_lhs_kind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-2740"></a><a name="tc_lhs_kind"><a href="TcHsType.html#tc_lhs_kind"><span class="hs-identifier">tc_lhs_kind</span></a></a><span> </span><a name="local-6989586621680309321"><a href="#local-6989586621680309321"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621680309322"><a href="#local-6989586621680309322"><span class="hs-identifier">k</span></a></a><span>
</span><a name="line-2741"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In the kind&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309322"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2742"></a><span>    </span><a href="TcHsType.html#tc_lhs_type"><span class="hs-identifier hs-var">tc_lhs_type</span></a><span> </span><span class="hs-special">(</span><a href="TcHsType.html#kindLevel"><span class="hs-identifier hs-var">kindLevel</span></a><span> </span><a href="#local-6989586621680309321"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309322"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-2743"></a><span>
</span><a name="line-2744"></a><span class="hs-identifier">promotionErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#PromotionErr"><span class="hs-identifier hs-type">PromotionErr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621680308525"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2745"></a><a name="promotionErr"><a href="TcHsType.html#promotionErr"><span class="hs-identifier">promotionErr</span></a></a><span> </span><a name="local-6989586621680309323"><a href="#local-6989586621680309323"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621680309324"><a href="#local-6989586621680309324"><span class="hs-identifier">err</span></a></a><span>
</span><a name="line-2746"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#pprPECategory"><span class="hs-identifier hs-var">pprPECategory</span></a><span> </span><a href="#local-6989586621680309324"><span class="hs-identifier hs-var">err</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309323"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;cannot be used here&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2747"></a><span>                   </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><a href="#local-6989586621680309325"><span class="hs-identifier hs-var">reason</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2748"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2749"></a><span>    </span><a name="local-6989586621680309325"><a href="#local-6989586621680309325"><span class="hs-identifier">reason</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680309324"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2750"></a><span>               </span><a href="TcRnTypes.html#FamDataConPE"><span class="hs-identifier hs-var">FamDataConPE</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;it comes from a data family instance&quot;</span><span>
</span><a name="line-2751"></a><span>               </span><a href="TcRnTypes.html#NoDataKindsTC"><span class="hs-identifier hs-var">NoDataKindsTC</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;perhaps you intended to use DataKinds&quot;</span><span>
</span><a name="line-2752"></a><span>               </span><a href="TcRnTypes.html#NoDataKindsDC"><span class="hs-identifier hs-var">NoDataKindsDC</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;perhaps you intended to use DataKinds&quot;</span><span>
</span><a name="line-2753"></a><span>               </span><a href="TcRnTypes.html#NoTypeInTypeTC"><span class="hs-identifier hs-var">NoTypeInTypeTC</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;perhaps you intended to use TypeInType&quot;</span><span>
</span><a name="line-2754"></a><span>               </span><a href="TcRnTypes.html#NoTypeInTypeDC"><span class="hs-identifier hs-var">NoTypeInTypeDC</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;perhaps you intended to use TypeInType&quot;</span><span>
</span><a name="line-2755"></a><span>               </span><a href="TcRnTypes.html#PatSynPE"><span class="hs-identifier hs-var">PatSynPE</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;pattern synonyms cannot be promoted&quot;</span><span>
</span><a name="line-2756"></a><span>               </span><a href="TcRnTypes.html#PatSynExPE"><span class="hs-identifier hs-var">PatSynExPE</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the existential variables of a pattern synonym&quot;</span><span>
</span><a name="line-2757"></a><span>                                     </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;signature do not scope over the pattern&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2758"></a><span>               </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;it is defined and used in the same recursive group&quot;</span><span>
</span><a name="line-2759"></a><span>
</span><a name="line-2760"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Scoped type variables
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2767"></a><span>
</span><a name="line-2768"></a><span class="hs-identifier">badPatSigTvs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2769"></a><a name="badPatSigTvs"><a href="TcHsType.html#badPatSigTvs"><span class="hs-identifier">badPatSigTvs</span></a></a><span> </span><a name="local-6989586621680309326"><a href="#local-6989586621680309326"><span class="hs-identifier">sig_ty</span></a></a><span> </span><a name="local-6989586621680309327"><a href="#local-6989586621680309327"><span class="hs-identifier">bad_tvs</span></a></a><span>
</span><a name="line-2770"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The type variable&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a><span> </span><a href="#local-6989586621680309327"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">,</span><span>
</span><a name="line-2771"></a><span>                 </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309327"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2772"></a><span>                 </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;should be bound by the pattern signature&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309326"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2773"></a><span>                 </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;but are actually discarded by a type synonym&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2774"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;To fix this, expand the type synonym&quot;</span><span>
</span><a name="line-2775"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;[Note: I hope to lift this restriction in due course]&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2776"></a><span>
</span><a name="line-2777"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
          Error messages and such
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2784"></a><span>
</span><a name="line-2785"></a><span class="hs-comment">-- | Make an appropriate message for an error in a function argument.</span><span>
</span><a name="line-2786"></a><span class="hs-comment">-- Used for both expressions and types.</span><span>
</span><a name="line-2787"></a><span class="hs-identifier">funAppCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621680308523"><span class="hs-identifier hs-type">fun</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621680308524"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680308523"><span class="hs-identifier hs-type">fun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680308524"><span class="hs-identifier hs-type">arg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2788"></a><a name="funAppCtxt"><a href="TcHsType.html#funAppCtxt"><span class="hs-identifier">funAppCtxt</span></a></a><span> </span><a name="local-6989586621680309328"><a href="#local-6989586621680309328"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621680309329"><a href="#local-6989586621680309329"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621680309330"><a href="#local-6989586621680309330"><span class="hs-identifier">arg_no</span></a></a><span>
</span><a name="line-2789"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In the&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#speakNth"><span class="hs-identifier hs-var">speakNth</span></a><span> </span><a href="#local-6989586621680309330"><span class="hs-identifier hs-var">arg_no</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;argument of&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2790"></a><span>                    </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309328"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;, namely&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2791"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309329"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2792"></a><span>
</span><a name="line-2793"></a><span class="hs-comment">-- See Note [Free-floating kind vars]</span><span>
</span><a name="line-2794"></a><span class="hs-identifier">reportFloatingKvs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>         </span><span class="hs-comment">-- of the tycon</span><span>
</span><a name="line-2795"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a><span> </span><span class="hs-comment">-- What sort of TyCon it is</span><span>
</span><a name="line-2796"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- all tyvars, not necessarily zonked</span><span>
</span><a name="line-2797"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- floating tyvars</span><span>
</span><a name="line-2798"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2799"></a><a name="reportFloatingKvs"><a href="TcHsType.html#reportFloatingKvs"><span class="hs-identifier">reportFloatingKvs</span></a></a><span> </span><a name="local-6989586621680309331"><a href="#local-6989586621680309331"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-6989586621680309332"><a href="#local-6989586621680309332"><span class="hs-identifier">flav</span></a></a><span> </span><a name="local-6989586621680309333"><a href="#local-6989586621680309333"><span class="hs-identifier">all_tvs</span></a></a><span> </span><a name="local-6989586621680309334"><a href="#local-6989586621680309334"><span class="hs-identifier">bad_tvs</span></a></a><span>
</span><a name="line-2800"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680309334"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>  </span><span class="hs-comment">-- don't bother zonking if there's no error</span><span>
</span><a name="line-2801"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680309343"><a href="#local-6989586621680309343"><span class="hs-identifier">all_tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcTyVarToTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTyVar</span></a><span> </span><a href="#local-6989586621680309333"><span class="hs-identifier hs-var">all_tvs</span></a><span>
</span><a name="line-2802"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309344"><a href="#local-6989586621680309344"><span class="hs-identifier">bad_tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcTyVarToTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTyVar</span></a><span> </span><a href="#local-6989586621680309334"><span class="hs-identifier hs-var">bad_tvs</span></a><span>
</span><a name="line-2803"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680309345"><a href="#local-6989586621680309345"><span class="hs-identifier">tidy_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680309346"><a href="#local-6989586621680309346"><span class="hs-identifier">tidy_all_tvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyOpenTyCoVars"><span class="hs-identifier hs-var">tidyOpenTyCoVars</span></a><span> </span><a href="VarEnv.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a><span> </span><a href="#local-6989586621680309343"><span class="hs-identifier hs-var">all_tvs</span></a><span>
</span><a name="line-2804"></a><span>             </span><a name="local-6989586621680309347"><a href="#local-6989586621680309347"><span class="hs-identifier">tidy_bad_tvs</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyTyVarOcc"><span class="hs-identifier hs-var">tidyTyVarOcc</span></a><span> </span><a href="#local-6989586621680309345"><span class="hs-identifier hs-var">tidy_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309344"><span class="hs-identifier hs-var">bad_tvs</span></a><span>
</span><a name="line-2805"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621680309348"><a href="#local-6989586621680309348"><span class="hs-identifier">typeintype</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#TypeInType"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TypeInType</span></a><span>
</span><a name="line-2806"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309335"><span class="hs-identifier hs-var">report</span></a><span> </span><a href="#local-6989586621680309348"><span class="hs-identifier hs-var">typeintype</span></a><span> </span><a href="#local-6989586621680309346"><span class="hs-identifier hs-var">tidy_all_tvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680309347"><span class="hs-identifier hs-var">tidy_bad_tvs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2807"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2808"></a><span>    </span><a name="local-6989586621680309335"><a href="#local-6989586621680309335"><span class="hs-identifier">report</span></a></a><span> </span><a name="local-6989586621680309338"><a href="#local-6989586621680309338"><span class="hs-identifier">typeintype</span></a></a><span> </span><a name="local-6989586621680309339"><a href="#local-6989586621680309339"><span class="hs-identifier">tidy_all_tvs</span></a></a><span> </span><a name="local-6989586621680309340"><a href="#local-6989586621680309340"><span class="hs-identifier">tidy_bad_tv</span></a></a><span>
</span><a name="line-2809"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2810"></a><span>        </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Kind variable&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309340"><span class="hs-identifier hs-var">tidy_bad_tv</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-2811"></a><span>               </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is implicitly bound in&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309332"><span class="hs-identifier hs-var">flav</span></a><span>
</span><a name="line-2812"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309331"><span class="hs-identifier hs-var">tycon_name</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-2813"></a><span>               </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;but does not appear as the kind of any&quot;</span><span>
</span><a name="line-2814"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;of its type variables. Perhaps you meant&quot;</span><span>
</span><a name="line-2815"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;to bind it&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppWhen"><span class="hs-identifier hs-var">ppWhen</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621680309338"><span class="hs-identifier hs-var">typeintype</span></a><span class="hs-special">)</span><span>
</span><a name="line-2816"></a><span>                                            </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(with TypeInType)&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-2817"></a><span>                                 </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;explicitly somewhere?&quot;</span><span>
</span><a name="line-2818"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppWhen"><span class="hs-identifier hs-var">ppWhen</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621680309339"><span class="hs-identifier hs-var">tidy_all_tvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2819"></a><span>                 </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type variables with inferred kinds:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2820"></a><span>                 </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680309336"><span class="hs-identifier hs-var">ppr_tv_bndrs</span></a><span> </span><a href="#local-6989586621680309339"><span class="hs-identifier hs-var">tidy_all_tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2821"></a><span>
</span><a name="line-2822"></a><span>    </span><a name="local-6989586621680309336"><a href="#local-6989586621680309336"><span class="hs-identifier">ppr_tv_bndrs</span></a></a><span> </span><a name="local-6989586621680309341"><a href="#local-6989586621680309341"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.12.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621680309337"><span class="hs-identifier hs-var">pp_tv</span></a><span> </span><a href="#local-6989586621680309341"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2823"></a><span>    </span><a name="local-6989586621680309337"><a href="#local-6989586621680309337"><span class="hs-identifier">pp_tv</span></a></a><span> </span><a name="local-6989586621680309342"><a href="#local-6989586621680309342"><span class="hs-identifier">tv</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680309342"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621680309342"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2824"></a></pre></body></html>